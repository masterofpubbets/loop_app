--version11.0.0
UPDATE [dbo].[tblSettings] SET SetValue = '11.0.0' WHERE SetName = 'VERSION'
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'SP_P6Summary'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.SP_P6Summary
END
GO
CREATE Proc [dbo].[SP_P6Summary]
AS
SELECT
vblock.Block,vblock.Unit
,EICA_Area

,rtrim(PCS_Area) as PCS_Area,rtrim(tblActIDS.Family) as Family,rtrim(tblActIDS.SubCon) as SubCon
,tblActIDS.ActName,tblActIDS.ActID

,Scope AS EICA_Budget
,tblActIDS.EstimatedScope

,[Qty Done] as EICA_Done
,weekly as EICA_Weekly

,tblActIDS.PCS_Budget as [PCS Budget]
,tblActIDS.PCSDone AS [PCS Done%]
,tblActIDS.PCS_Budget - Scope as Diff

FROM
(
select 
[Act ID]
,sum(Scope) as Scope
,sum([Qty Done]) as [Qty Done]
,sum(Weekly) as Weekly
from
(
select 
actid as [Act ID]
,Scope
,[Qty Done]
,Weekly
from
(
--F&G SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Final_Installed_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND Final_Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
AND Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
AND Calibration_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Final_Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
and Calibration_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Hookup SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.HookUp_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
AND HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Hookup_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
AND Hookup_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and  Active=1
and HookUp_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + 'QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and  Active=1
and Hookup_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Ins JB SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'JB' as [Activity],
JUNCTIONBOX.IC_Plan_P6_ActID_Install as actid, JUNCTIONBOX.Area, 
'Each' as [Measure]
,COUNT(JUNCTIONBOX.JUNCTIONBOX) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM JUNCTIONBOX WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY JUNCTIONBOX.IC_Plan_P6_ActID_Install,  JUNCTIONBOX.Area
-----------------------------------------------------------
UNION ALL
--Ins JB DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'JB' as [Activity],
JUNCTIONBOX.IC_Plan_P6_ActID_Install as actid, JUNCTIONBOX.Area, 
'Each' as [Measure]
,0 AS Scope
,count(JUNCTIONBOX.JI_Installed) as [Qty Done]
,0 as weekly
FROM JUNCTIONBOX WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND JI_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY JUNCTIONBOX.IC_Plan_P6_ActID_Install,  JUNCTIONBOX.Area
-----------------------------------------------------------
UNION ALL
--Ins JB Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'JB' as [Activity],
JUNCTIONBOX.IC_Plan_P6_ActID_Install as actid, JUNCTIONBOX.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(JUNCTIONBOX.JUNCTIONBOX) as Weekly
FROM JUNCTIONBOX WITH (NOLOCK)
where Active=1
and JI_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY JUNCTIONBOX.IC_Plan_P6_ActID_Install,  JUNCTIONBOX.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,COUNT(tblInsEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsEquipment.Installed_Date) as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
AND Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsEquipment.TAG) as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
and Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Scope
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Pulling as actid, tblEleCableList.Area, 
'LM' as [Measure]
,sum(tblEleCableList.EC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Pulling,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Quantity Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
WHERE Discipline='Ele Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction WITH (NOLOCK)
WHERE Discipline='Ele Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID,  vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ele JB SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,COUNT(tblEleJunctionBox.tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB DONE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleJunctionBox.Je_Installed) as [Qty Done]
,0 as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND Je_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblEleJunctionBox.tag) as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and JE_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Scope
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_PULLING as actid, tblInsCableList.Area, 
'LM' as [Measure]
,sum(tblInsCableList.IC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_PULLING,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Pulled
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
where Discipline='IC Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Ins Cable Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction WITH (NOLOCK)
where Discipline='IC Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID, vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_From) 
as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
AND IC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_to) 
as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
AND IC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_From)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_PLAN_P6_ACTID_CONNECT=tblActIDS.ACTID
where Active=1
and tblInsCableList.IC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_To)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
and tblInsCableList.IC_Plan_Connected_Date_to between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_From)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
AND EC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_to)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
AND EC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_From) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
and tblEleCableList.EC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_To) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
and tblEleCableList.EC_Plan_Connected_Date_To between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--Ele Equipment SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,COUNT(tblElectricalEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblElectricalEquipment.Installed_Date) as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
AND Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblElectricalEquipment.Installed_Date) as Weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
and tblElectricalEquipment.Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB SCOPE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB DONE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture SCOPE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.tag) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture DONE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Scope
SELECT DISTINCT 
tblMSCCable.Type as Discipline,'Cable Pulling' as [Activity],
IC_Plan_P6_ActID_Pulling as actid, Area, 
'LM' as [Measure]
,sum(Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMSCCable WITH (NOLOCK)
where active=1
GROUP BY tblMSCCable.Type,IC_Plan_P6_ActID_Pulling,  Area
-----------------------------------------------------------
UNION ALL
--Misc Cable Pulling Pulled
SELECT DISTINCT 
vCblParProductionTotal.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
where Discipline='Msc Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.Type,vCblParProductionTotal.PullingActID, vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Weekly
SELECT DISTINCT 
vCblParProduction.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.qnty) as Weekly
FROM vCblParProduction WITH (NOLOCK)
where Discipline='Msc Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.Type,vCblParProduction.PullingActID,  vCblParProduction.Area
---------------------------------------------------------
UNION ALL
--Cable Tray
SELECT DISTINCT 
Discipline,[Activity],
Actid  
, Area, 
'LM' as [Measure]
,[Scope LM] AS Scope
,[Pulled LM] as [Qty Done]
,[WK Pulled] as Weekly
FROM v_Trays
---------------------------------------------------------
UNION ALL
--Ele Cable Testing Scope
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,COUNT(tblEleCableList.EC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Scope
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,COUNT(tblInsCableList.IC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblEleCableList.EC_ID) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.EC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblInsCableList.IC_ID) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.IC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblEleCableList.EC_ID) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.EC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsCableList.IC_ID) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.IC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Done
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,sum(v_Items.totalqnty) as [Qty Done]
,0 as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Weekly
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(v_Items.totalqnty) as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,count(tblEleCableList.ec_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.TR_QC_Released) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,count(tblInsCableList.ic_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Done
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.TR_QC_Released) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment QC RELEASED SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,COUNT(tblElectricalEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment QC RELEASED DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblElectricalEquipment.TR_QC_Released) as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
AND TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment QC RELEASED Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblElectricalEquipment.TR_QC_Released) as Weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
and tblElectricalEquipment.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ QC RELEASED SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,COUNT(tblInsEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ QC RELEASED DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsEquipment.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
AND TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ QC RELEASED Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsEquipment.TR_QC_Released) as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
and TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele JB QC RELEASED SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,COUNT(tblEleJunctionBox.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB QC RELEASED DONE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleJunctionBox.JE_TRQC) as [Qty Done]
,0 as weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND JE_TRQC <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB QC RELEASED Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleJunctionBox.JE_TRQC) as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
and tblEleJunctionBox.JE_TRQC between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--INS JB QC RELEASED SCOPE
SELECT DISTINCT 
'Ins' as Discipline,'JB' as [Activity],
JunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, JunctionBox.Area, 
'Each' as [Measure]
,COUNT(JunctionBox.JunctionBox) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM JunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY JunctionBox.IC_Plan_P6_ActID_Install,  JunctionBox.Area
-----------------------------------------------------------
UNION ALL
--INS JB QC RELEASED DONE
SELECT DISTINCT 
'Ins' as Discipline,'JB' as [Activity],
JunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, JunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,count(JunctionBox.JI_TRQC) as [Qty Done]
,0 as weekly
FROM JunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND JI_TRQC <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY JunctionBox.IC_Plan_P6_ActID_Install,  JunctionBox.Area
-----------------------------------------------------------
UNION ALL
--INS JB QC RELEASED Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
JunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, JunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(JunctionBox.JI_TRQC) as Weekly
FROM JunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
and JunctionBox.JI_TRQC between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY JunctionBox.IC_Plan_P6_ActID_Install,  JunctionBox.Area
-----------------------------------------------------------
UNION ALL

--Uni Equipment SCOPE
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEquipment 
where Active=1
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(InstalledDate) as [Qty Done]
,0 as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
AND InstalledDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed Weekly
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
and InstalledDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors SCOPE
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMotor 
where Active=1
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(solo_run_date) as [Qty Done]
,0 as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
AND solo_run_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed Weekly
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
and solo_run_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------

) as v1
) as v2

where [Act ID] is not null

group by 
[Act ID]
) AS vDynamicAvts
inner JOIN tblActIDS
ON tblActIDS.ActID=vDynamicAvts.[Act ID]
inner join 
(
SELECT Area.Area,unit.unit,unit.Block  FROM [Area]
inner join unit
on [Area].Unit=unit.Unit 
) as vBlock
on eica_Area=vblock.Area
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'SP_P6Summary_Est'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.SP_P6Summary_Est
END
GO
CREATE Proc [dbo].[SP_P6Summary_Est]
AS
SELECT
tblActIDS.Team
,vblock.Block,vblock.Unit
,rtrim(PCS_Area) AS [PCS Area]
,EICA_Area
,tblActIDS.ResourceId, tblActIDS.ResourceName, tblActIDS.UOM
,rtrim(tblActIDS.Family) as Family,rtrim(tblActIDS.SubCon) as SubCon
,tblActIDS.ActName,tblActIDS.ActID,tblActIDS.PCS_Budget
,tblActIDS.EstimatedScope AS EICA_Budget
,tblActIDS.PCS_Budget - tblActIDS.EstimatedScope as Diff
,[Qty Done] as EICA_Done
,tblActIDS.PCSDone AS [PCS Done %]
,weekly as EICA_Weekly
,Scope as [EICA Actual Scope]
FROM
(
select 
[Act ID]
,sum(Scope) as Scope
,sum([Qty Done]) as [Qty Done]
,sum(Weekly) as Weekly
from
(
select 
actid as [Act ID]
,Scope
,[Qty Done]
,Weekly
from
(
--F&G SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Final_Installed_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND Final_Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
AND Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
AND Calibration_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Final_Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
and Calibration_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Hookup SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.HookUp_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
AND HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Hookup_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
AND Hookup_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and  Active=1
and HookUp_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + 'QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and  Active=1
and Hookup_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Ins JB SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'JB' as [Activity],
JUNCTIONBOX.IC_Plan_P6_ActID_Install as actid, JUNCTIONBOX.Area, 
'Each' as [Measure]
,COUNT(JUNCTIONBOX.JUNCTIONBOX) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM JUNCTIONBOX WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY JUNCTIONBOX.IC_Plan_P6_ActID_Install,  JUNCTIONBOX.Area
-----------------------------------------------------------
UNION ALL
--Ins JB DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'JB' as [Activity],
JUNCTIONBOX.IC_Plan_P6_ActID_Install as actid, JUNCTIONBOX.Area, 
'Each' as [Measure]
,0 AS Scope
,count(JUNCTIONBOX.JI_Installed) as [Qty Done]
,0 as weekly
FROM JUNCTIONBOX WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND JI_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY JUNCTIONBOX.IC_Plan_P6_ActID_Install,  JUNCTIONBOX.Area
-----------------------------------------------------------
UNION ALL
--Ins JB Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'JB' as [Activity],
JUNCTIONBOX.IC_Plan_P6_ActID_Install as actid, JUNCTIONBOX.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(JUNCTIONBOX.JUNCTIONBOX) as Weekly
FROM JUNCTIONBOX WITH (NOLOCK)
where Active=1
and JI_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY JUNCTIONBOX.IC_Plan_P6_ActID_Install,  JUNCTIONBOX.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,COUNT(tblInsEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsEquipment.Installed_Date) as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
AND Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsEquipment.TAG) as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
and Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Scope
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Pulling as actid, tblEleCableList.Area, 
'LM' as [Measure]
,sum(tblEleCableList.EC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Pulling,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Quantity Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
WHERE Discipline='Ele Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction WITH (NOLOCK)
WHERE Discipline='Ele Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID,  vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ele JB SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,COUNT(tblEleJunctionBox.tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB DONE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleJunctionBox.Je_Installed) as [Qty Done]
,0 as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND Je_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblEleJunctionBox.tag) as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and JE_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Scope
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_PULLING as actid, tblInsCableList.Area, 
'LM' as [Measure]
,sum(tblInsCableList.IC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_PULLING,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Pulled
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
where Discipline='IC Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Ins Cable Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction WITH (NOLOCK)
where Discipline='IC Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID, vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_From) 
as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
AND IC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_to) 
as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
AND IC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_From)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_PLAN_P6_ACTID_CONNECT=tblActIDS.ACTID
where Active=1
and tblInsCableList.IC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_To)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
and tblInsCableList.IC_Plan_Connected_Date_to between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_From)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
AND EC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_to)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
AND EC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_From) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
and tblEleCableList.EC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_To) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
and tblEleCableList.EC_Plan_Connected_Date_To between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--Ele Equipment SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,COUNT(tblElectricalEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblElectricalEquipment.Installed_Date) as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
AND Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblElectricalEquipment.Installed_Date) as Weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
and tblElectricalEquipment.Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB SCOPE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB DONE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture SCOPE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.tag) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture DONE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Scope
SELECT DISTINCT 
tblMSCCable.Type as Discipline,'Cable Pulling' as [Activity],
IC_Plan_P6_ActID_Pulling as actid, Area, 
'LM' as [Measure]
,sum(Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMSCCable WITH (NOLOCK)
where active=1
GROUP BY tblMSCCable.Type,IC_Plan_P6_ActID_Pulling,  Area
-----------------------------------------------------------
UNION ALL
--Misc Cable Pulling Pulled
SELECT DISTINCT 
vCblParProductionTotal.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
where Discipline='Msc Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.Type,vCblParProductionTotal.PullingActID, vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Weekly
SELECT DISTINCT 
vCblParProduction.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.qnty) as Weekly
FROM vCblParProduction WITH (NOLOCK)
where Discipline='Msc Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.Type,vCblParProduction.PullingActID,  vCblParProduction.Area
---------------------------------------------------------
UNION ALL
--Cable Tray
SELECT DISTINCT 
Discipline,[Activity],
Actid  
, Area, 
'LM' as [Measure]
,[Scope LM] AS Scope
,[Pulled LM] as [Qty Done]
,[WK Pulled] as Weekly
FROM v_Trays
---------------------------------------------------------
UNION ALL
--Ele Cable Testing SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,COUNT(tblEleCableList.EC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,COUNT(tblInsCableList.IC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblEleCableList.EC_ID) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.EC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblInsCableList.IC_ID) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.IC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblEleCableList.EC_ID) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.EC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsCableList.IC_ID) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.IC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Misc Items SCOPE
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,sum(v_Items.item_scope) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Done
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,sum(v_Items.totalqnty) as [Qty Done]
,0 as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Weekly
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(v_Items.totalqnty) as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,count(tblEleCableList.ec_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.TR_QC_Released) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,count(tblInsCableList.ic_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Done
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.TR_QC_Released) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment QC RELEASED SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,COUNT(tblElectricalEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment QC RELEASED DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblElectricalEquipment.TR_QC_Released) as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
AND TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment QC RELEASED Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblElectricalEquipment.TR_QC_Released) as Weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
and tblElectricalEquipment.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ QC RELEASED SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,COUNT(tblInsEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ QC RELEASED DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsEquipment.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
AND TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ QC RELEASED Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsEquipment.TR_QC_Released) as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
and TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele JB QC RELEASED SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,COUNT(tblEleJunctionBox.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB QC RELEASED DONE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleJunctionBox.JE_TRQC) as [Qty Done]
,0 as weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND JE_TRQC <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB QC RELEASED Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleJunctionBox.JE_TRQC) as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
and tblEleJunctionBox.JE_TRQC between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--INS JB QC RELEASED SCOPE
SELECT DISTINCT 
'Ins' as Discipline,'JB' as [Activity],
JunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, JunctionBox.Area, 
'Each' as [Measure]
,COUNT(JunctionBox.JunctionBox) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM JunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY JunctionBox.IC_Plan_P6_ActID_Install,  JunctionBox.Area
-----------------------------------------------------------
UNION ALL
--INS JB QC RELEASED DONE
SELECT DISTINCT 
'Ins' as Discipline,'JB' as [Activity],
JunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, JunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,count(JunctionBox.JI_TRQC) as [Qty Done]
,0 as weekly
FROM JunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND JI_TRQC <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY JunctionBox.IC_Plan_P6_ActID_Install,  JunctionBox.Area
-----------------------------------------------------------
UNION ALL
--INS JB QC RELEASED Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
JunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, JunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(JunctionBox.JI_TRQC) as Weekly
FROM JunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
and JunctionBox.JI_TRQC between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY JunctionBox.IC_Plan_P6_ActID_Install,  JunctionBox.Area
-----------------------------------------------------------
UNION ALL

--Uni Equipment SCOPE
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEquipment 
where Active=1
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(InstalledDate) as [Qty Done]
,0 as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
AND InstalledDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed Weekly
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
and InstalledDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors SCOPE
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMotor 
where Active=1
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(solo_run_date) as [Qty Done]
,0 as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
AND solo_run_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed Weekly
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
and solo_run_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------

) as v1
) as v2

where [Act ID] is not null

group by 
[Act ID]
) AS vDynamicAvts
inner JOIN tblActIDS
ON tblActIDS.ActID=vDynamicAvts.[Act ID]
inner join 
(
SELECT Area.Area,unit.unit,unit.Block  FROM [Area]
inner join unit
on [Area].Unit=unit.Unit 
) as vBlock
on eica_Area=vblock.Area
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'SP_P6Summary_Est_Vendor'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.SP_P6Summary_Est_Vendor
END
GO
CREATE proc [dbo].[SP_P6Summary_Est_Vendor]
AS
SELECT
vblock.Block,vblock.Unit
,rtrim(PCS_Area) AS [PCS Area]
,EICA_Area
,rtrim(tblActIDS.Family) as Family,rtrim(tblActIDS.SubCon) as SubCon
,tblActIDS.ActName,tblActIDS.ActID,tblActIDS.PCS_Budget
,tblActIDS.EstimatedScope AS EICA_Budget
,tblActIDS.PCS_Budget - tblActIDS.EstimatedScope as Diff
,[Qty Done] as EICA_Done
,tblActIDS.PCSDone AS [PCS Done %]
,weekly as EICA_Weekly
,Scope as [EICA Actual Scope]
FROM
(
select 
[Act ID]
,sum(Scope) as Scope
,sum([Qty Done]) as [Qty Done]
,sum(Weekly) as Weekly
from
(
select 
actid as [Act ID]
,Scope
,[Qty Done]
,Weekly
from
(
--F&G SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Final_Installed_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
AND Final_Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
AND Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
AND Calibration_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Final_Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Calibration_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Hookup SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.HookUp_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
AND HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Hookup_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
AND Hookup_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and HookUp_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + 'QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Hookup_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Ins JB SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'JB' as [Activity],
JUNCTIONBOX.IC_Plan_P6_ActID_Install as actid, JUNCTIONBOX.Area, 
'Each' as [Measure]
,COUNT(JUNCTIONBOX.JUNCTIONBOX) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM JUNCTIONBOX WITH (NOLOCK)
where ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY JUNCTIONBOX.IC_Plan_P6_ActID_Install,  JUNCTIONBOX.Area
-----------------------------------------------------------
UNION ALL
--Ins JB DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'JB' as [Activity],
JUNCTIONBOX.IC_Plan_P6_ActID_Install as actid, JUNCTIONBOX.Area, 
'Each' as [Measure]
,0 AS Scope
,count(JUNCTIONBOX.JI_Installed) as [Qty Done]
,0 as weekly
FROM JUNCTIONBOX WITH (NOLOCK)
where ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND JI_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY JUNCTIONBOX.IC_Plan_P6_ActID_Install,  JUNCTIONBOX.Area
-----------------------------------------------------------
UNION ALL
--Ins JB Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'JB' as [Activity],
JUNCTIONBOX.IC_Plan_P6_ActID_Install as actid, JUNCTIONBOX.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(JUNCTIONBOX.JUNCTIONBOX) as Weekly
FROM JUNCTIONBOX WITH (NOLOCK)
where JI_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY JUNCTIONBOX.IC_Plan_P6_ActID_Install,  JUNCTIONBOX.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,COUNT(tblInsEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsEquipment.Installed_Date) as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsEquipment.TAG) as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Scope
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Pulling as actid, tblEleCableList.Area, 
'LM' as [Measure]
,sum(tblEleCableList.EC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Pulling,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Quantity Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
WHERE Discipline='Ele Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction WITH (NOLOCK)
WHERE Discipline='Ele Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID,  vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ele JB SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,COUNT(tblEleJunctionBox.tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB DONE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleJunctionBox.Je_Installed) as [Qty Done]
,0 as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND Je_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblEleJunctionBox.tag) as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where JE_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Scope
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_PULLING as actid, tblInsCableList.Area, 
'LM' as [Measure]
,sum(tblInsCableList.IC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_PULLING,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Pulled
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
where Discipline='IC Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Ins Cable Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction WITH (NOLOCK)
where Discipline='IC Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID, vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_From) 
as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where IC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_to) 
as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where IC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_From)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_PLAN_P6_ACTID_CONNECT=tblActIDS.ACTID
where tblInsCableList.IC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_To)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where tblInsCableList.IC_Plan_Connected_Date_to between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_From)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where EC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_to)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where EC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_From) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where tblEleCableList.EC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_To) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where tblEleCableList.EC_Plan_Connected_Date_To between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--Ele Equipment SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,COUNT(tblElectricalEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblElectricalEquipment.Installed_Date) as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblElectricalEquipment.Installed_Date) as Weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where tblElectricalEquipment.Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB SCOPE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where tblLightingFixture.LF_Ref_Desc ='Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB DONE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where tblLightingFixture.LF_Ref_Desc ='Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where tblLightingFixture.LF_Ref_Desc ='Lighting JB'
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture SCOPE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.tag) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture DONE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Scope
SELECT DISTINCT 
tblMSCCable.Type as Discipline,'Cable Pulling' as [Activity],
IC_Plan_P6_ActID_Pulling as actid, Area, 
'LM' as [Measure]
,sum(Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMSCCable WITH (NOLOCK)
GROUP BY tblMSCCable.Type,IC_Plan_P6_ActID_Pulling,  Area
-----------------------------------------------------------
UNION ALL
--Misc Cable Pulling Pulled
SELECT DISTINCT 
vCblParProductionTotal.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
where Discipline='Msc Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.Type,vCblParProductionTotal.PullingActID, vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Weekly
SELECT DISTINCT 
vCblParProduction.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.qnty) as Weekly
FROM vCblParProduction WITH (NOLOCK)
where Discipline='Msc Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.Type,vCblParProduction.PullingActID,  vCblParProduction.Area
---------------------------------------------------------
UNION ALL
--Cable Tray
SELECT DISTINCT 
Discipline,[Activity],
Actid  
, Area, 
'LM' as [Measure]
,[Scope LM] AS Scope
,[Pulled LM] as [Qty Done]
,[WK Pulled] as Weekly
FROM v_Trays
---------------------------------------------------------
UNION ALL
--Ele Cable Testing SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,COUNT(tblEleCableList.EC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,COUNT(tblInsCableList.IC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblEleCableList.EC_ID) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where tblEleCableList.EC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblInsCableList.IC_ID) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where tblInsCableList.IC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblEleCableList.EC_ID) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where tblEleCableList.EC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsCableList.IC_ID) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where tblInsCableList.IC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Done
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,sum(v_Items.totalqnty) as [Qty Done]
,0 as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Weekly
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(v_Items.totalqnty) as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,count(tblEleCableList.ec_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.TR_QC_Released) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,count(tblInsCableList.ic_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Done
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.TR_QC_Released) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment QC RELEASED SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,COUNT(tblElectricalEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment QC RELEASED DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblElectricalEquipment.TR_QC_Released) as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
AND TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment QC RELEASED Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblElectricalEquipment.TR_QC_Released) as Weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
and tblElectricalEquipment.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ QC RELEASED SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,COUNT(tblInsEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ QC RELEASED DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsEquipment.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
AND TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ QC RELEASED Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsEquipment.TR_QC_Released) as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
and TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele JB QC RELEASED SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,COUNT(tblEleJunctionBox.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB QC RELEASED DONE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleJunctionBox.JE_TRQC) as [Qty Done]
,0 as weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND JE_TRQC <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB QC RELEASED Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleJunctionBox.JE_TRQC) as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
and tblEleJunctionBox.JE_TRQC between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--INS JB QC RELEASED SCOPE
SELECT DISTINCT 
'Ins' as Discipline,'JB' as [Activity],
JunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, JunctionBox.Area, 
'Each' as [Measure]
,COUNT(JunctionBox.JunctionBox) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM JunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY JunctionBox.IC_Plan_P6_ActID_Install,  JunctionBox.Area
-----------------------------------------------------------
UNION ALL
--INS JB QC RELEASED DONE
SELECT DISTINCT 
'Ins' as Discipline,'JB' as [Activity],
JunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, JunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,count(JunctionBox.JI_TRQC) as [Qty Done]
,0 as weekly
FROM JunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND JI_TRQC <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY JunctionBox.IC_Plan_P6_ActID_Install,  JunctionBox.Area
-----------------------------------------------------------
UNION ALL
--INS JB QC RELEASED Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
JunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, JunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(JunctionBox.JI_TRQC) as Weekly
FROM JunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
and JunctionBox.JI_TRQC between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY JunctionBox.IC_Plan_P6_ActID_Install,  JunctionBox.Area
-----------------------------------------------------------
UNION ALL

--Uni Equipment SCOPE
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEquipment 
where Active=1
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(InstalledDate) as [Qty Done]
,0 as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
AND InstalledDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed Weekly
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
and InstalledDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors SCOPE
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMotor 
where Active=1
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(solo_run_date) as [Qty Done]
,0 as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
AND solo_run_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed Weekly
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
and solo_run_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------

) as v1
) as v2

where [Act ID] is not null

group by 
[Act ID]
) AS vDynamicAvts
inner JOIN tblActIDS
ON tblActIDS.ActID=vDynamicAvts.[Act ID]
inner join 
(
SELECT Area.Area,unit.unit,unit.Block  FROM [Area]
inner join unit
on [Area].Unit=unit.Unit 
) as vBlock
on eica_Area=vblock.Area
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'SP_P6Summary_Est_ver2'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.SP_P6Summary_Est_ver2
END
GO
CREATE Proc [dbo].[SP_P6Summary_Est_ver2]
AS

SELECT
vblock.Block,vblock.Unit
,rtrim(PCS_Area) AS [PCS Area]
,EICA_Area
,rtrim(tblActIDS.Family) as Family,rtrim(tblActIDS.SubCon) as SubCon
,tblActIDS.ActName,tblActIDS.ActID,tblActIDS.PCS_Budget
,tblActIDS.EstimatedScope AS EICA_Budget
,tblActIDS.PCS_Budget - tblActIDS.EstimatedScope as Diff
,[Qty Done] as EICA_Done
,tblActIDS.PCSDone AS [PCS Done %]
,weekly as EICA_Weekly
,Scope as [EICA Actual Scope]
FROM
(
select 
[Act ID]
,sum(Scope) as Scope
,sum([Qty Done]) as [Qty Done]
,sum(Weekly) as Weekly
from
(
select 
actid as [Act ID]
,Scope
,[Qty Done]
,Weekly
from
(
--F&G SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Final_Installed_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND Final_Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
AND Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
AND Calibration_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Final_Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
and Calibration_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Hookup SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.HookUp_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
AND HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Hookup_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
AND Hookup_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and  Active=1
and HookUp_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + 'QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and  Active=1
and Hookup_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Ins JB SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'JB' as [Activity],
JUNCTIONBOX.IC_Plan_P6_ActID_Install as actid, JUNCTIONBOX.Area, 
'Each' as [Measure]
,COUNT(JUNCTIONBOX.JUNCTIONBOX) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM JUNCTIONBOX WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY JUNCTIONBOX.IC_Plan_P6_ActID_Install,  JUNCTIONBOX.Area
-----------------------------------------------------------
UNION ALL
--Ins JB DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'JB' as [Activity],
JUNCTIONBOX.IC_Plan_P6_ActID_Install as actid, JUNCTIONBOX.Area, 
'Each' as [Measure]
,0 AS Scope
,count(JUNCTIONBOX.JI_Installed) as [Qty Done]
,0 as weekly
FROM JUNCTIONBOX WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND JI_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY JUNCTIONBOX.IC_Plan_P6_ActID_Install,  JUNCTIONBOX.Area
-----------------------------------------------------------
UNION ALL
--Ins JB Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'JB' as [Activity],
JUNCTIONBOX.IC_Plan_P6_ActID_Install as actid, JUNCTIONBOX.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(JUNCTIONBOX.JUNCTIONBOX) as Weekly
FROM JUNCTIONBOX WITH (NOLOCK)
where Active=1
and JI_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY JUNCTIONBOX.IC_Plan_P6_ActID_Install,  JUNCTIONBOX.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,COUNT(tblInsEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsEquipment.Installed_Date) as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
AND Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsEquipment.TAG) as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
and Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele JB SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,COUNT(tblEleJunctionBox.tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB DONE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleJunctionBox.Je_Installed) as [Qty Done]
,0 as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND Je_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblEleJunctionBox.tag) as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and JE_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_From) 
as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
AND IC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_to) 
as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
AND IC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_From)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_PLAN_P6_ACTID_CONNECT=tblActIDS.ACTID
where Active=1
and tblInsCableList.IC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_To)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
and tblInsCableList.IC_Plan_Connected_Date_to between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_From)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
AND EC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_to)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
AND EC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_From) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
and tblEleCableList.EC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_To) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
and tblEleCableList.EC_Plan_Connected_Date_To between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--Ele Equipment SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,COUNT(tblElectricalEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblElectricalEquipment.Installed_Date) as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
AND Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblElectricalEquipment.Installed_Date) as Weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
and tblElectricalEquipment.Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB SCOPE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB DONE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture SCOPE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.tag) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture DONE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Scope
SELECT DISTINCT 
tblMSCCable.Type as Discipline,'Cable Pulling' as [Activity],
IC_Plan_P6_ActID_Pulling as actid, Area, 
'LM' as [Measure]
,sum(Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMSCCable WITH (NOLOCK)
where active=1
GROUP BY tblMSCCable.Type,IC_Plan_P6_ActID_Pulling,  Area
-----------------------------------------------------------
UNION ALL
--Misc Cable Pulling Pulled
SELECT DISTINCT 
vCblParProductionTotal.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
where Discipline='Msc Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.Type,vCblParProductionTotal.PullingActID, vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Weekly
SELECT DISTINCT 
vCblParProduction.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.qnty) as Weekly
FROM vCblParProduction WITH (NOLOCK)
where Discipline='Msc Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.Type,vCblParProduction.PullingActID,  vCblParProduction.Area
---------------------------------------------------------
UNION ALL
--Cable Tray
SELECT DISTINCT 
Discipline,[Activity],
Actid  
, Area, 
'LM' as [Measure]
,[Scope LM] AS Scope
,[Pulled LM] as [Qty Done]
,[WK Pulled] as Weekly
FROM v_Trays
---------------------------------------------------------
UNION ALL
--Ele Cable Testing SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,COUNT(tblEleCableList.EC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,COUNT(tblInsCableList.IC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblEleCableList.EC_ID) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.EC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblInsCableList.IC_ID) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.IC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblEleCableList.EC_ID) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.EC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsCableList.IC_ID) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.IC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Misc Items SCOPE
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,sum(v_Items.item_scope) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Done
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,sum(v_Items.totalqnty) as [Qty Done]
,0 as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Weekly
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(v_Items.totalqnty) as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,count(tblEleCableList.ec_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.TR_QC_Released) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,count(tblInsCableList.ic_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Done
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.TR_QC_Released) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment QC RELEASED SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,COUNT(tblElectricalEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment QC RELEASED DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblElectricalEquipment.TR_QC_Released) as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
AND TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment QC RELEASED Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblElectricalEquipment.TR_QC_Released) as Weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
and tblElectricalEquipment.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ QC RELEASED SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,COUNT(tblInsEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ QC RELEASED DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsEquipment.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
AND TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ QC RELEASED Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsEquipment.TR_QC_Released) as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
and TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele JB QC RELEASED SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,COUNT(tblEleJunctionBox.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB QC RELEASED DONE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleJunctionBox.JE_TRQC) as [Qty Done]
,0 as weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND JE_TRQC <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB QC RELEASED Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleJunctionBox.JE_TRQC) as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
and tblEleJunctionBox.JE_TRQC between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--INS JB QC RELEASED SCOPE
SELECT DISTINCT 
'Ins' as Discipline,'JB' as [Activity],
JunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, JunctionBox.Area, 
'Each' as [Measure]
,COUNT(JunctionBox.JunctionBox) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM JunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY JunctionBox.IC_Plan_P6_ActID_Install,  JunctionBox.Area
-----------------------------------------------------------
UNION ALL
--INS JB QC RELEASED DONE
SELECT DISTINCT 
'Ins' as Discipline,'JB' as [Activity],
JunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, JunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,count(JunctionBox.JI_TRQC) as [Qty Done]
,0 as weekly
FROM JunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND JI_TRQC <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY JunctionBox.IC_Plan_P6_ActID_Install,  JunctionBox.Area
-----------------------------------------------------------
UNION ALL
--INS JB QC RELEASED Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
JunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, JunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(JunctionBox.JI_TRQC) as Weekly
FROM JunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
and JunctionBox.JI_TRQC between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY JunctionBox.IC_Plan_P6_ActID_Install,  JunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Scope
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Pulling as actid, tblEleCableList.Area, 
'LM' as [Measure]
,sum(tblEleCableList.EC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Pulling,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Quantity Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal
WHERE Discipline='Ele Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction
WHERE Discipline='Ele Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID,  vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Scope
SELECT DISTINCT 
'Instrumentation' as Discipline,tblInsCableList.IC_Type + ' - Cable Pulling' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_PULLING as actid, tblInsCableList.Area, 
'LM' as [Measure]
,sum(tblInsCableList.IC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList
where Active=1
GROUP BY tblInsCableList.IC_Type,tblInsCableList.IC_PLAN_P6_ACTID_PULLING,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Pulled
SELECT DISTINCT 
'Instrumentation' as Discipline,vCblParProductionTotal.type + ' - Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal
where Discipline='IC Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.type,vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Ins Cable Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,vCblParProduction.type + ' - Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction
where Discipline='IC Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.type,vCblParProduction.PullingActID, vCblParProduction.Area
-----------------------------------------------------------
UNION ALL

--Uni Equipment SCOPE
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEquipment 
where Active=1
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(InstalledDate) as [Qty Done]
,0 as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
AND InstalledDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed Weekly
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
and InstalledDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors SCOPE
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMotor 
where Active=1
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(solo_run_date) as [Qty Done]
,0 as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
AND solo_run_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed Weekly
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
and solo_run_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------

) as v1
) as v2

where [Act ID] is not null

group by 
[Act ID]
) AS vDynamicAvts
inner JOIN tblActIDS
ON tblActIDS.ActID=vDynamicAvts.[Act ID]
inner join 
(
SELECT Area.Area,unit.unit,unit.Block  FROM [Area]
inner join unit
on [Area].Unit=unit.Unit 
) as vBlock
on eica_Area=vblock.Area
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'SP_P6Summary_Est2'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.SP_P6Summary_Est2
END
GO
CREATE Proc [dbo].[SP_P6Summary_Est2]
AS
SELECT
tblActIDS.Team,tblActIDS.PCS_Area,tblActIDS.UOM,tblActIDS.ResourceName
,rtrim(PCS_Area) AS [PCS Area]
,EICA_Area
,tblActIDS.ResourceId, tblActIDS.ResourceName, tblActIDS.UOM
,rtrim(tblActIDS.Family) as Family,rtrim(tblActIDS.SubCon) as SubCon
,tblActIDS.ActName,tblActIDS.ActID,tblActIDS.PCS_Budget
,tblActIDS.EstimatedScope AS EICA_Budget
,tblActIDS.PCS_Budget - tblActIDS.EstimatedScope as Diff
,[Qty Done] as EICA_Done
,tblActIDS.PCSDone AS [PCS Done %]
,weekly as EICA_Weekly
,Scope as [EICA Actual Scope]
FROM
(
select 
[Act ID]
,sum(Scope) as Scope
,sum([Qty Done]) as [Qty Done]
,sum(Weekly) as Weekly
from
(
select 
actid as [Act ID]
,Scope
,[Qty Done]
,Weekly
from
(
--F&G SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Final_Installed_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND Final_Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
AND Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
AND Calibration_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Final_Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
and Calibration_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Hookup SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.HookUp_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
AND HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Hookup_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
AND Hookup_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and  Active=1
and HookUp_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + 'QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and  Active=1
and Hookup_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Ins JB SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'JB' as [Activity],
JUNCTIONBOX.IC_Plan_P6_ActID_Install as actid, JUNCTIONBOX.Area, 
'Each' as [Measure]
,COUNT(JUNCTIONBOX.JUNCTIONBOX) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM JUNCTIONBOX WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY JUNCTIONBOX.IC_Plan_P6_ActID_Install,  JUNCTIONBOX.Area
-----------------------------------------------------------
UNION ALL
--Ins JB DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'JB' as [Activity],
JUNCTIONBOX.IC_Plan_P6_ActID_Install as actid, JUNCTIONBOX.Area, 
'Each' as [Measure]
,0 AS Scope
,count(JUNCTIONBOX.JI_Installed) as [Qty Done]
,0 as weekly
FROM JUNCTIONBOX WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND JI_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY JUNCTIONBOX.IC_Plan_P6_ActID_Install,  JUNCTIONBOX.Area
-----------------------------------------------------------
UNION ALL
--Ins JB Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'JB' as [Activity],
JUNCTIONBOX.IC_Plan_P6_ActID_Install as actid, JUNCTIONBOX.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(JUNCTIONBOX.JUNCTIONBOX) as Weekly
FROM JUNCTIONBOX WITH (NOLOCK)
where Active=1
and JI_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY JUNCTIONBOX.IC_Plan_P6_ActID_Install,  JUNCTIONBOX.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,COUNT(tblInsEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsEquipment.Installed_Date) as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
AND Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsEquipment.TAG) as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
and Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Scope
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Pulling as actid, tblEleCableList.Area, 
'LM' as [Measure]
,sum(tblEleCableList.EC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Pulling,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Quantity Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
WHERE Discipline='Ele Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction WITH (NOLOCK)
WHERE Discipline='Ele Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID,  vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ele JB SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,COUNT(tblEleJunctionBox.tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB DONE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleJunctionBox.Je_Installed) as [Qty Done]
,0 as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND Je_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblEleJunctionBox.tag) as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and JE_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Scope
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_PULLING as actid, tblInsCableList.Area, 
'LM' as [Measure]
,sum(tblInsCableList.IC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_PULLING,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Pulled
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
where Discipline='IC Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Ins Cable Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction WITH (NOLOCK)
where Discipline='IC Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID, vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_From) 
as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
AND IC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_to) 
as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
AND IC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_From)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_PLAN_P6_ACTID_CONNECT=tblActIDS.ACTID
where Active=1
and tblInsCableList.IC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_To)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
and tblInsCableList.IC_Plan_Connected_Date_to between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_From)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
AND EC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_to)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
AND EC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_From) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
and tblEleCableList.EC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_To) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
and tblEleCableList.EC_Plan_Connected_Date_To between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--Ele Equipment SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,COUNT(tblElectricalEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblElectricalEquipment.Installed_Date) as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
AND Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblElectricalEquipment.Installed_Date) as Weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
and tblElectricalEquipment.Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB SCOPE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB DONE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture SCOPE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.tag) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture DONE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Scope
SELECT DISTINCT 
tblMSCCable.Type as Discipline,'Cable Pulling' as [Activity],
IC_Plan_P6_ActID_Pulling as actid, Area, 
'LM' as [Measure]
,sum(Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMSCCable WITH (NOLOCK)
where active=1
GROUP BY tblMSCCable.Type,IC_Plan_P6_ActID_Pulling,  Area
-----------------------------------------------------------
UNION ALL
--Misc Cable Pulling Pulled
SELECT DISTINCT 
vCblParProductionTotal.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
where Discipline='Msc Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.Type,vCblParProductionTotal.PullingActID, vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Weekly
SELECT DISTINCT 
vCblParProduction.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.qnty) as Weekly
FROM vCblParProduction WITH (NOLOCK)
where Discipline='Msc Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.Type,vCblParProduction.PullingActID,  vCblParProduction.Area
---------------------------------------------------------
UNION ALL
--Cable Tray
SELECT DISTINCT 
Discipline,[Activity],
Actid  
, Area, 
'LM' as [Measure]
,[Scope LM] AS Scope
,[Pulled LM] as [Qty Done]
,[WK Pulled] as Weekly
FROM v_Trays
---------------------------------------------------------
UNION ALL
--Ele Cable Testing SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,COUNT(tblEleCableList.EC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,COUNT(tblInsCableList.IC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblEleCableList.EC_ID) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.EC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblInsCableList.IC_ID) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.IC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblEleCableList.EC_ID) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.EC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsCableList.IC_ID) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.IC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Misc Items SCOPE
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,sum(v_Items.item_scope) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Done
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,sum(v_Items.totalqnty) as [Qty Done]
,0 as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Weekly
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(v_Items.totalqnty) as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,count(tblEleCableList.ec_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.TR_QC_Released) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,count(tblInsCableList.ic_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Done
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.TR_QC_Released) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment QC RELEASED SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,COUNT(tblElectricalEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment QC RELEASED DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblElectricalEquipment.TR_QC_Released) as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
AND TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment QC RELEASED Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblElectricalEquipment.TR_QC_Released) as Weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
and tblElectricalEquipment.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ QC RELEASED SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,COUNT(tblInsEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ QC RELEASED DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsEquipment.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
AND TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ QC RELEASED Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsEquipment.TR_QC_Released) as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
and TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele JB QC RELEASED SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,COUNT(tblEleJunctionBox.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB QC RELEASED DONE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleJunctionBox.JE_TRQC) as [Qty Done]
,0 as weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND JE_TRQC <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB QC RELEASED Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleJunctionBox.JE_TRQC) as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
and tblEleJunctionBox.JE_TRQC between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--INS JB QC RELEASED SCOPE
SELECT DISTINCT 
'Ins' as Discipline,'JB' as [Activity],
JunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, JunctionBox.Area, 
'Each' as [Measure]
,COUNT(JunctionBox.JunctionBox) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM JunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY JunctionBox.IC_Plan_P6_ActID_Install,  JunctionBox.Area
-----------------------------------------------------------
UNION ALL
--INS JB QC RELEASED DONE
SELECT DISTINCT 
'Ins' as Discipline,'JB' as [Activity],
JunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, JunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,count(JunctionBox.JI_TRQC) as [Qty Done]
,0 as weekly
FROM JunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND JI_TRQC <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY JunctionBox.IC_Plan_P6_ActID_Install,  JunctionBox.Area
-----------------------------------------------------------
UNION ALL
--INS JB QC RELEASED Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
JunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, JunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(JunctionBox.JI_TRQC) as Weekly
FROM JunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
and JunctionBox.JI_TRQC between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY JunctionBox.IC_Plan_P6_ActID_Install,  JunctionBox.Area
-----------------------------------------------------------
UNION ALL

--Uni Equipment SCOPE
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEquipment 
where Active=1
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(InstalledDate) as [Qty Done]
,0 as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
AND InstalledDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed Weekly
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
and InstalledDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors SCOPE
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMotor 
where Active=1
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(solo_run_date) as [Qty Done]
,0 as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
AND solo_run_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed Weekly
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
and solo_run_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------

) as v1
) as v2

where [Act ID] is not null

group by 
[Act ID]
) AS vDynamicAvts
inner JOIN tblActIDS
ON tblActIDS.ActID=vDynamicAvts.[Act ID]
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'sp_p6summary2'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.sp_p6summary2
END
GO
CREATE proc [dbo].[sp_p6summary2]
as
SELECT
Discipline
,[Activity]
,PCS_Area
,sum(PCS_Budget) as PCS_Budget
,sum(EICA_Budget) as EICA_Budget
,sum(PCS_Budget) - sum(EICA_Budget) as Diff
,sum(EICA_Done) as EICA_Done
,sum([PCS Done %])/count([PCS Done %]) as [PCS Done %]

FROM
(
SELECT
Discipline
,[Activity]
,PCS_Area
,tblActIDS.Family
,tblActIDS.PCS_Budget
,Scope AS EICA_Budget
,tblActIDS.PCS_Budget - Scope as Diff
,[Qty Done] as EICA_Done
,tblActIDS.PCSDone AS [PCS Done %]
,weekly as EICA_Weekly
FROM
(
select 
Discipline,[Activity]
,[Act ID]
,sum(Scope) as Scope
,sum([Qty Done]) as [Qty Done]
,sum(Weekly) as Weekly
from
(
select 
Discipline,[Activity]
,actid as [Act ID]
,Scope
,[Qty Done]
,Weekly
from
(
--Instrument SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument in ('instrument','Building_FG')
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument in ('instrument','Building_FG')
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Final_Installed_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND Final_Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Calibration_Type='yes'
and Active=1
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Calibration_Type='yes'
and Active=1
AND Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
AND Calibration_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments 
where Instrument in ('instrument','Building_FG')
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Final_Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments 
where Calibration_Type='yes'
and Active=1
and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
and Calibration_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Hookup SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments
where hookup_name is not null
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.HookUp_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments
where hookup_name is not null
and Active=1
AND HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Hookup_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
AND Hookup_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments
where hookup_name is not null
and  Active=1
and HookUp_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + 'QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and  Active=1
and Hookup_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Ins JB SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'JB' as [Activity],
JUNCTIONBOX.IC_Plan_P6_ActID_Install as actid, JUNCTIONBOX.Area, 
'Each' as [Measure]
,COUNT(JUNCTIONBOX.JUNCTIONBOX) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM JUNCTIONBOX
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY JUNCTIONBOX.IC_Plan_P6_ActID_Install,  JUNCTIONBOX.Area
-----------------------------------------------------------
UNION ALL
--Ins JB DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'JB' as [Activity],
JUNCTIONBOX.IC_Plan_P6_ActID_Install as actid, JUNCTIONBOX.Area, 
'Each' as [Measure]
,0 AS Scope
,count(JUNCTIONBOX.JI_Installed) as [Qty Done]
,0 as weekly
FROM JUNCTIONBOX
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND JI_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY JUNCTIONBOX.IC_Plan_P6_ActID_Install,  JUNCTIONBOX.Area
-----------------------------------------------------------
UNION ALL
--Ins JB Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'JB' as [Activity],
JUNCTIONBOX.IC_Plan_P6_ActID_Install as actid, JUNCTIONBOX.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(JUNCTIONBOX.JUNCTIONBOX) as Weekly
FROM JUNCTIONBOX
where Active=1
and JI_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY JUNCTIONBOX.IC_Plan_P6_ActID_Install,  JUNCTIONBOX.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,COUNT(tblInsEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsEquipment
where Active=1
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsEquipment.Installed_Date) as [Qty Done]
,0 as Weekly
FROM tblInsEquipment
where Active=1
AND Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsEquipment.TAG) as Weekly
FROM tblInsEquipment
where Active=1
and Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Scope
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Pulling as actid, tblEleCableList.Area, 
'LM' as [Measure]
,sum(tblEleCableList.EC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Pulling,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Quantity Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal
WHERE Discipline='Ele Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction
WHERE Discipline='Ele Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID,  vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ele JB SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,je_type as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,COUNT(tblEleJunctionBox.tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleJunctionBox
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY je_type,tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB DONE
SELECT DISTINCT 
'Electrical' as Discipline,je_type as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleJunctionBox.Je_Installed) as [Qty Done]
,0 as Weekly
FROM tblEleJunctionBox
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND Je_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY je_type,tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB Weekly
SELECT DISTINCT 
'Electrical' as Discipline,je_type as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblEleJunctionBox.tag) as Weekly
FROM tblEleJunctionBox
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
and JE_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY je_type,tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Scope
SELECT DISTINCT 
'Instrumentation' as Discipline,tblInsCableList.IC_Type + ' - Cable Pulling' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_PULLING as actid, tblInsCableList.Area, 
'LM' as [Measure]
,sum(tblInsCableList.IC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList
where Active=1
GROUP BY tblInsCableList.IC_Type,tblInsCableList.IC_PLAN_P6_ACTID_PULLING,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Pulled
SELECT DISTINCT 
'Instrumentation' as Discipline,vCblParProductionTotal.type + ' - Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal
where Discipline='IC Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.type,vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Ins Cable Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,vCblParProduction.type + ' - Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction
where Discipline='IC Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.type,vCblParProduction.PullingActID, vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS SCOPE
SELECT  
'Instrumentation' as Discipline,v_ICConn.ic_type + ' - Cable Connection' as [Activity],
v_ICConn.actid as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,count(v_ICConn.ACTID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM v_ICConn
INNER JOIN tblActIDS
ON v_ICConn.actid=tblActIDS.ACTID
GROUP BY v_ICConn.ic_type,v_ICConn.actid,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS DONE
SELECT  
'Instrumentation' as Discipline,v_ICConn.ic_type + ' - Cable Connection' as [Activity],
v_ICConn.actid as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,count(v_ICConn.conndate) 
as [Qty Done]
,0 as Weekly
FROM v_ICConn
INNER JOIN tblActIDS
ON v_ICConn.actid=tblActIDS.ACTID
AND ConnDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_ICConn.ic_type,v_ICConn.actid,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS wEEKLY
SELECT  
'Instrumentation' as Discipline,v_ICConn.ic_type + ' - Cable Connection' as [Activity],
v_ICConn.actid as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(v_ICConn.conndate)  as Weekly
FROM v_ICConn
INNER JOIN tblActIDS
ON v_ICConn.actid=tblActIDS.ACTID
where v_ICConn.conndate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_ICConn.ic_type,v_ICConn.actid,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS SCOPE
SELECT  
'Electrical' as Discipline,'Cable Connection' as [Activity],
v_ECConn.ACTID as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(v_ECConn.ACTID) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM v_ECConn
INNER JOIN tblActIDS
ON v_ECConn.ACTID=tblActIDS.ACTID
GROUP BY v_ECConn.ec_type,v_ECConn.ACTID,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS DONE
SELECT  
'Electrical' as Discipline,'Cable Connection' as [Activity],
v_ECConn.ACTID as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(v_ECConn.CONNDATE)
as [Qty Done]
,0 as weekly
FROM v_ECConn
INNER JOIN tblActIDS
ON v_ECConn.ACTID=tblActIDS.ACTID
AND v_ECConn.CONNDATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_ECConn.ec_type,v_ECConn.ACTID,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS Weekly
SELECT  
'Electrical' as Discipline,'Cable Connection' as [Activity],
v_ECConn.ACTID as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(v_ECConn.CONNDATE) as Weekly
FROM v_ECConn
INNER JOIN tblActIDS
ON v_ECConn.ACTID=tblActIDS.ACTID
where v_ECConn.CONNDATE between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_ECConn.ec_type,v_ECConn.ACTID,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblElectricalEquipment.Installed_Date) as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment
where Active=1
AND Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblElectricalEquipment.Installed_Date) as Weekly
FROM tblElectricalEquipment
where Active=1
and tblElectricalEquipment.Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB SCOPE 
SELECT DISTINCT 
'Lighting' as Discipline,'JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB DONE 
SELECT DISTINCT 
'Lighting' as Discipline,'JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture SCOPE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.tag) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture
where Active=1
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture DONE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture
where Active=1
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture
where Active=1
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Scope
SELECT DISTINCT 
tblMSCCable.Type as Discipline,'Cable Pulling' as [Activity],
IC_Plan_P6_ActID_Pulling as actid, Area, 
'LM' as [Measure]
,sum(Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMSCCable
where active=1
GROUP BY tblMSCCable.Type,IC_Plan_P6_ActID_Pulling,  Area
-----------------------------------------------------------
UNION ALL
--Misc Cable Pulling Pulled
SELECT DISTINCT 
vCblParProductionTotal.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal
where Discipline='Msc Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.Type,vCblParProductionTotal.PullingActID, vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Weekly
SELECT DISTINCT 
vCblParProduction.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.qnty) as Weekly
FROM vCblParProduction
where Discipline='Msc Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.Type,vCblParProduction.PullingActID,  vCblParProduction.Area
---------------------------------------------------------
UNION ALL
--Cable Tray
SELECT DISTINCT 
Discipline,[Activity],
Actid  
, Area, 
'LM' as [Measure]
,[Scope LM] AS Scope
,[Pulled LM] as [Qty Done]
,[WK Pulled] as Weekly
FROM v_Trays
---------------------------------------------------------
UNION ALL
--Ele Cable Testing Scope
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,COUNT(tblEleCableList.EC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Scope
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,COUNT(tblInsCableList.IC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblEleCableList.EC_ID) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.EC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblInsCableList.IC_ID) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.IC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblEleCableList.EC_ID) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.EC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsCableList.IC_ID) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.IC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Done
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,sum(v_Items.totalqnty) as [Qty Done]
,0 as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Weekly
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(v_Items.totalqnty) as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,count(tblEleCableList.ec_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.TR_QC_Released) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,count(tblInsCableList.ic_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Done
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.TR_QC_Released) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment QC RELEASED SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,COUNT(tblElectricalEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment QC RELEASED DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblElectricalEquipment.TR_QC_Released) as [Qty Done]
,0 as weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
AND TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele Equipment QC RELEASED Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblElectricalEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblElectricalEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblElectricalEquipment.TR_QC_Released) as Weekly
FROM tblElectricalEquipment WITH (NOLOCK)
where Active=1
and tblElectricalEquipment.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblElectricalEquipment.IC_Plan_P6_ActID_Install,  tblElectricalEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ QC RELEASED SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,COUNT(tblInsEquipment.TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ QC RELEASED DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsEquipment.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
AND TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ins EQ QC RELEASED Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Equipment' as [Activity],
tblInsEquipment.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInsEquipment.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsEquipment.TR_QC_Released) as Weekly
FROM tblInsEquipment WITH (NOLOCK)
where Active=1
and TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsEquipment.IC_Plan_P6_ActID_Install,  tblInsEquipment.Area
-----------------------------------------------------------
UNION ALL
--Ele JB QC RELEASED SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,COUNT(tblEleJunctionBox.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB QC RELEASED DONE
SELECT DISTINCT 
'Electrical' as Discipline,'JB' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleJunctionBox.JE_TRQC) as [Qty Done]
,0 as weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND JE_TRQC <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--Ele JB QC RELEASED Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
tblEleJunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, tblEleJunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleJunctionBox.JE_TRQC) as Weekly
FROM tblEleJunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
and tblEleJunctionBox.JE_TRQC between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleJunctionBox.IC_Plan_P6_ActID_Install,  tblEleJunctionBox.Area
-----------------------------------------------------------
UNION ALL
--INS JB QC RELEASED SCOPE
SELECT DISTINCT 
'Ins' as Discipline,'JB' as [Activity],
JunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, JunctionBox.Area, 
'Each' as [Measure]
,COUNT(JunctionBox.JunctionBox) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM JunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
GROUP BY JunctionBox.IC_Plan_P6_ActID_Install,  JunctionBox.Area
-----------------------------------------------------------
UNION ALL
--INS JB QC RELEASED DONE
SELECT DISTINCT 
'Ins' as Discipline,'JB' as [Activity],
JunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, JunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,count(JunctionBox.JI_TRQC) as [Qty Done]
,0 as weekly
FROM JunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
AND JI_TRQC <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY JunctionBox.IC_Plan_P6_ActID_Install,  JunctionBox.Area
-----------------------------------------------------------
UNION ALL
--INS JB QC RELEASED Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Equipment' as [Activity],
JunctionBox.IC_Plan_P6_ActID_Install + '-QC' as actid, JunctionBox.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(JunctionBox.JI_TRQC) as Weekly
FROM JunctionBox WITH (NOLOCK)
where Active=1
and ((Furnished_By = 'vendor loose') or (Furnished_By is null))
and JunctionBox.JI_TRQC between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY JunctionBox.IC_Plan_P6_ActID_Install,  JunctionBox.Area
-----------------------------------------------------------
UNION ALL

--Uni Equipment SCOPE
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEquipment 
where Active=1
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(InstalledDate) as [Qty Done]
,0 as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
AND InstalledDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed Weekly
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
and InstalledDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors SCOPE
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMotor 
where Active=1
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(solo_run_date) as [Qty Done]
,0 as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
AND solo_run_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed Weekly
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
and solo_run_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------

) as v1
) as v2

where [Act ID] is not null
and [Act ID] <> ''
group by 
Discipline,[Activity],[Act ID]
) AS vDynamicAvts
inner JOIN tblActIDS
ON tblActIDS.ActID=vDynamicAvts.[Act ID]
inner join 
(
SELECT Area.Area,unit.unit,unit.Block  FROM [Area]
inner join unit
on [Area].Unit=unit.Unit 
) as vBlock
on eica_Area=vblock.Area
) as VSum
WHERE [Activity]<>'Cable Connection2'
group by
Discipline,[Activity],PCS_Area

order by Discipline,[Activity],PCS_Area
GO
IF NOT EXISTS(SELECT 1 FROM sys.columns 
          WHERE Name = N'PDSModel'
          AND Object_ID = Object_ID(N'dbo.tblActIDS'))
BEGIN
    ALTER TABLE tblActIDS
    ADD PDSModel NVARCHAR(250) NULL
END
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetActivities'
			AND schema_id = (select schema_id from sys.schemas where name = 'PLANNING')
			)
BEGIN
	DROP PROC PLANNING.GetActivities
END
GO
CREATE PROC [PLANNING].[GetActivities]
AS
SELECT
CASE WHEN [EICA_Budget] <> [Last_EICABudget] THEN 'Changed' END AS 'Budget Status',
CASE WHEN [EICA_Done] <> [Last_EICADone] THEN 'Changed' END AS 'Qnty Done Status',
[TBL_ID] AS Id,[ActID],[ActName],[PCS_Area] AS [PCS Area],[SubCon],[PCS_Budget] AS [PCS Budget],[Family],[EICA_Area] AS [EICA Area],[EICA_Budget] AS [EICA Budget],
[EICA_Done] AS [Done],[Package],[Last_EICABudget],[Last_EICADone],[EstimatedScope],[KeyQnty],[wps],
[ResourceId],[ResourceName],[Location],[StartDate],[EndDate],[UOM],[Team], PDSModel
FROM tblActIDs
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetEquipment'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.GetEquipment
END
GO
CREATE PROC [CONSTRUCTION].[GetEquipment]
AS

SELECT
VALL.Discipline,VALL.[Type],VALL.Subtype,VALL.Area,VALL.Subsystem,VALL.Tag,VALL.[Description],
VALL.ActId,tblActIDS.ActName,tblActIDS.SubCon AS [Act Subcon],
VALL.[Installed Date],VALL.[QC Released Date],VALL.RFINumber,VALL.[Installation Scope],
VALL.PDSModel,VALL.Team,VALL.[Status],VALL.Id,
CASE WHEN Res.ItemId IS NOT NULL THEN 'Yes' ELSE 'No' END AS [Resource]
FROM (
    SELECT 
    Discipline,[Type],Subtype,
    [Area],[Subsystem],Tag
    ,[Description]
    ,[ActId]
    ,InstalledDate AS [Installed Date]
    ,QCDate AS [QC Released Date]
    ,RFINumber
    ,NULL AS [Installation Scope]
    ,PDSModel
    ,[Team]
    ,eqId AS Id
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM tblEquipment WITH (NOLOCK)
) AS VALL
LEFT JOIN tblActIDS ON VALL.ActId = tblActIDS.ActID
LEFT JOIN (SELECT [ItemId] FROM [dbo].[tblResourcesItem] WITH (NOLOCK) WHERE GroupId = 500) AS Res ON VALL.Id = Res.ItemId
OPTION (USE HINT ('DISABLE_ROW_MODE_MEMORY_GRANT_FEEDBACK'))
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetEquipmentMini'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.GetEquipmentMini
END
GO
CREATE PROC [CONSTRUCTION].[GetEquipmentMini]
AS
    SELECT 
    Discipline,[Type],Subtype,
    [Area],[Subsystem],Tag
    ,[Description]
    ,[ActId]
    ,InstalledDate AS [Installed Date]
    ,QCDate AS [QC Released Date]
    ,RFINumber
    ,NULL AS [Installation Scope]
    ,PDSModel
    ,[Team]
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM tblEquipment WITH (NOLOCK)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetCablesFull'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.GetCablesFull
END
GO
CREATE PROC [CONSTRUCTION].[GetCablesFull]
AS
WITH Equipment AS (
    SELECT 
    Tag,Area
    ,PDSModel
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM tblEquipment WITH (NOLOCK)

    UNION ALL

    SELECT 
    Instrument_Tag AS Tag,Area
    ,PDSModel
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM tblInstruments WITH (NOLOCK)

    UNION ALL

    SELECT 
    TAG,Area
    ,PDSModel
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM tblLightingFixture WITH (NOLOCK)
), ElePro AS (
    SELECT Tag, SUM(TotalPercentage) AS TotalPercentage, MAX(LastUpdated) AS LastUpdated, SUM(Weekly) AS Weekly
    FROM (
        SELECT 
            [Tag]
            ,[Per_Qnty] AS TotalPercentage
            ,[Pro_Date] AS LastUpdated
            ,CASE WHEN pro_Date BETWEEN DATEADD(DAY, -6, (SELECT tblTMP.tmp_date FROM tblTmp WHERE tblTMP.tmp_id = 1)) AND (SELECT tblTMP.tmp_date FROM tblTmp WHERE tblTMP.tmp_id = 1) THEN Per_Qnty ELSE 0 END AS Weekly
        FROM [tblEleCableProduction] WITH (NOLOCK)
    ) AS VEC
    GROUP BY Tag
), InsPro AS (
    SELECT Tag, SUM(TotalPercentage) AS TotalPercentage, MAX(LastUpdated) AS LastUpdated, SUM(Weekly) AS Weekly
    FROM(
        SELECT 
            [Tag]
            ,[Per_Qnty] AS TotalPercentage
            ,[Pro_Date] AS LastUpdated
            ,CASE WHEN pro_Date BETWEEN DATEADD(DAY, -6, (SELECT tblTMP.tmp_date FROM tblTmp WHERE tblTMP.tmp_id = 1)) AND (SELECT tblTMP.tmp_date FROM tblTmp WHERE tblTMP.tmp_id = 1) THEN Per_Qnty ELSE 0 END AS Weekly
        FROM [tblInsCableProduction] WITH (NOLOCK)
    ) AS VIC
    GROUP BY Tag
), ActId AS (
    SELECT [ActID],[ActName],[SubCon],[Family],[EICA_Area],[Team],[StartDate],[EndDate] FROM [tblActIDS] WITH (NOLOCK)
)


SELECT DISTINCT
EC.Discipline,EC.[Area],[EC_Type] AS [Type],[EC_ID] AS Tag,[EC_Length] AS [Length],[EC_Description] AS [Description],Routing
,EC.[SubSystem]
,[EC_From] AS [From],[From_Description] AS [From Description], EqFrom.Area AS [Eq From Area], EqFrom.PDSModel AS [Eq From PDSModel], EqFrom.[Status] AS [Eq From Status]
,[EC_To] AS [To],[To_Description] AS [To Description], EqTo.Area AS [Eq To Area], EqTo.PDSModel AS [Eq To PDSModel], EqTo.[Status] AS [Eq To Status]
,Drawing

,[EC_Plan_P6_ActID_Pulling] AS [Pulling ActId], PullAct.ActName AS [Pulling ActName],PullAct.EICA_Area AS [Pulling Act Area],PullAct.Family AS [Pulling Act Family],PullAct.SubCon AS [Pulling Act Subcon],PullAct.Team AS [Pulling Act Team],PullAct.StartDate AS [Pulling Act StartDate],PullAct.EndDate AS [Pulling Act EndDate]
,[EC_Plan_P6_ActID_Connect] AS [Con From ActId], ConFromAct.ActName AS [ConFrom ActName],ConFromAct.EICA_Area AS [ConFrom Act Area],ConFromAct.Family AS [ConFrom Act Family],ConFromAct.SubCon AS [ConFrom Act Subcon],ConFromAct.Team AS [ConFrom Act Team],ConFromAct.StartDate AS [ConFrom Act StartDate],ConFromAct.EndDate AS [ConFrom Act EndDate]
,[EC_Plan_P6_ActID_Connect_2] AS [Con To ActId], ConToAct.ActName AS [ConTo ActName],ConToAct.EICA_Area AS [ConTo Act Area],ConToAct.Family AS [ConTo Act Family],ConToAct.SubCon AS [ConTo Act Subcon],ConToAct.Team AS [ConTo Act Team],ConToAct.StartDate AS [ConTo Act StartDate],ConToAct.EndDate AS [ConTo Act EndDate]
,[EC_Plan_P6_ActID_Test] AS [Test ActId]

,PullingWorkfront AS [Pulling Workfront]
,ElePro.TotalPercentage * EC.EC_Length / 100 AS [Pulled Lm]
,ElePro.LastUpdated [Pulled Date]
,ElePro.TotalPercentage
,ElePro.Weekly * EC.EC_Length / 100 AS [Weekly Pulled Lm]

,GlandFromWorkfront AS [Gland From Workfront]
,EC_Cable_Gland_From AS [Gland From Date]

,GlandToWorkfront AS [Gland To Workfront]
,EC_Cable_Gland_To AS [Gland To Date]

,ConnFromWorkfront AS [Conn From Workfront]
,[EC_Plan_Connected_Date_From] AS [Con From Date]

,ConnToWorkfront AS [Conn To Workfront]
,[EC_Plan_Connected_Date_To] AS [Con To Date]

,[EC_Megger] AS [Test Date]
,[TR_QC_Released] AS [QC Released Date]
,EC.RFINumber
,EC.PDSModel
,[Remarks]
,EC.[Team], tbl_id AS Id
,CASE WHEN Active = 1 THEN 'Active' ELSE 'DELETED' END AS Status
,CASE WHEN EleRes.ItemId IS NOT NULL THEN 'Yes' ELSE 'No' END AS [Resource]
FROM [tblEleCableList] AS EC WITH (NOLOCK)
LEFT JOIN ElePro ON EC.EC_ID = ElePro.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN Equipment AS EqFrom ON EC.EC_From = EqFrom.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN Equipment AS EqTo ON EC.EC_To = EqTo.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN ActId AS PullAct ON EC.EC_Plan_P6_ActID_Pulling = PullAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN ActId AS ConFromAct ON EC.EC_Plan_P6_ActID_Connect = ConFromAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN ActId AS ConToAct ON EC.EC_Plan_P6_ActID_Connect_2 = ConToAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN (SELECT [ItemId] FROM [dbo].[tblResourcesItem] WITH (NOLOCK) WHERE GroupId = 100) AS EleRes ON EC.TBL_ID = EleRes.ItemId


UNION ALL

SELECT DISTINCT
IC.Discipline,IC.[Area],[IC_Type] AS [Type],[IC_ID] AS Tag,[IC_Length] AS [Length],[IC_Description] AS [Description],Routing
,IC.[SubSystem]
,[IC_From] AS [From],[From_Description] AS [From Description], EqFrom.Area AS [Eq From Area], EqFrom.PDSModel AS [Eq From PDSModel], EqFrom.[Status] AS [Eq From Status]
,[IC_To] AS [To],[To_Description] AS [To Description], EqTo.Area AS [Eq To Area], EqTo.PDSModel AS [Eq To PDSModel], EqTo.[Status] AS [Eq To Status]
,Drawing

,[IC_Plan_P6_ActID_Pulling] AS [Pulling ActId], PullAct.ActName AS [Pulling ActName],PullAct.EICA_Area AS [Pulling Act Area],PullAct.Family AS [Pulling Act Family],PullAct.SubCon AS [Pulling Act Subcon],PullAct.Team AS [Pulling Act Team],PullAct.StartDate AS [Pulling Act StartDate],PullAct.EndDate AS [Pulling Act EndDate]
,[IC_Plan_P6_ActID_Connect] AS [Con From ActId], ConFromAct.ActName AS [ConFrom ActName],ConFromAct.EICA_Area AS [ConFrom Act Area],ConFromAct.Family AS [ConFrom Act Family],ConFromAct.SubCon AS [ConFrom Act Subcon],ConFromAct.Team AS [ConFrom Act Team],ConFromAct.StartDate AS [ConFrom Act StartDate],ConFromAct.EndDate AS [ConFrom Act EndDate]
,[IC_Plan_P6_ActID_Connect_2] AS [Con To ActId], ConToAct.ActName AS [ConTo ActName],ConToAct.EICA_Area AS [ConTo Act Area],ConToAct.Family AS [ConTo Act Family],ConToAct.SubCon AS [ConTo Act Subcon],ConToAct.Team AS [ConTo Act Team],ConToAct.StartDate AS [ConTo Act StartDate],ConToAct.EndDate AS [ConTo Act EndDate]
,[IC_Plan_P6_ActID_Test] AS [Test ActId]

,PullingWorkfront AS [Pulling Workfront]
,InsPro.TotalPercentage * IC.IC_Length / 100 AS [Pulled Lm]
,InsPro.LastUpdated [Pulled Date]
,InsPro.TotalPercentage
,InsPro.Weekly * IC.IC_Length / 100 AS [Weekly Pulled Lm]

,GlandFromWorkfront AS [Gland From Workfront]
,IC_Cable_Gland_From AS [Gland From Date]

,GlandToWorkfront AS [Gland To Workfront]
,IC_Cable_Gland_To AS [Gland To Date]

,ConnFromWorkfront AS [Conn From Workfront]
,[IC_Plan_Connected_Date_From] AS [Con From Date]

,ConnToWorkfront AS [Conn To Workfront]
,[IC_Plan_Connected_Date_To] AS [Con To Date]

,[IC_Megger] AS [Test Date]
,[TR_QC_Released] AS [QC Released Date]
,IC.RFINumber
,IC.PDSModel
,[Remarks]
,IC.[Team], tbl_id AS Id
,CASE WHEN Active = 1 THEN 'Active' ELSE 'DELETED' END AS Status
,CASE WHEN InsRes.ItemId IS NOT NULL THEN 'Yes' ELSE 'No' END AS [Resource]
FROM [tblInsCableList] AS IC WITH (NOLOCK)
LEFT JOIN InsPro ON IC.IC_ID = InsPro.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN Equipment AS EqFrom ON IC.IC_From = EqFrom.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN Equipment AS EqTo ON IC.IC_To = EqTo.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN ActId AS PullAct ON IC.IC_Plan_P6_ActID_Pulling = PullAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN ActId AS ConFromAct ON IC.IC_Plan_P6_ActID_Connect = ConFromAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN ActId AS ConToAct ON IC.IC_Plan_P6_ActID_Connect_2 = ConToAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN (SELECT [ItemId] FROM [dbo].[tblResourcesItem] WITH (NOLOCK) WHERE GroupId = 200) AS InsRes ON IC.TBL_ID = InsRes.ItemId
OPTION (USE HINT ('DISABLE_ROW_MODE_MEMORY_GRANT_FEEDBACK'))
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DailyTrackingResourceAll'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.DailyTrackingResourceAll
END
GO
CREATE PROC [dbo].[DailyTrackingResourceAll]


AS

 

declare @col as nvarchar(max)

declare @colSUM as nvarchar(max)

declare @result as nvarchar(max)

declare @startdate as char(10)

declare @enddate as char(10)

declare @startdate0 as date

declare @enddate0 as date

declare @colWeek4 as nvarchar(50)

declare @colWeek3 as nvarchar(50)

declare @colWeek2 as nvarchar(50)

declare @colWeek1 as nvarchar(50)

 

select @enddate0 =  [tmp_date] from [tblTMP] where [tmp_id]=1--convert(char(10),cast(getdate() as smalldatetime),111)

select @startdate0 = dateadd(d,-6,@enddate0) --'04/11/2015'

set @enddate =  convert(char(10),cast(@enddate0 as smalldatetime),111)

set @startdate = convert(char(10),cast(@startdate0 as smalldatetime),111)

 

select @colWeek4 = '[' + FORMAT(DATEADD(DAY, -28, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -28, @enddate0), 'MMM') + ']'

select @colWeek3 = '[' + FORMAT(DATEADD(DAY, -21, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -21, @enddate0), 'MMM') + ']'

select @colWeek2 = '[' + FORMAT(DATEADD(DAY, -14, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -14, @enddate0), 'MMM') + ']'

select @colWeek1 = '[' + FORMAT(DATEADD(DAY, -7, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -7, @enddate0), 'MMM') + ']'

 

select @col = STUFF((select distinct ',' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

select @colSUM =  STUFF((select distinct ',' + 'SUM(' + quotename(x.Date) + ') as ' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

 

set @result = '

 

SELECT

 

ResBudget.PCSBudget AS Scope

,CASE WHEN (ResBudget.PCSBudget - vInfo.Done) IS NULL THEN ResBudget.PCSBudget ELSE ResBudget.PCSBudget - vInfo.Done END AS Pending

,CASE WHEN ResBudget.PCSBudget = 0 THEN 0 ELSE CONVERT(FLOAT,vInfo.Done) / CONVERT(FLOAT,ResBudget.PCSBudget) END AS [% PROG]

,vInfo.*

 

FROM (

select

ACTIVITIES.ResourceId

,CASE WHEN ACTIVITIES.[Location] = NULL THEN ACTIVITIES.ResourceName

                WHEN ACTIVITIES.[Location] = ''UNDEFINED'' THEN ACTIVITIES.ResourceName

                ELSE ACTIVITIES.ResourceName + '' - '' + REPLACE(ACTIVITIES.[Location], ''UNDEFINED'', '''')

                END AS ResourceName

 

,ACTIVITIES.UOM

,ACTIVITIES.Location

 

,sum(x2.Cummulative) as Done

,sum(x2.Weekly) as Weekly

 

,sum(x2.Cummulative) - sum(x2.Weekly) AS ' + 'CummWeek1' + '

,sum(x2.Cummulative) - sum(x2.Weekly) - sum(x2.[Last 1 Weekly]) AS ' + 'CummWeek2' + '

 

,(sum(x2.[Last 1 Weekly]) + sum(x2.[Last 2 Weekly])) / 2 AS Trend

 

,sum(x2.[Last 1 Weekly]) as ' + @colWeek1 + '

,sum(x2.[Last 2 Weekly]) as ' + @colWeek2 + '

,sum(x2.[Last 3 Weekly]) as ' + @colWeek3 + '

,sum(x2.[Last 4 Weekly]) as ' + @colWeek4 + '

 

,'+ @colSUM +'

 

 

 

FROM

(

select Type,ActID

,CASE WHEN [Activity Name] =''Electrical Cable Connection 01'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Electrical Cable Connection 02'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Instrument Cable Connection 01 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 01 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

ELSE

[Activity Name]

END AS [EICA Activity]

,Scope

,case when Cummulative is null then 0 else Cummulative end as Cummulative

,CASE WHEN [Last 4 Weekly] IS NULL THEN 0 ELSE [Last 4 Weekly] END AS [Last 4 Weekly]

,CASE WHEN [Last 3 Weekly] IS NULL THEN 0 ELSE [Last 3 Weekly] END AS [Last 3 Weekly]

,CASE WHEN [Last 2 Weekly] IS NULL THEN 0 ELSE [Last 2 Weekly] END AS [Last 2 Weekly]

,CASE WHEN [Last 1 Weekly] IS NULL THEN 0 ELSE [Last 1 Weekly] END AS [Last 1 Weekly]

,CASE WHEN Weekly IS NULL THEN 0 ELSE WEEKLY END AS Weekly

,'+ @col +' FROM

 

--******************************************************************

(---Electrical Cable Pulling            

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[EC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] is not null

group by EC_TYPE,[EC_Plan_Pulled_Date],EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([EC_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

tblEleCableList

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL
--******************************************************************
---Universal Equipment

select convert(char(10),cast(installedDate as smalldatetime),111) as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment WHERE active=1

and installedDate is not null

group by Discipline,installedDate,ActID

UNION ALL

select ''Cummulative'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,installedDate,ActID

UNION ALL

select ''Scope'' as Daily,

Discipline as [Activity Name]

,count(Tag) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

group by Discipline,ActID

--*********************************************************

UNION ALL

--******************************************************************

---Instrument Cable Pulling         

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([IC_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblInsCableList

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

---Electrical Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] is not null

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Electrical Cable Tray

select convert(char(10),cast([EL_Tray_Installed_date] as smalldatetime),111) as Daily,

''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

where [Production_Date] is not null

) as vETrayPro

where active=1

group by EL_Tray_Type,[EL_Tray_Installed_date],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by EL_Tray_Type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([EL_Tray_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblEleCableTray

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---Instrument Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrument Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Cummulative'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 1 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 2 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 3 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 4 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Scope'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,(count([iC_id]))*2 as ''Gland'',''Instrumentation'' as [Type],''Each'' as [Unit]

,IC_Plan_P6_ActID_Connect as ActID

FROM tblInsCableList

Where active = 1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

--**********************************************************************************

UNION ALL

---Instrument Installation - Stand Alone/Field

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Installation - In Line

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Hook Ups

select convert(char(10),cast(HookUp_Date as smalldatetime),111) as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup,hookup_date

UNION ALL

select ''Cummulative'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Scope'' as Daily,

''Hook Ups'' as [Activity Name]

,count([Instrument_Tag]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

--*********************************************************

UNION ALL

---Calibration

select convert(char(10),cast(Calibration_Date as smalldatetime),111) as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID,Calibration_Date

UNION ALL

select ''Cummulative'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Scope'' as Daily,

''Calibration'' as [Activity Name]

,count([Instrument_Tag]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID

--*********************************************************

UNION ALL

---Lighting Fixtures

select convert(char(10),cast(LF_Installed as smalldatetime),111) as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed is not null

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([TAG]) as ''Fixture Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

group by lf_ref_desc,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Cable Tray

select convert(char(10),cast([IN_Tray_Installed] as smalldatetime),111) as Daily,

''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] is not null

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

AND Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([IN_Tray_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblINSCableTray

where active=1

AND tblInsCableTray.IN_Tray_Type <>''F&G''

group by [IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---MSC Cable Pulling

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] is not null

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Cummulative'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 1 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 2 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 3 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 4 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Scope'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Length]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblMSCCable

where active=1

group by IC_Plan_P6_ActID_Pulling,type

--******************************************************************

UNION ALL

---Loop

select convert(char(10),cast(L_Done as smalldatetime),111) as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by L_Done,ACTIVITYID

UNION ALL

select ''Cummulative'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by ACTIVITYID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by L_Done,ACTIVITYID

UNION ALL

select ''Scope'' as Daily,

''Loop'' as [Activity Name]

,count(loopname) as ''Scope'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by ACTIVITYID

--*********************************************************

--******************************************************************

) as X

 

PIVOT

(sum (Pulled) for Daily in ('+ @col +',Scope,[Cummulative],[Last 1 Weekly],[Last 2 Weekly],[Last 3 Weekly],[Last 4 Weekly],weekly)

)as X1

) as X2

RIGHT JOIN tblActIDS AS ACTIVITIES ON X2.ActID = ACTIVITIES.ActID

WHERE ACTIVITIES.ResourceId IS NOT NULL

group by ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM,ACTIVITIES.[Location]

) AS vInfo

INNER JOIN (

SELECT

ResourceId,ResourceName,[Location]

,SUM(PCS_Budget) AS PCSBudget

FROM tblActIDS

GROUP BY ResourceId,ResourceName,[Location]

) AS ResBudget

ON vInfo.ResourceId = ResBudget.ResourceId

                AND (CASE WHEN vInfo.[Location] IS NULL THEN ''UNDEFINED'' ELSE vInfo.[Location] END) = (CASE WHEN ResBudget.[Location] IS NULL THEN ''UNDEFINED'' ELSE ResBudget.[Location] END)

' 

execute(@result)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DailyTrackingResourceAllEle'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.DailyTrackingResourceAllEle
END
GO
CREATE PROC [dbo].[DailyTrackingResourceAllEle]

AS

 

declare @col as nvarchar(max)

declare @colSUM as nvarchar(max)

declare @result as nvarchar(max)

declare @startdate as char(10)

declare @enddate as char(10)

declare @startdate0 as date

declare @enddate0 as date

declare @colWeek4 as nvarchar(50)

declare @colWeek3 as nvarchar(50)

declare @colWeek2 as nvarchar(50)

declare @colWeek1 as nvarchar(50)

 

select @enddate0 =  [tmp_date] from [tblTMP] where [tmp_id]=1--convert(char(10),cast(getdate() as smalldatetime),111)

select @startdate0 = dateadd(d,-6,@enddate0) --'04/11/2015'

set @enddate =  convert(char(10),cast(@enddate0 as smalldatetime),111)

set @startdate = convert(char(10),cast(@startdate0 as smalldatetime),111)

 

select @colWeek4 = '[' + FORMAT(DATEADD(DAY, -28, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -28, @enddate0), 'MMM') + ']'

select @colWeek3 = '[' + FORMAT(DATEADD(DAY, -21, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -21, @enddate0), 'MMM') + ']'

select @colWeek2 = '[' + FORMAT(DATEADD(DAY, -14, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -14, @enddate0), 'MMM') + ']'

select @colWeek1 = '[' + FORMAT(DATEADD(DAY, -7, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -7, @enddate0), 'MMM') + ']'

 

select @col = STUFF((select distinct ',' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

select @colSUM =  STUFF((select distinct ',' + 'SUM(' + quotename(x.Date) + ') as ' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

 

set @result = '

 

SELECT

 

ResBudget.PCSBudget AS Scope

,CASE WHEN (ResBudget.PCSBudget - vInfo.Done) IS NULL THEN ResBudget.PCSBudget ELSE ResBudget.PCSBudget - vInfo.Done END AS Pending

,CASE WHEN ResBudget.PCSBudget = 0 THEN 0 ELSE CONVERT(FLOAT,vInfo.Done) / CONVERT(FLOAT,ResBudget.PCSBudget) END AS [% PROG]

,vInfo.*

 

FROM (

select

ACTIVITIES.SubCon,ACTIVITIES.ResourceId

,CASE WHEN ACTIVITIES.[Location] = NULL THEN ACTIVITIES.ResourceName

                WHEN ACTIVITIES.[Location] = ''UNDEFINED'' THEN ACTIVITIES.ResourceName

                ELSE ACTIVITIES.ResourceName + '' - '' + REPLACE(ACTIVITIES.[Location], ''UNDEFINED'', '''')

                END AS ResourceName

 

,ACTIVITIES.UOM

,ACTIVITIES.Location

 

,sum(x2.Cummulative) as Done

,sum(x2.Weekly) as Weekly

 

,sum(x2.Cummulative) - sum(x2.Weekly) AS ' + 'CummWeek1' + '

,sum(x2.Cummulative) - sum(x2.Weekly) - sum(x2.[Last 1 Weekly]) AS ' + 'CummWeek2' + '

 

,(sum(x2.[Last 1 Weekly]) + sum(x2.[Last 2 Weekly])) / 2 AS Trend

 

,sum(x2.[Last 1 Weekly]) as ' + @colWeek1 + '

,sum(x2.[Last 2 Weekly]) as ' + @colWeek2 + '

,sum(x2.[Last 3 Weekly]) as ' + @colWeek3 + '

,sum(x2.[Last 4 Weekly]) as ' + @colWeek4 + '

 

 

,'+ @colSUM +'

 

 

 

FROM

(

select Type,ActID

,CASE WHEN [Activity Name] =''Electrical Cable Connection 01'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Electrical Cable Connection 02'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Instrument Cable Connection 01 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 01 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

ELSE

[Activity Name]

END AS [EICA Activity]

,Scope

,case when Cummulative is null then 0 else Cummulative end as Cummulative

,CASE WHEN [Last 4 Weekly] IS NULL THEN 0 ELSE [Last 4 Weekly] END AS [Last 4 Weekly]

,CASE WHEN [Last 3 Weekly] IS NULL THEN 0 ELSE [Last 3 Weekly] END AS [Last 3 Weekly]

,CASE WHEN [Last 2 Weekly] IS NULL THEN 0 ELSE [Last 2 Weekly] END AS [Last 2 Weekly]

,CASE WHEN [Last 1 Weekly] IS NULL THEN 0 ELSE [Last 1 Weekly] END AS [Last 1 Weekly]

,CASE WHEN Weekly IS NULL THEN 0 ELSE WEEKLY END AS Weekly

,'+ @col +' FROM

 

--******************************************************************

(---Electrical Cable Pulling            

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[EC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] is not null

group by EC_TYPE,[EC_Plan_Pulled_Date],EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([EC_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

tblEleCableList

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL
--******************************************************************
---Universal Equipment

select convert(char(10),cast(installedDate as smalldatetime),111) as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment WHERE active=1

and installedDate is not null

group by Discipline,installedDate,ActID

UNION ALL

select ''Cummulative'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,installedDate,ActID

UNION ALL

select ''Scope'' as Daily,

Discipline as [Activity Name]

,count(Tag) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

group by Discipline,ActID

--*********************************************************

UNION ALL

--******************************************************************

---Instrument Cable Pulling         

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([IC_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblInsCableList

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

---Electrical Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] is not null

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Electrical Cable Tray

select convert(char(10),cast([EL_Tray_Installed_date] as smalldatetime),111) as Daily,

''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

where [Production_Date] is not null

) as vETrayPro

where active=1

group by EL_Tray_Type,[EL_Tray_Installed_date],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by EL_Tray_Type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([EL_Tray_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblEleCableTray

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---Instrument Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrument Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Cummulative'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 1 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 2 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 3 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 4 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Scope'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,(count([iC_id]))*2 as ''Gland'',''Instrumentation'' as [Type],''Each'' as [Unit]

,IC_Plan_P6_ActID_Connect as ActID

FROM tblInsCableList

Where active = 1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

--**********************************************************************************


UNION ALL

---Instrument Installation - Stand Alone/Field

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Installation - In Line

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Hook Ups

select convert(char(10),cast(HookUp_Date as smalldatetime),111) as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup,hookup_date

UNION ALL

select ''Cummulative'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Scope'' as Daily,

''Hook Ups'' as [Activity Name]

,count([Instrument_Tag]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

--*********************************************************

UNION ALL

---Calibration

select convert(char(10),cast(Calibration_Date as smalldatetime),111) as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID,Calibration_Date

UNION ALL

select ''Cummulative'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Scope'' as Daily,

''Calibration'' as [Activity Name]

,count([Instrument_Tag]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID

--*********************************************************

UNION ALL

---Lighting Fixtures

select convert(char(10),cast(LF_Installed as smalldatetime),111) as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed is not null

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([TAG]) as ''Fixture Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

group by lf_ref_desc,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Cable Tray

select convert(char(10),cast([IN_Tray_Installed] as smalldatetime),111) as Daily,

''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] is not null

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

AND Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([IN_Tray_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblINSCableTray

where active=1

AND tblInsCableTray.IN_Tray_Type <>''F&G''

group by [IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---MSC Cable Pulling

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] is not null

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Cummulative'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 1 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 2 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 3 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 4 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Scope'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Length]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblMSCCable

where active=1

group by IC_Plan_P6_ActID_Pulling,type

--******************************************************************

UNION ALL

---Loop

select convert(char(10),cast(L_Done as smalldatetime),111) as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by L_Done,ACTIVITYID

UNION ALL

select ''Cummulative'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by ACTIVITYID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by L_Done,ACTIVITYID

UNION ALL

select ''Scope'' as Daily,

''Loop'' as [Activity Name]

,count(loopname) as ''Scope'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by ACTIVITYID

--*********************************************************

UNION ALL
---Electrical Cable Glanding 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Glanding 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] is not null

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,count([IC_id]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID

FROM tblInsCableList

where active=1

group by [IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] is not null

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,count([IC_id]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID

FROM tblInsCableList

where active=1

group by [IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

--******************************************************************

) as X

 

PIVOT

(sum (Pulled) for Daily in ('+ @col +',Scope,[Cummulative],[Last 1 Weekly],[Last 2 Weekly],[Last 3 Weekly],[Last 4 Weekly],weekly)

)as X1

) as X2

RIGHT JOIN tblActIDS AS ACTIVITIES ON X2.ActID = ACTIVITIES.ActID

WHERE ACTIVITIES.ResourceId IS NOT NULL AND ResourceId LIKE ''%EL%''

group by ACTIVITIES.SubCon,ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM,ACTIVITIES.[Location]

) AS vInfo

INNER JOIN (

SELECT

ResourceId,ResourceName,Subcon,[Location]

,SUM(PCS_Budget) AS PCSBudget

FROM tblActIDS

GROUP BY ResourceId,ResourceName,Subcon,[Location]

) AS ResBudget

ON vInfo.ResourceId = ResBudget.ResourceId AND vInfo.subcon = ResBudget.Subcon

                AND (CASE WHEN vInfo.[Location] IS NULL THEN ''UNDEFINED'' ELSE vInfo.[Location] END) = (CASE WHEN ResBudget.[Location] IS NULL THEN ''UNDEFINED'' ELSE ResBudget.[Location] END)

' 

execute(@result)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DailyTrackingResourceAllElePackage'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.DailyTrackingResourceAllElePackage
END
GO
CREATE PROC [dbo].[DailyTrackingResourceAllElePackage]

AS

 

declare @col as nvarchar(max)

declare @colSUM as nvarchar(max)

declare @result as nvarchar(max)

declare @startdate as char(10)

declare @enddate as char(10)

declare @startdate0 as date

declare @enddate0 as date

declare @colWeek4 as nvarchar(50)

declare @colWeek3 as nvarchar(50)

declare @colWeek2 as nvarchar(50)

declare @colWeek1 as nvarchar(50)

 

select @enddate0 =  [tmp_date] from [tblTMP] where [tmp_id]=1--convert(char(10),cast(getdate() as smalldatetime),111)

select @startdate0 = dateadd(d,-6,@enddate0) --'04/11/2015'

set @enddate =  convert(char(10),cast(@enddate0 as smalldatetime),111)

set @startdate = convert(char(10),cast(@startdate0 as smalldatetime),111)

 

select @colWeek4 = '[' + FORMAT(DATEADD(DAY, -28, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -28, @enddate0), 'MMM') + ']'

select @colWeek3 = '[' + FORMAT(DATEADD(DAY, -21, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -21, @enddate0), 'MMM') + ']'

select @colWeek2 = '[' + FORMAT(DATEADD(DAY, -14, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -14, @enddate0), 'MMM') + ']'

select @colWeek1 = '[' + FORMAT(DATEADD(DAY, -7, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -7, @enddate0), 'MMM') + ']'

 

select @col = STUFF((select distinct ',' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

select @colSUM =  STUFF((select distinct ',' + 'SUM(' + quotename(x.Date) + ') as ' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

 

set @result = '

 

SELECT

 

ResBudget.PCSBudget AS Scope

,CASE WHEN (ResBudget.PCSBudget - vInfo.Done) IS NULL THEN ResBudget.PCSBudget ELSE ResBudget.PCSBudget - vInfo.Done END AS Pending

,CASE WHEN ResBudget.PCSBudget = 0 THEN 0 ELSE CONVERT(FLOAT,vInfo.Done) / CONVERT(FLOAT,ResBudget.PCSBudget) END AS [% PROG]

,vInfo.*

 

FROM (

select

Package, ACTIVITIES.SubCon,ACTIVITIES.ResourceId

,CASE WHEN ACTIVITIES.[Location] = NULL THEN ACTIVITIES.ResourceName

                WHEN ACTIVITIES.[Location] = ''UNDEFINED'' THEN ACTIVITIES.ResourceName

                ELSE ACTIVITIES.ResourceName + '' - '' + REPLACE(ACTIVITIES.[Location], ''UNDEFINED'', '''')

                END AS ResourceName

 

,ACTIVITIES.UOM

,ACTIVITIES.Location

 

,sum(x2.Cummulative) as Done

,sum(x2.Weekly) as Weekly

 

,sum(x2.Cummulative) - sum(x2.Weekly) AS ' + 'CummWeek1' + '

,sum(x2.Cummulative) - sum(x2.Weekly) - sum(x2.[Last 1 Weekly]) AS ' + 'CummWeek2' + '

 

,(sum(x2.[Last 1 Weekly]) + sum(x2.[Last 2 Weekly])) / 2 AS Trend

 

,sum(x2.[Last 1 Weekly]) as ' + @colWeek1 + '

,sum(x2.[Last 2 Weekly]) as ' + @colWeek2 + '

,sum(x2.[Last 3 Weekly]) as ' + @colWeek3 + '

,sum(x2.[Last 4 Weekly]) as ' + @colWeek4 + '

 

 

,'+ @colSUM +'

 

 

 

FROM

(

select Type,ActID

,CASE WHEN [Activity Name] =''Electrical Cable Connection 01'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Electrical Cable Connection 02'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Instrument Cable Connection 01 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 01 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

ELSE

[Activity Name]

END AS [EICA Activity]

,Scope

,case when Cummulative is null then 0 else Cummulative end as Cummulative

,CASE WHEN [Last 4 Weekly] IS NULL THEN 0 ELSE [Last 4 Weekly] END AS [Last 4 Weekly]

,CASE WHEN [Last 3 Weekly] IS NULL THEN 0 ELSE [Last 3 Weekly] END AS [Last 3 Weekly]

,CASE WHEN [Last 2 Weekly] IS NULL THEN 0 ELSE [Last 2 Weekly] END AS [Last 2 Weekly]

,CASE WHEN [Last 1 Weekly] IS NULL THEN 0 ELSE [Last 1 Weekly] END AS [Last 1 Weekly]

,CASE WHEN Weekly IS NULL THEN 0 ELSE WEEKLY END AS Weekly

,'+ @col +' FROM

 

--******************************************************************

(---Electrical Cable Pulling            

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[EC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] is not null

group by EC_TYPE,[EC_Plan_Pulled_Date],EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([EC_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

tblEleCableList

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

--******************************************************************


UNION ALL
--******************************************************************
---Universal Equipment

select convert(char(10),cast(installedDate as smalldatetime),111) as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment WHERE active=1

and installedDate is not null

group by Discipline,installedDate,ActID

UNION ALL

select ''Cummulative'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,installedDate,ActID

UNION ALL

select ''Scope'' as Daily,

Discipline as [Activity Name]

,count(Tag) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

group by Discipline,ActID

--*********************************************************

UNION ALL

--******************************************************************

---Instrument Cable Pulling         

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([IC_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblInsCableList

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

---Electrical Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] is not null

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Electrical Cable Tray

select convert(char(10),cast([EL_Tray_Installed_date] as smalldatetime),111) as Daily,

''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

where [Production_Date] is not null

) as vETrayPro

where active=1

group by EL_Tray_Type,[EL_Tray_Installed_date],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by EL_Tray_Type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([EL_Tray_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblEleCableTray

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---Instrument Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrument Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Cummulative'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 1 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 2 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 3 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 4 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Scope'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,(count([iC_id]))*2 as ''Gland'',''Instrumentation'' as [Type],''Each'' as [Unit]

,IC_Plan_P6_ActID_Connect as ActID

FROM tblInsCableList

Where active = 1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

--**********************************************************************************
 

UNION ALL

---Instrument Installation - Stand Alone/Field

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Installation - In Line

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Hook Ups

select convert(char(10),cast(HookUp_Date as smalldatetime),111) as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup,hookup_date

UNION ALL

select ''Cummulative'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Scope'' as Daily,

''Hook Ups'' as [Activity Name]

,count([Instrument_Tag]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

--*********************************************************

UNION ALL

---Calibration

select convert(char(10),cast(Calibration_Date as smalldatetime),111) as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID,Calibration_Date

UNION ALL

select ''Cummulative'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Scope'' as Daily,

''Calibration'' as [Activity Name]

,count([Instrument_Tag]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID

--*********************************************************

UNION ALL

---Lighting Fixtures

select convert(char(10),cast(LF_Installed as smalldatetime),111) as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed is not null

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([TAG]) as ''Fixture Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

group by lf_ref_desc,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Cable Tray

select convert(char(10),cast([IN_Tray_Installed] as smalldatetime),111) as Daily,

''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] is not null

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

AND Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([IN_Tray_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblINSCableTray

where active=1

AND tblInsCableTray.IN_Tray_Type <>''F&G''

group by [IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---MSC Cable Pulling

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] is not null

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Cummulative'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 1 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 2 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 3 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 4 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Scope'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Length]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblMSCCable

where active=1

group by IC_Plan_P6_ActID_Pulling,type

--******************************************************************

UNION ALL

---Loop

select convert(char(10),cast(L_Done as smalldatetime),111) as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by L_Done,ACTIVITYID

UNION ALL

select ''Cummulative'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by ACTIVITYID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by L_Done,ACTIVITYID

UNION ALL

select ''Scope'' as Daily,

''Loop'' as [Activity Name]

,count(loopname) as ''Scope'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by ACTIVITYID

--*********************************************************

UNION ALL
---Electrical Cable Glanding 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Glanding 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] is not null

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,count([IC_id]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID

FROM tblInsCableList

where active=1

group by [IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] is not null

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,count([IC_id]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID

FROM tblInsCableList

where active=1

group by [IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

--******************************************************************

) as X

 

PIVOT

(sum (Pulled) for Daily in ('+ @col +',Scope,[Cummulative],[Last 1 Weekly],[Last 2 Weekly],[Last 3 Weekly],[Last 4 Weekly],weekly)

)as X1

) as X2

RIGHT JOIN tblActIDS AS ACTIVITIES ON X2.ActID = ACTIVITIES.ActID

WHERE ACTIVITIES.ResourceId IS NOT NULL AND ResourceId LIKE ''%EL%''

group by ACTIVITIES.SubCon,ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM,ACTIVITIES.[Location], ACTIVITIES.Package

) AS vInfo

INNER JOIN (

SELECT

ResourceId,ResourceName,Subcon,[Location], Package

,SUM(PCS_Budget) AS PCSBudget

FROM tblActIDS

GROUP BY ResourceId,ResourceName,Subcon,[Location], Package

) AS ResBudget

ON 
    vInfo.Package = ResBudget.Package
    AND vInfo.ResourceId = ResBudget.ResourceId AND vInfo.subcon = ResBudget.Subcon
    AND (CASE WHEN vInfo.[Location] IS NULL THEN ''UNDEFINED'' ELSE vInfo.[Location] END) = (CASE WHEN ResBudget.[Location] IS NULL THEN ''UNDEFINED'' ELSE ResBudget.[Location] END)

' 

execute(@result)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DailyTrackingResourceAllIns'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.DailyTrackingResourceAllIns
END
GO
CREATE PROC [dbo].[DailyTrackingResourceAllIns]

AS

 

declare @col as nvarchar(max)

declare @colSUM as nvarchar(max)

declare @result as nvarchar(max)

declare @startdate as char(10)

declare @enddate as char(10)

declare @startdate0 as date

declare @enddate0 as date

declare @colWeek4 as nvarchar(50)

declare @colWeek3 as nvarchar(50)

declare @colWeek2 as nvarchar(50)

declare @colWeek1 as nvarchar(50)

 

select @enddate0 =  [tmp_date] from [tblTMP] where [tmp_id]=1--convert(char(10),cast(getdate() as smalldatetime),111)

select @startdate0 = dateadd(d,-6,@enddate0) --'04/11/2015'

set @enddate =  convert(char(10),cast(@enddate0 as smalldatetime),111)

set @startdate = convert(char(10),cast(@startdate0 as smalldatetime),111)

 

select @colWeek4 = '[' + FORMAT(DATEADD(DAY, -28, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -28, @enddate0), 'MMM') + ']'

select @colWeek3 = '[' + FORMAT(DATEADD(DAY, -21, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -21, @enddate0), 'MMM') + ']'

select @colWeek2 = '[' + FORMAT(DATEADD(DAY, -14, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -14, @enddate0), 'MMM') + ']'

select @colWeek1 = '[' + FORMAT(DATEADD(DAY, -7, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -7, @enddate0), 'MMM') + ']'

 

select @col = STUFF((select distinct ',' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

select @colSUM =  STUFF((select distinct ',' + 'SUM(' + quotename(x.Date) + ') as ' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

 

set @result = '

 

SELECT

 

ResBudget.PCSBudget AS Scope

,CASE WHEN (ResBudget.PCSBudget - vInfo.Done) IS NULL THEN ResBudget.PCSBudget ELSE ResBudget.PCSBudget - vInfo.Done END AS Pending

,CASE WHEN ResBudget.PCSBudget = 0 THEN 0 ELSE CONVERT(FLOAT,vInfo.Done) / CONVERT(FLOAT,ResBudget.PCSBudget) END AS [% PROG]

,vInfo.*

 

FROM (

select

ACTIVITIES.SubCon,ACTIVITIES.ResourceId

,CASE WHEN ACTIVITIES.[Location] = NULL THEN ACTIVITIES.ResourceName

                WHEN ACTIVITIES.[Location] = ''UNDEFINED'' THEN ACTIVITIES.ResourceName

                ELSE ACTIVITIES.ResourceName + '' - '' + REPLACE(ACTIVITIES.[Location], ''UNDEFINED'', '''')

                END AS ResourceName

 

,ACTIVITIES.UOM

,ACTIVITIES.Location

 

,sum(x2.Cummulative) as Done

,sum(x2.Weekly) as Weekly

 

,sum(x2.Cummulative) - sum(x2.Weekly) AS ' + 'CummWeek1' + '

,sum(x2.Cummulative) - sum(x2.Weekly) - sum(x2.[Last 1 Weekly]) AS ' + 'CummWeek2' + '

 

,(sum(x2.[Last 1 Weekly]) + sum(x2.[Last 2 Weekly])) / 2 AS Trend

 

,sum(x2.[Last 1 Weekly]) as ' + @colWeek1 + '

,sum(x2.[Last 2 Weekly]) as ' + @colWeek2 + '

,sum(x2.[Last 3 Weekly]) as ' + @colWeek3 + '

,sum(x2.[Last 4 Weekly]) as ' + @colWeek4 + '

 

,'+ @colSUM +'

 

 

 

FROM

(

select Type,ActID

,CASE WHEN [Activity Name] =''Electrical Cable Connection 01'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Electrical Cable Connection 02'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Instrument Cable Connection 01 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 01 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

ELSE

[Activity Name]

END AS [EICA Activity]

,Scope

,case when Cummulative is null then 0 else Cummulative end as Cummulative

,CASE WHEN [Last 4 Weekly] IS NULL THEN 0 ELSE [Last 4 Weekly] END AS [Last 4 Weekly]

,CASE WHEN [Last 3 Weekly] IS NULL THEN 0 ELSE [Last 3 Weekly] END AS [Last 3 Weekly]

,CASE WHEN [Last 2 Weekly] IS NULL THEN 0 ELSE [Last 2 Weekly] END AS [Last 2 Weekly]

,CASE WHEN [Last 1 Weekly] IS NULL THEN 0 ELSE [Last 1 Weekly] END AS [Last 1 Weekly]

,CASE WHEN Weekly IS NULL THEN 0 ELSE WEEKLY END AS Weekly

,'+ @col +' FROM

 

--******************************************************************

(---Electrical Cable Pulling            

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[EC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] is not null

group by EC_TYPE,[EC_Plan_Pulled_Date],EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([EC_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

tblEleCableList

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL
--******************************************************************
---Universal Equipment

select convert(char(10),cast(installedDate as smalldatetime),111) as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment WHERE active=1

and installedDate is not null

group by Discipline,installedDate,ActID

UNION ALL

select ''Cummulative'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,installedDate,ActID

UNION ALL

select ''Scope'' as Daily,

Discipline as [Activity Name]

,count(Tag) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

group by Discipline,ActID

--*********************************************************

UNION ALL

--******************************************************************

---Instrument Cable Pulling         

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([IC_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblInsCableList

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

---Electrical Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] is not null

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Electrical Cable Tray

select convert(char(10),cast([EL_Tray_Installed_date] as smalldatetime),111) as Daily,

''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

where [Production_Date] is not null

) as vETrayPro

where active=1

group by EL_Tray_Type,[EL_Tray_Installed_date],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by EL_Tray_Type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([EL_Tray_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblEleCableTray

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---Instrument Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrument Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Cummulative'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 1 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 2 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 3 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 4 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Scope'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,(count([iC_id]))*2 as ''Gland'',''Instrumentation'' as [Type],''Each'' as [Unit]

,IC_Plan_P6_ActID_Connect + ''-GL'' as ActID

FROM tblInsCableList

Where active = 1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

--**********************************************************************************

UNION ALL

---Instrument Installation - Stand Alone/Field

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Installation - In Line

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Hook Ups

select convert(char(10),cast(HookUp_Date as smalldatetime),111) as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup,hookup_date

UNION ALL

select ''Cummulative'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Scope'' as Daily,

''Hook Ups'' as [Activity Name]

,count([Instrument_Tag]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

--*********************************************************

UNION ALL

---Calibration

select convert(char(10),cast(Calibration_Date as smalldatetime),111) as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID,Calibration_Date

UNION ALL

select ''Cummulative'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Scope'' as Daily,

''Calibration'' as [Activity Name]

,count([Instrument_Tag]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID

--*********************************************************

UNION ALL

---Lighting Fixtures

select convert(char(10),cast(LF_Installed as smalldatetime),111) as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed is not null

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([TAG]) as ''Fixture Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

group by lf_ref_desc,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Cable Tray

select convert(char(10),cast([IN_Tray_Installed] as smalldatetime),111) as Daily,

''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] is not null

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

AND Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([IN_Tray_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblINSCableTray

where active=1

AND tblInsCableTray.IN_Tray_Type <>''F&G''

group by [IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---MSC Cable Pulling

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] is not null

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Cummulative'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 1 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 2 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 3 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 4 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Scope'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Length]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblMSCCable

where active=1

group by IC_Plan_P6_ActID_Pulling,type

--******************************************************************

UNION ALL

---Loop

select convert(char(10),cast(L_Done as smalldatetime),111) as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by L_Done,ACTIVITYID

UNION ALL

select ''Cummulative'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by ACTIVITYID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by L_Done,ACTIVITYID

UNION ALL

select ''Scope'' as Daily,

''Loop'' as [Activity Name]

,count(loopname) as ''Scope'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by ACTIVITYID

--*********************************************************

--******************************************************************

) as X

 

PIVOT

(sum (Pulled) for Daily in ('+ @col +',Scope,[Cummulative],[Last 1 Weekly],[Last 2 Weekly],[Last 3 Weekly],[Last 4 Weekly],weekly)

)as X1

) as X2

RIGHT JOIN tblActIDS AS ACTIVITIES ON X2.ActID = ACTIVITIES.ActID

WHERE ACTIVITIES.ResourceId IS NOT NULL AND ResourceId LIKE ''%IN%''

group by ACTIVITIES.SubCon,ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM,ACTIVITIES.[Location]

) AS vInfo

INNER JOIN (

SELECT

ResourceId,ResourceName,Subcon,[Location]

,SUM(PCS_Budget) AS PCSBudget

FROM tblActIDS

GROUP BY ResourceId,ResourceName,Subcon,[Location]

) AS ResBudget

ON vInfo.ResourceId = ResBudget.ResourceId AND vInfo.subcon = ResBudget.Subcon

                AND (CASE WHEN vInfo.[Location] IS NULL THEN ''UNDEFINED'' ELSE vInfo.[Location] END) = (CASE WHEN ResBudget.[Location] IS NULL THEN ''UNDEFINED'' ELSE ResBudget.[Location] END)

' 

execute(@result)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DailyTrackingResourceAllInsPackage'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.DailyTrackingResourceAllInsPackage
END
GO
CREATE PROC [dbo].[DailyTrackingResourceAllInsPackage]

AS

declare @col as nvarchar(max)

declare @colSUM as nvarchar(max)

declare @result as nvarchar(max)

declare @startdate as char(10)

declare @enddate as char(10)

declare @startdate0 as date

declare @enddate0 as date

declare @colWeek4 as nvarchar(50)

declare @colWeek3 as nvarchar(50)

declare @colWeek2 as nvarchar(50)

declare @colWeek1 as nvarchar(50)

 

select @enddate0 =  [tmp_date] from [tblTMP] where [tmp_id]=1--convert(char(10),cast(getdate() as smalldatetime),111)

select @startdate0 = dateadd(d,-6,@enddate0) --'04/11/2015'

set @enddate =  convert(char(10),cast(@enddate0 as smalldatetime),111)

set @startdate = convert(char(10),cast(@startdate0 as smalldatetime),111)

 

select @colWeek4 = '[' + FORMAT(DATEADD(DAY, -28, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -28, @enddate0), 'MMM') + ']'

select @colWeek3 = '[' + FORMAT(DATEADD(DAY, -21, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -21, @enddate0), 'MMM') + ']'

select @colWeek2 = '[' + FORMAT(DATEADD(DAY, -14, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -14, @enddate0), 'MMM') + ']'

select @colWeek1 = '[' + FORMAT(DATEADD(DAY, -7, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -7, @enddate0), 'MMM') + ']'

 

select @col = STUFF((select distinct ',' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

select @colSUM =  STUFF((select distinct ',' + 'SUM(' + quotename(x.Date) + ') as ' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

 

set @result = '

 

SELECT

 

ResBudget.PCSBudget AS Scope

,CASE WHEN (ResBudget.PCSBudget - vInfo.Done) IS NULL THEN ResBudget.PCSBudget ELSE ResBudget.PCSBudget - vInfo.Done END AS Pending

,CASE WHEN ResBudget.PCSBudget = 0 THEN 0 ELSE CONVERT(FLOAT,vInfo.Done) / CONVERT(FLOAT,ResBudget.PCSBudget) END AS [% PROG]

,vInfo.*

 

FROM (

select

Package, ACTIVITIES.SubCon,ACTIVITIES.ResourceId

,CASE WHEN ACTIVITIES.[Location] = NULL THEN ACTIVITIES.ResourceName

                WHEN ACTIVITIES.[Location] = ''UNDEFINED'' THEN ACTIVITIES.ResourceName

                ELSE ACTIVITIES.ResourceName + '' - '' + REPLACE(ACTIVITIES.[Location], ''UNDEFINED'', '''')

                END AS ResourceName

 

,ACTIVITIES.UOM

,ACTIVITIES.Location

 

,sum(x2.Cummulative) as Done

,sum(x2.Weekly) as Weekly

 

,sum(x2.Cummulative) - sum(x2.Weekly) AS ' + 'CummWeek1' + '

,sum(x2.Cummulative) - sum(x2.Weekly) - sum(x2.[Last 1 Weekly]) AS ' + 'CummWeek2' + '

 

,(sum(x2.[Last 1 Weekly]) + sum(x2.[Last 2 Weekly])) / 2 AS Trend

 

,sum(x2.[Last 1 Weekly]) as ' + @colWeek1 + '

,sum(x2.[Last 2 Weekly]) as ' + @colWeek2 + '

,sum(x2.[Last 3 Weekly]) as ' + @colWeek3 + '

,sum(x2.[Last 4 Weekly]) as ' + @colWeek4 + '

 

 

,'+ @colSUM +'

 

 

 

FROM

(

select Type,ActID

,CASE WHEN [Activity Name] =''Electrical Cable Connection 01'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Electrical Cable Connection 02'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Instrument Cable Connection 01 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 01 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

ELSE

[Activity Name]

END AS [EICA Activity]

,Scope

,case when Cummulative is null then 0 else Cummulative end as Cummulative

,CASE WHEN [Last 4 Weekly] IS NULL THEN 0 ELSE [Last 4 Weekly] END AS [Last 4 Weekly]

,CASE WHEN [Last 3 Weekly] IS NULL THEN 0 ELSE [Last 3 Weekly] END AS [Last 3 Weekly]

,CASE WHEN [Last 2 Weekly] IS NULL THEN 0 ELSE [Last 2 Weekly] END AS [Last 2 Weekly]

,CASE WHEN [Last 1 Weekly] IS NULL THEN 0 ELSE [Last 1 Weekly] END AS [Last 1 Weekly]

,CASE WHEN Weekly IS NULL THEN 0 ELSE WEEKLY END AS Weekly

,'+ @col +' FROM

 

--******************************************************************

(---Electrical Cable Pulling            

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[EC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] is not null

group by EC_TYPE,[EC_Plan_Pulled_Date],EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([EC_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

tblEleCableList

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL
--******************************************************************
---Universal Equipment

select convert(char(10),cast(installedDate as smalldatetime),111) as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment WHERE active=1

and installedDate is not null

group by Discipline,installedDate,ActID

UNION ALL

select ''Cummulative'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,installedDate,ActID

UNION ALL

select ''Scope'' as Daily,

Discipline as [Activity Name]

,count(Tag) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

group by Discipline,ActID

--*********************************************************

UNION ALL

--******************************************************************

---Instrument Cable Pulling         

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([IC_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblInsCableList

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

---Electrical Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] is not null

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Electrical Cable Tray

select convert(char(10),cast([EL_Tray_Installed_date] as smalldatetime),111) as Daily,

''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

where [Production_Date] is not null

) as vETrayPro

where active=1

group by EL_Tray_Type,[EL_Tray_Installed_date],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by EL_Tray_Type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([EL_Tray_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblEleCableTray

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---Instrument Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrument Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrument Installation - Stand Alone/Field

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Installation - In Line

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Hook Ups

select convert(char(10),cast(HookUp_Date as smalldatetime),111) as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup,hookup_date

UNION ALL

select ''Cummulative'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Scope'' as Daily,

''Hook Ups'' as [Activity Name]

,count([Instrument_Tag]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

--*********************************************************

UNION ALL

---Calibration

select convert(char(10),cast(Calibration_Date as smalldatetime),111) as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID,Calibration_Date

UNION ALL

select ''Cummulative'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Scope'' as Daily,

''Calibration'' as [Activity Name]

,count([Instrument_Tag]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID

--*********************************************************

UNION ALL

---Lighting Fixtures

select convert(char(10),cast(LF_Installed as smalldatetime),111) as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed is not null

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([TAG]) as ''Fixture Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

group by lf_ref_desc,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Cable Tray

select convert(char(10),cast([IN_Tray_Installed] as smalldatetime),111) as Daily,

''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] is not null

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

AND Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([IN_Tray_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblINSCableTray

where active=1

AND tblInsCableTray.IN_Tray_Type <>''F&G''

group by [IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---MSC Cable Pulling

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] is not null

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Cummulative'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 1 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 2 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 3 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 4 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Scope'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Length]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblMSCCable

where active=1

group by IC_Plan_P6_ActID_Pulling,type

--******************************************************************

UNION ALL

---Loop

select convert(char(10),cast(L_Done as smalldatetime),111) as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by L_Done,ACTIVITYID

UNION ALL

select ''Cummulative'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by ACTIVITYID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by L_Done,ACTIVITYID

UNION ALL

select ''Scope'' as Daily,

''Loop'' as [Activity Name]

,count(loopname) as ''Scope'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by ACTIVITYID

--*********************************************************

UNION ALL
---Electrical Cable Glanding 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Glanding 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] is not null

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Cummulative'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 1 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 2 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 3 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 4 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Scope'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,(count([iC_id]))*2 as ''Gland'',''Instrumentation'' as [Type],''Each'' as [Unit]

,IC_Plan_P6_ActID_Connect + ''-GL'' as ActID

FROM tblInsCableList

Where active = 1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

--**********************************************************************************

--******************************************************************

) as X

 

PIVOT

(sum (Pulled) for Daily in ('+ @col +',Scope,[Cummulative],[Last 1 Weekly],[Last 2 Weekly],[Last 3 Weekly],[Last 4 Weekly],weekly)

)as X1

) as X2

RIGHT JOIN tblActIDS AS ACTIVITIES ON X2.ActID = ACTIVITIES.ActID

WHERE ACTIVITIES.ResourceId IS NOT NULL AND ResourceId LIKE ''%IN%''

group by ACTIVITIES.SubCon,ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM,ACTIVITIES.[Location], ACTIVITIES.Package

) AS vInfo

INNER JOIN (

SELECT

ResourceId,ResourceName,Subcon,[Location], Package

,SUM(PCS_Budget) AS PCSBudget

FROM tblActIDS

GROUP BY ResourceId,ResourceName,Subcon,[Location], Package

) AS ResBudget

ON 
    vInfo.Package = ResBudget.Package
    AND vInfo.ResourceId = ResBudget.ResourceId AND vInfo.subcon = ResBudget.Subcon
    AND (CASE WHEN vInfo.[Location] IS NULL THEN ''UNDEFINED'' ELSE vInfo.[Location] END) = (CASE WHEN ResBudget.[Location] IS NULL THEN ''UNDEFINED'' ELSE ResBudget.[Location] END)

' 

execute(@result)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DailyTrackingResourceAllSubCEle'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.DailyTrackingResourceAllSubCEle
END
GO
CREATE PROC [dbo].[DailyTrackingResourceAllSubCEle]

 

AS

 

declare @col as nvarchar(max)

declare @colSUM as nvarchar(max)

declare @result as nvarchar(max)

declare @startdate as char(10)

declare @enddate as char(10)

declare @startdate0 as date

declare @enddate0 as date

declare @colWeek4 as nvarchar(50)

declare @colWeek3 as nvarchar(50)

declare @colWeek2 as nvarchar(50)

declare @colWeek1 as nvarchar(50)

 

select @enddate0 =  [tmp_date] from [tblTMP] where [tmp_id]=1--convert(char(10),cast(getdate() as smalldatetime),111)

select @startdate0 = dateadd(d,-6,@enddate0) --'04/11/2015'

set @enddate =  convert(char(10),cast(@enddate0 as smalldatetime),111)

set @startdate = convert(char(10),cast(@startdate0 as smalldatetime),111)

 

select @colWeek4 = '[' + FORMAT(DATEADD(DAY, -28, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -28, @enddate0), 'MMM') + ']'

select @colWeek3 = '[' + FORMAT(DATEADD(DAY, -21, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -21, @enddate0), 'MMM') + ']'

select @colWeek2 = '[' + FORMAT(DATEADD(DAY, -14, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -14, @enddate0), 'MMM') + ']'

select @colWeek1 = '[' + FORMAT(DATEADD(DAY, -7, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -7, @enddate0), 'MMM') + ']'

 

select @col = STUFF((select distinct ',' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

select @colSUM =  STUFF((select distinct ',' + 'SUM(' + quotename(x.Date) + ') as ' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

 

set @result = '

 

SELECT

 

ResBudget.PCSBudget AS Scope

,CASE WHEN (ResBudget.PCSBudget - vInfo.Done) IS NULL THEN ResBudget.PCSBudget ELSE ResBudget.PCSBudget - vInfo.Done END AS Pending

,CASE WHEN ResBudget.PCSBudget = 0 THEN 0 ELSE CONVERT(FLOAT,vInfo.Done) / CONVERT(FLOAT,ResBudget.PCSBudget) END AS [% PROG]

,vInfo.*

 

FROM (

select

ACTIVITIES.ResourceId

,CASE WHEN ACTIVITIES.[Location] = NULL THEN ACTIVITIES.ResourceName

                WHEN ACTIVITIES.[Location] = ''UNDEFINED'' THEN ACTIVITIES.ResourceName

                ELSE ACTIVITIES.ResourceName + '' - '' + REPLACE(ACTIVITIES.[Location], ''UNDEFINED'', '''')

                END AS ResourceName

 

,ACTIVITIES.UOM

,ACTIVITIES.Location

 

,sum(x2.Cummulative) as Done

,sum(x2.Weekly) as Weekly

 

,sum(x2.Cummulative) - sum(x2.Weekly) AS ' + 'CummWeek1' + '

,sum(x2.Cummulative) - sum(x2.Weekly) - sum(x2.[Last 1 Weekly]) AS ' + 'CummWeek2' + '

 

,(sum(x2.[Last 1 Weekly]) + sum(x2.[Last 2 Weekly])) / 2 AS Trend

 

,sum(x2.[Last 1 Weekly]) as ' + @colWeek1 + '

,sum(x2.[Last 2 Weekly]) as ' + @colWeek2 + '

,sum(x2.[Last 3 Weekly]) as ' + @colWeek3 + '

,sum(x2.[Last 4 Weekly]) as ' + @colWeek4 + '

 

 

,'+ @colSUM +'

 

 

 

FROM

(

select Type,ActID

,CASE WHEN [Activity Name] =''Electrical Cable Connection 01'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Electrical Cable Connection 02'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Instrument Cable Connection 01 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 01 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

ELSE

[Activity Name]

END AS [EICA Activity]

,Scope

,case when Cummulative is null then 0 else Cummulative end as Cummulative

,CASE WHEN [Last 4 Weekly] IS NULL THEN 0 ELSE [Last 4 Weekly] END AS [Last 4 Weekly]

,CASE WHEN [Last 3 Weekly] IS NULL THEN 0 ELSE [Last 3 Weekly] END AS [Last 3 Weekly]

,CASE WHEN [Last 2 Weekly] IS NULL THEN 0 ELSE [Last 2 Weekly] END AS [Last 2 Weekly]

,CASE WHEN [Last 1 Weekly] IS NULL THEN 0 ELSE [Last 1 Weekly] END AS [Last 1 Weekly]

,CASE WHEN Weekly IS NULL THEN 0 ELSE WEEKLY END AS Weekly

,'+ @col +' FROM

 

--******************************************************************

(---Electrical Cable Pulling            

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[EC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] is not null

group by EC_TYPE,[EC_Plan_Pulled_Date],EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([EC_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

tblEleCableList

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

--******************************************************************
UNION ALL
--******************************************************************
---Universal Equipment

select convert(char(10),cast(installedDate as smalldatetime),111) as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment WHERE active=1

and installedDate is not null

group by Discipline,installedDate,ActID

UNION ALL

select ''Cummulative'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,installedDate,ActID

UNION ALL

select ''Scope'' as Daily,

Discipline as [Activity Name]

,count(Tag) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

group by Discipline,ActID

--*********************************************************



UNION ALL

--******************************************************************

---Instrument Cable Pulling         

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([IC_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblInsCableList

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

---Electrical Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] is not null

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Electrical Cable Tray

select convert(char(10),cast([EL_Tray_Installed_date] as smalldatetime),111) as Daily,

''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

where [Production_Date] is not null

) as vETrayPro

where active=1

group by EL_Tray_Type,[EL_Tray_Installed_date],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by EL_Tray_Type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([EL_Tray_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblEleCableTray

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---Instrument Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrument Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Cummulative'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 1 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 2 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 3 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 4 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Scope'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,(count([iC_id]))*2 as ''Gland'',''Instrumentation'' as [Type],''Each'' as [Unit]

,IC_Plan_P6_ActID_Connect as ActID

FROM tblInsCableList

Where active = 1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

--**********************************************************************************

UNION ALL

---Instrument Installation - Stand Alone/Field

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Installation - In Line

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Hook Ups

select convert(char(10),cast(HookUp_Date as smalldatetime),111) as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup,hookup_date

UNION ALL

select ''Cummulative'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Scope'' as Daily,

''Hook Ups'' as [Activity Name]

,count([Instrument_Tag]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

--*********************************************************

UNION ALL

---Calibration

select convert(char(10),cast(Calibration_Date as smalldatetime),111) as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID,Calibration_Date

UNION ALL

select ''Cummulative'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Scope'' as Daily,

''Calibration'' as [Activity Name]

,count([Instrument_Tag]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID

--*********************************************************

UNION ALL

---Lighting Fixtures

select convert(char(10),cast(LF_Installed as smalldatetime),111) as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed is not null

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([TAG]) as ''Fixture Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

group by lf_ref_desc,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Cable Tray

select convert(char(10),cast([IN_Tray_Installed] as smalldatetime),111) as Daily,

''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] is not null

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

AND Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([IN_Tray_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblINSCableTray

where active=1

AND tblInsCableTray.IN_Tray_Type <>''F&G''

group by [IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---MSC Cable Pulling

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] is not null

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Cummulative'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 1 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 2 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 3 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 4 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Scope'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Length]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblMSCCable

where active=1

group by IC_Plan_P6_ActID_Pulling,type

--******************************************************************

UNION ALL

---Loop

select convert(char(10),cast(L_Done as smalldatetime),111) as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by L_Done,ACTIVITYID

UNION ALL

select ''Cummulative'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by ACTIVITYID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by L_Done,ACTIVITYID

UNION ALL

select ''Scope'' as Daily,

''Loop'' as [Activity Name]

,count(loopname) as ''Scope'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by ACTIVITYID

--*********************************************************

--******************************************************************

) as X

 

PIVOT

(sum (Pulled) for Daily in ('+ @col +',Scope,[Cummulative],[Last 1 Weekly],[Last 2 Weekly],[Last 3 Weekly],[Last 4 Weekly],weekly)

)as X1

) as X2

RIGHT JOIN tblActIDS AS ACTIVITIES ON X2.ActID = ACTIVITIES.ActID

WHERE ACTIVITIES.ResourceId IS NOT NULL AND ResourceId LIKE ''%EL%''

group by ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM,ACTIVITIES.[Location]

) AS vInfo

INNER JOIN (

SELECT

ResourceId,ResourceName,[Location]

,SUM(PCS_Budget) AS PCSBudget

FROM tblActIDS

GROUP BY ResourceId,ResourceName,[Location]

) AS ResBudget

ON vInfo.ResourceId = ResBudget.ResourceId

                AND (CASE WHEN vInfo.[Location] IS NULL THEN ''UNDEFINED'' ELSE vInfo.[Location] END) = (CASE WHEN ResBudget.[Location] IS NULL THEN ''UNDEFINED'' ELSE ResBudget.[Location] END)

' 

execute(@result)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DailyTrackingResourceAllSubCIns'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.DailyTrackingResourceAllSubCIns
END
GO
CREATE PROC [dbo].[DailyTrackingResourceAllSubCIns]
AS

 

declare @col as nvarchar(max)

declare @colSUM as nvarchar(max)

declare @result as nvarchar(max)

declare @startdate as char(10)

declare @enddate as char(10)

declare @startdate0 as date

declare @enddate0 as date

declare @colWeek4 as nvarchar(50)

declare @colWeek3 as nvarchar(50)

declare @colWeek2 as nvarchar(50)

declare @colWeek1 as nvarchar(50)

 

select @enddate0 =  [tmp_date] from [tblTMP] where [tmp_id]=1--convert(char(10),cast(getdate() as smalldatetime),111)

select @startdate0 = dateadd(d,-6,@enddate0) --'04/11/2015'

set @enddate =  convert(char(10),cast(@enddate0 as smalldatetime),111)

set @startdate = convert(char(10),cast(@startdate0 as smalldatetime),111)

 

select @colWeek4 = '[' + FORMAT(DATEADD(DAY, -28, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -28, @enddate0), 'MMM') + ']'

select @colWeek3 = '[' + FORMAT(DATEADD(DAY, -21, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -21, @enddate0), 'MMM') + ']'

select @colWeek2 = '[' + FORMAT(DATEADD(DAY, -14, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -14, @enddate0), 'MMM') + ']'

select @colWeek1 = '[' + FORMAT(DATEADD(DAY, -7, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -7, @enddate0), 'MMM') + ']'

 

select @col = STUFF((select distinct ',' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

select @colSUM =  STUFF((select distinct ',' + 'SUM(' + quotename(x.Date) + ') as ' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

 

set @result = '

 

SELECT

 

ResBudget.PCSBudget AS Scope

,CASE WHEN (ResBudget.PCSBudget - vInfo.Done) IS NULL THEN ResBudget.PCSBudget ELSE ResBudget.PCSBudget - vInfo.Done END AS Pending

,CASE WHEN ResBudget.PCSBudget = 0 THEN 0 ELSE CONVERT(FLOAT,vInfo.Done) / CONVERT(FLOAT,ResBudget.PCSBudget) END AS [% PROG]

,vInfo.*

 

FROM (

select

ACTIVITIES.ResourceId

,CASE WHEN ACTIVITIES.[Location] = NULL THEN ACTIVITIES.ResourceName

                WHEN ACTIVITIES.[Location] = ''UNDEFINED'' THEN ACTIVITIES.ResourceName

                ELSE ACTIVITIES.ResourceName + '' - '' + REPLACE(ACTIVITIES.[Location], ''UNDEFINED'', '''')

                END AS ResourceName

 

,ACTIVITIES.UOM

,ACTIVITIES.Location

 

,sum(x2.Cummulative) as Done

,sum(x2.Weekly) as Weekly

 

,sum(x2.Cummulative) - sum(x2.Weekly) AS ' + 'CummWeek1' + '

,sum(x2.Cummulative) - sum(x2.Weekly) - sum(x2.[Last 1 Weekly]) AS ' + 'CummWeek2' + '

 

,(sum(x2.[Last 1 Weekly]) + sum(x2.[Last 2 Weekly])) / 2 AS Trend

 

,sum(x2.[Last 1 Weekly]) as ' + @colWeek1 + '

,sum(x2.[Last 2 Weekly]) as ' + @colWeek2 + '

,sum(x2.[Last 3 Weekly]) as ' + @colWeek3 + '

,sum(x2.[Last 4 Weekly]) as ' + @colWeek4 + '

 

 

,'+ @colSUM +'

 

 

FROM

(

select Type,ActID

,CASE WHEN [Activity Name] =''Electrical Cable Connection 01'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Electrical Cable Connection 02'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Instrument Cable Connection 01 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 01 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

ELSE

[Activity Name]

END AS [EICA Activity]

,Scope

,case when Cummulative is null then 0 else Cummulative end as Cummulative

,CASE WHEN [Last 4 Weekly] IS NULL THEN 0 ELSE [Last 4 Weekly] END AS [Last 4 Weekly]

,CASE WHEN [Last 3 Weekly] IS NULL THEN 0 ELSE [Last 3 Weekly] END AS [Last 3 Weekly]

,CASE WHEN [Last 2 Weekly] IS NULL THEN 0 ELSE [Last 2 Weekly] END AS [Last 2 Weekly]

,CASE WHEN [Last 1 Weekly] IS NULL THEN 0 ELSE [Last 1 Weekly] END AS [Last 1 Weekly]

,CASE WHEN Weekly IS NULL THEN 0 ELSE WEEKLY END AS Weekly

,'+ @col +' FROM

 

--******************************************************************

(---Electrical Cable Pulling            

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[EC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] is not null

group by EC_TYPE,[EC_Plan_Pulled_Date],EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([EC_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

tblEleCableList

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL
--******************************************************************
---Universal Equipment

select convert(char(10),cast(installedDate as smalldatetime),111) as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment WHERE active=1

and installedDate is not null

group by Discipline,installedDate,ActID

UNION ALL

select ''Cummulative'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,installedDate,ActID

UNION ALL

select ''Scope'' as Daily,

Discipline as [Activity Name]

,count(Tag) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

group by Discipline,ActID

--*********************************************************

UNION ALL

--******************************************************************

---Instrument Cable Pulling         

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([IC_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblInsCableList

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

---Electrical Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] is not null

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Electrical Cable Tray

select convert(char(10),cast([EL_Tray_Installed_date] as smalldatetime),111) as Daily,

''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

where [Production_Date] is not null

) as vETrayPro

where active=1

group by EL_Tray_Type,[EL_Tray_Installed_date],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by EL_Tray_Type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([EL_Tray_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblEleCableTray

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---Instrument Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrument Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrument Installation - Stand Alone/Field

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Installation - In Line

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Hook Ups

select convert(char(10),cast(HookUp_Date as smalldatetime),111) as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup,hookup_date

UNION ALL

select ''Cummulative'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Scope'' as Daily,

''Hook Ups'' as [Activity Name]

,count([Instrument_Tag]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

--*********************************************************

UNION ALL

---Calibration

select convert(char(10),cast(Calibration_Date as smalldatetime),111) as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID,Calibration_Date

UNION ALL

select ''Cummulative'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Scope'' as Daily,

''Calibration'' as [Activity Name]

,count([Instrument_Tag]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID

--*********************************************************

UNION ALL

---Lighting Fixtures

select convert(char(10),cast(LF_Installed as smalldatetime),111) as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed is not null

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([TAG]) as ''Fixture Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

group by lf_ref_desc,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Cable Tray

select convert(char(10),cast([IN_Tray_Installed] as smalldatetime),111) as Daily,

''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] is not null

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

AND Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([IN_Tray_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblINSCableTray

where active=1

AND tblInsCableTray.IN_Tray_Type <>''F&G''

group by [IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---MSC Cable Pulling

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] is not null

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Cummulative'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 1 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 2 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 3 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 4 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Scope'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Length]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblMSCCable

where active=1

group by IC_Plan_P6_ActID_Pulling,type

--******************************************************************

UNION ALL

---Loop

select convert(char(10),cast(L_Done as smalldatetime),111) as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by L_Done,ACTIVITYID

UNION ALL

select ''Cummulative'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by ACTIVITYID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by L_Done,ACTIVITYID

UNION ALL

select ''Scope'' as Daily,

''Loop'' as [Activity Name]

,count(loopname) as ''Scope'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by ACTIVITYID

--*********************************************************

UNION ALL

---Electrical Cable Glanding 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Glanding 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] is not null

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************
UNION ALL

---Instrumentation Cable Glanding

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Cummulative'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 1 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 2 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 3 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 4 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Scope'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,(count([iC_id]))*2 as ''Gland'',''Instrumentation'' as [Type],''Each'' as [Unit]

,IC_Plan_P6_ActID_Connect as ActID

FROM tblInsCableList

Where active = 1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

--**********************************************************************************

--******************************************************************

) as X

 

PIVOT

(sum (Pulled) for Daily in ('+ @col +',Scope,[Cummulative],[Last 1 Weekly],[Last 2 Weekly],[Last 3 Weekly],[Last 4 Weekly],weekly)

)as X1

) as X2

RIGHT JOIN tblActIDS AS ACTIVITIES ON X2.ActID = ACTIVITIES.ActID

WHERE ACTIVITIES.ResourceId IS NOT NULL AND ResourceId LIKE ''%IN%''

group by ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM,ACTIVITIES.[Location]

) AS vInfo

INNER JOIN (

SELECT

ResourceId,ResourceName,[Location]

,SUM(PCS_Budget) AS PCSBudget

FROM tblActIDS

GROUP BY ResourceId,ResourceName,[Location]

) AS ResBudget

ON vInfo.ResourceId = ResBudget.ResourceId

                AND (CASE WHEN vInfo.[Location] IS NULL THEN ''UNDEFINED'' ELSE vInfo.[Location] END) = (CASE WHEN ResBudget.[Location] IS NULL THEN ''UNDEFINED'' ELSE ResBudget.[Location] END)

' 

execute(@result)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DailyTrackingResourceUnitEle'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.DailyTrackingResourceUnitEle
END
GO
CREATE PROC [dbo].[DailyTrackingResourceUnitEle]

AS

 

declare @col as nvarchar(max)

declare @colSUM as nvarchar(max)

declare @result as nvarchar(max)

declare @startdate as char(10)

declare @enddate as char(10)

declare @startdate0 as date

declare @enddate0 as date

declare @colWeek4 as nvarchar(50)

declare @colWeek3 as nvarchar(50)

declare @colWeek2 as nvarchar(50)

declare @colWeek1 as nvarchar(50)

 

select @enddate0 =  [tmp_date] from [tblTMP] where [tmp_id]=1--convert(char(10),cast(getdate() as smalldatetime),111)

select @startdate0 = dateadd(d,-6,@enddate0) --'04/11/2015'

set @enddate =  convert(char(10),cast(@enddate0 as smalldatetime),111)

set @startdate = convert(char(10),cast(@startdate0 as smalldatetime),111)

 

select @colWeek4 = '[' + FORMAT(DATEADD(DAY, -28, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -28, @enddate0), 'MMM') + ']'

select @colWeek3 = '[' + FORMAT(DATEADD(DAY, -21, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -21, @enddate0), 'MMM') + ']'

select @colWeek2 = '[' + FORMAT(DATEADD(DAY, -14, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -14, @enddate0), 'MMM') + ']'

select @colWeek1 = '[' + FORMAT(DATEADD(DAY, -7, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -7, @enddate0), 'MMM') + ']'

 

select @col = STUFF((select distinct ',' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

select @colSUM =  STUFF((select distinct ',' + 'SUM(' + quotename(x.Date) + ') as ' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

 

set @result = '

 

SELECT

vInfo.*

,ResBudget.PCSBudget AS Scope

,ResBudget.PCSBudget - vInfo.Done AS Pending

,CASE WHEN ResBudget.PCSBudget = 0 THEN 0 ELSE CONVERT(FLOAT,vInfo.Done) / CONVERT(FLOAT,ResBudget.PCSBudget) END AS [% PROG]

 

FROM (

select

ACTIVITIES.PCS_Area,ACTIVITIES.SubCon,ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM

 

 

,sum(x2.Cummulative) as Done

,sum(x2.Weekly) as Weekly

 

,(sum(x2.[Last 1 Weekly]) + sum(x2.[Last 2 Weekly])) / 2 AS Trend

 

,sum(x2.[Last 1 Weekly]) as ' + @colWeek1 + '

,sum(x2.[Last 2 Weekly]) as ' + @colWeek2 + '

,sum(x2.[Last 3 Weekly]) as ' + @colWeek3 + '

,sum(x2.[Last 4 Weekly]) as ' + @colWeek4 + '

 

 

,'+ @colSUM +'

 

 

 

FROM

(

select Type,ActID

,CASE WHEN [Activity Name] =''Electrical Cable Connection 01'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Electrical Cable Connection 02'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Instrument Cable Connection 01 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 01 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

ELSE

[Activity Name]

END AS [EICA Activity]

,Scope

,case when Cummulative is null then 0 else Cummulative end as Cummulative

,CASE WHEN [Last 4 Weekly] IS NULL THEN 0 ELSE [Last 4 Weekly] END AS [Last 4 Weekly]

,CASE WHEN [Last 3 Weekly] IS NULL THEN 0 ELSE [Last 3 Weekly] END AS [Last 3 Weekly]

,CASE WHEN [Last 2 Weekly] IS NULL THEN 0 ELSE [Last 2 Weekly] END AS [Last 2 Weekly]

,CASE WHEN [Last 1 Weekly] IS NULL THEN 0 ELSE [Last 1 Weekly] END AS [Last 1 Weekly]

,CASE WHEN Weekly IS NULL THEN 0 ELSE WEEKLY END AS Weekly

,'+ @col +' FROM

 

--******************************************************************

(---Electrical Cable Pulling             

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[EC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] is not null

group by EC_TYPE,[EC_Plan_Pulled_Date],EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([EC_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

tblEleCableList

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL
--******************************************************************
---Universal Equipment

select convert(char(10),cast(installedDate as smalldatetime),111) as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment WHERE active=1

and installedDate is not null

group by Discipline,installedDate,ActID

UNION ALL

select ''Cummulative'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,installedDate,ActID

UNION ALL

select ''Scope'' as Daily,

Discipline as [Activity Name]

,count(Tag) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

group by Discipline,ActID

--*********************************************************


UNION ALL

--******************************************************************

---Instrument Cable Pulling          

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([IC_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblInsCableList

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

---Electrical Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] is not null

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Electrical Cable Tray

select convert(char(10),cast([EL_Tray_Installed_date] as smalldatetime),111) as Daily,

''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

where [Production_Date] is not null

) as vETrayPro

where active=1

group by EL_Tray_Type,[EL_Tray_Installed_date],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by EL_Tray_Type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([EL_Tray_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblEleCableTray

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---Instrument Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrument Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Cummulative'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 1 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 2 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 3 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 4 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Scope'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,(count([iC_id]))*2 as ''Gland'',''Instrumentation'' as [Type],''Each'' as [Unit]

,IC_Plan_P6_ActID_Connect as ActID

FROM tblInsCableList

Where active = 1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

--**********************************************************************************

UNION ALL

---Instrument Installation - Stand Alone/Field

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Installation - In Line

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Hook Ups

select convert(char(10),cast(HookUp_Date as smalldatetime),111) as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup,hookup_date

UNION ALL

select ''Cummulative'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Scope'' as Daily,

''Hook Ups'' as [Activity Name]

,count([Instrument_Tag]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

--*********************************************************

UNION ALL

---Calibration

select convert(char(10),cast(Calibration_Date as smalldatetime),111) as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID,Calibration_Date

UNION ALL

select ''Cummulative'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Scope'' as Daily,

''Calibration'' as [Activity Name]

,count([Instrument_Tag]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID

--*********************************************************

UNION ALL

---Lighting Fixtures

select convert(char(10),cast(LF_Installed as smalldatetime),111) as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed is not null

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([TAG]) as ''Fixture Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

group by lf_ref_desc,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Cable Tray

select convert(char(10),cast([IN_Tray_Installed] as smalldatetime),111) as Daily,

''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] is not null

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

AND Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([IN_Tray_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblINSCableTray

where active=1

AND tblInsCableTray.IN_Tray_Type <>''F&G''

group by [IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---MSC Cable Pulling

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] is not null

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Cummulative'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 1 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 2 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 3 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 4 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Scope'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Length]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblMSCCable

where active=1

group by IC_Plan_P6_ActID_Pulling,type

--******************************************************************

UNION ALL

---Loop

select convert(char(10),cast(L_Done as smalldatetime),111) as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by L_Done,ACTIVITYID

UNION ALL

select ''Cummulative'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by ACTIVITYID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by L_Done,ACTIVITYID

UNION ALL

select ''Scope'' as Daily,

''Loop'' as [Activity Name]

,count(loopname) as ''Scope'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by ACTIVITYID

--*********************************************************

--******************************************************************

) as X

 

PIVOT

(sum (Pulled) for Daily in ('+ @col +',Scope,[Cummulative],[Last 1 Weekly],[Last 2 Weekly],[Last 3 Weekly],[Last 4 Weekly],weekly)

)as X1

) as X2

RIGHT JOIN tblActIDS AS ACTIVITIES ON X2.ActID = ACTIVITIES.ActID

WHERE ACTIVITIES.ResourceId IS NOT NULL AND ResourceId LIKE ''%EL%''

group by ACTIVITIES.PCS_Area,ACTIVITIES.SubCon,ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM

) AS vInfo

INNER JOIN (

SELECT

ResourceId,ResourceName,Subcon,PCS_Area

,SUM(PCS_Budget) AS PCSBudget

FROM tblActIDS

GROUP BY ResourceId,ResourceName,Subcon,PCS_Area

) AS ResBudget

ON vInfo.ResourceId = ResBudget.ResourceId AND vInfo.subcon = ResBudget.Subcon AND vInfo.PCS_Area = ResBudget.PCS_Area

' 

execute(@result)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DailyTrackingResourceUnitFilterEle'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.DailyTrackingResourceUnitFilterEle
END
GO
CREATE PROC [dbo].[DailyTrackingResourceUnitFilterEle]

@unit NVARCHAR(255)

 

AS

 

declare @col as nvarchar(max)

declare @colSUM as nvarchar(max)

declare @result as nvarchar(max)

declare @startdate as char(10)

declare @enddate as char(10)

declare @startdate0 as date

declare @enddate0 as date

declare @colWeek4 as nvarchar(50)

declare @colWeek3 as nvarchar(50)

declare @colWeek2 as nvarchar(50)

declare @colWeek1 as nvarchar(50)

 

select @enddate0 =  [tmp_date] from [tblTMP] where [tmp_id]=1--convert(char(10),cast(getdate() as smalldatetime),111)

select @startdate0 = dateadd(d,-6,@enddate0) --'04/11/2015'

set @enddate =  convert(char(10),cast(@enddate0 as smalldatetime),111)

set @startdate = convert(char(10),cast(@startdate0 as smalldatetime),111)

 

select @colWeek4 = '[' + FORMAT(DATEADD(DAY, -28, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -28, @enddate0), 'MMM') + ']'

select @colWeek3 = '[' + FORMAT(DATEADD(DAY, -21, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -21, @enddate0), 'MMM') + ']'

select @colWeek2 = '[' + FORMAT(DATEADD(DAY, -14, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -14, @enddate0), 'MMM') + ']'

select @colWeek1 = '[' + FORMAT(DATEADD(DAY, -7, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -7, @enddate0), 'MMM') + ']'

 

select @col = STUFF((select distinct ',' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

select @colSUM =  STUFF((select distinct ',' + 'SUM(' + quotename(x.Date) + ') as ' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

 

set @result = '

 

SELECT

vInfo.*

,ResBudget.PCSBudget AS Scope

,ResBudget.PCSBudget - vInfo.Done AS Pending

,CASE WHEN ResBudget.PCSBudget = 0 THEN 0 ELSE CONVERT(FLOAT,vInfo.Done) / CONVERT(FLOAT,ResBudget.PCSBudget) END AS [% PROG]

 

FROM (

select

ACTIVITIES.PCS_Area,ACTIVITIES.SubCon,ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM

 

 

,sum(x2.Cummulative) as Done

,sum(x2.Weekly) as Weekly

 

,(sum(x2.[Last 1 Weekly]) + sum(x2.[Last 2 Weekly])) / 2 AS Trend

 

,sum(x2.[Last 1 Weekly]) as ' + @colWeek1 + '

,sum(x2.[Last 2 Weekly]) as ' + @colWeek2 + '

,sum(x2.[Last 3 Weekly]) as ' + @colWeek3 + '

,sum(x2.[Last 4 Weekly]) as ' + @colWeek4 + '

 

,'+ @colSUM +'

 

 

 

FROM

(

select Type,ActID

,CASE WHEN [Activity Name] =''Electrical Cable Connection 01'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Electrical Cable Connection 02'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Instrument Cable Connection 01 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 01 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

ELSE

[Activity Name]

END AS [EICA Activity]

,Scope

,case when Cummulative is null then 0 else Cummulative end as Cummulative

,CASE WHEN [Last 4 Weekly] IS NULL THEN 0 ELSE [Last 4 Weekly] END AS [Last 4 Weekly]

,CASE WHEN [Last 3 Weekly] IS NULL THEN 0 ELSE [Last 3 Weekly] END AS [Last 3 Weekly]

,CASE WHEN [Last 2 Weekly] IS NULL THEN 0 ELSE [Last 2 Weekly] END AS [Last 2 Weekly]

,CASE WHEN [Last 1 Weekly] IS NULL THEN 0 ELSE [Last 1 Weekly] END AS [Last 1 Weekly]

,CASE WHEN Weekly IS NULL THEN 0 ELSE WEEKLY END AS Weekly

,'+ @col +' FROM

 

--******************************************************************

(---Electrical Cable Pulling             

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[EC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] is not null

group by EC_TYPE,[EC_Plan_Pulled_Date],EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([EC_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

tblEleCableList

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL
--******************************************************************
---Universal Equipment

select convert(char(10),cast(installedDate as smalldatetime),111) as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment WHERE active=1

and installedDate is not null

group by Discipline,installedDate,ActID

UNION ALL

select ''Cummulative'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,installedDate,ActID

UNION ALL

select ''Scope'' as Daily,

Discipline as [Activity Name]

,count(Tag) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

group by Discipline,ActID

--*********************************************************


UNION ALL

--******************************************************************

---Instrument Cable Pulling          

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([IC_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblInsCableList

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

---Electrical Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] is not null

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Electrical Cable Tray

select convert(char(10),cast([EL_Tray_Installed_date] as smalldatetime),111) as Daily,

''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

where [Production_Date] is not null

) as vETrayPro

where active=1

group by EL_Tray_Type,[EL_Tray_Installed_date],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by EL_Tray_Type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([EL_Tray_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblEleCableTray

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---Instrument Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrument Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Cummulative'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 1 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 2 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 3 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 4 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Scope'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,(count([iC_id]))*2 as ''Gland'',''Instrumentation'' as [Type],''Each'' as [Unit]

,IC_Plan_P6_ActID_Connect as ActID

FROM tblInsCableList

Where active = 1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

--**********************************************************************************


UNION ALL

---Instrument Installation - Stand Alone/Field

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Installation - In Line

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Hook Ups

select convert(char(10),cast(HookUp_Date as smalldatetime),111) as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup,hookup_date

UNION ALL

select ''Cummulative'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Scope'' as Daily,

''Hook Ups'' as [Activity Name]

,count([Instrument_Tag]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

--*********************************************************

UNION ALL

---Calibration

select convert(char(10),cast(Calibration_Date as smalldatetime),111) as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID,Calibration_Date

UNION ALL

select ''Cummulative'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Scope'' as Daily,

''Calibration'' as [Activity Name]

,count([Instrument_Tag]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID

--*********************************************************

UNION ALL

---Lighting Fixtures

select convert(char(10),cast(LF_Installed as smalldatetime),111) as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed is not null

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([TAG]) as ''Fixture Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

group by lf_ref_desc,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Cable Tray

select convert(char(10),cast([IN_Tray_Installed] as smalldatetime),111) as Daily,

''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] is not null

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

AND Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([IN_Tray_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblINSCableTray

where active=1

AND tblInsCableTray.IN_Tray_Type <>''F&G''

group by [IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---MSC Cable Pulling

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] is not null

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Cummulative'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 1 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 2 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 3 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 4 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Scope'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Length]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblMSCCable

where active=1

group by IC_Plan_P6_ActID_Pulling,type

--******************************************************************

UNION ALL

---Loop

select convert(char(10),cast(L_Done as smalldatetime),111) as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by L_Done,ACTIVITYID

UNION ALL

select ''Cummulative'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by ACTIVITYID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by L_Done,ACTIVITYID

UNION ALL

select ''Scope'' as Daily,

''Loop'' as [Activity Name]

,count(loopname) as ''Scope'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by ACTIVITYID

--*********************************************************

--******************************************************************

) as X

 

PIVOT

(sum (Pulled) for Daily in ('+ @col +',Scope,[Cummulative],[Last 1 Weekly],[Last 2 Weekly],[Last 3 Weekly],[Last 4 Weekly],weekly)

)as X1

) as X2

RIGHT JOIN tblActIDS AS ACTIVITIES ON X2.ActID = ACTIVITIES.ActID

WHERE ACTIVITIES.ResourceId IS NOT NULL AND ResourceId LIKE ''%EL%'' AND ACTIVITIES.PCS_Area = ''' + @unit + '''

group by ACTIVITIES.PCS_Area,ACTIVITIES.SubCon,ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM

) AS vInfo

INNER JOIN (

SELECT

ResourceId,ResourceName,Subcon,PCS_Area

,SUM(PCS_Budget) AS PCSBudget

FROM tblActIDS

GROUP BY ResourceId,ResourceName,Subcon,PCS_Area

) AS ResBudget

ON vInfo.ResourceId = ResBudget.ResourceId AND vInfo.subcon = ResBudget.Subcon AND vInfo.PCS_Area = ResBudget.PCS_Area

' 

execute(@result)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DailyTrackingResourceUnitFilterIns'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.DailyTrackingResourceUnitFilterIns
END
GO
CREATE PROC [dbo].[DailyTrackingResourceUnitFilterIns]

@unit NVARCHAR(255)

 

AS

 

declare @col as nvarchar(max)

declare @colSUM as nvarchar(max)

declare @result as nvarchar(max)

declare @startdate as char(10)

declare @enddate as char(10)

declare @startdate0 as date

declare @enddate0 as date

declare @colWeek4 as nvarchar(50)

declare @colWeek3 as nvarchar(50)

declare @colWeek2 as nvarchar(50)

declare @colWeek1 as nvarchar(50)

 

select @enddate0 =  [tmp_date] from [tblTMP] where [tmp_id]=1--convert(char(10),cast(getdate() as smalldatetime),111)

select @startdate0 = dateadd(d,-6,@enddate0) --'04/11/2015'

set @enddate =  convert(char(10),cast(@enddate0 as smalldatetime),111)

set @startdate = convert(char(10),cast(@startdate0 as smalldatetime),111)

 

select @colWeek4 = '[' + FORMAT(DATEADD(DAY, -28, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -28, @enddate0), 'MMM') + ']'

select @colWeek3 = '[' + FORMAT(DATEADD(DAY, -21, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -21, @enddate0), 'MMM') + ']'

select @colWeek2 = '[' + FORMAT(DATEADD(DAY, -14, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -14, @enddate0), 'MMM') + ']'

select @colWeek1 = '[' + FORMAT(DATEADD(DAY, -7, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -7, @enddate0), 'MMM') + ']'

 

select @col = STUFF((select distinct ',' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

select @colSUM =  STUFF((select distinct ',' + 'SUM(' + quotename(x.Date) + ') as ' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

 

set @result = '

 

SELECT

vInfo.*

,ResBudget.PCSBudget AS Scope

,ResBudget.PCSBudget - vInfo.Done AS Pending

,CASE WHEN ResBudget.PCSBudget = 0 THEN 0 ELSE CONVERT(FLOAT,vInfo.Done) / CONVERT(FLOAT,ResBudget.PCSBudget) END AS [% PROG]

 

FROM (

select

ACTIVITIES.PCS_Area,ACTIVITIES.SubCon,ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM

 

 

,sum(x2.Cummulative) as Done

,sum(x2.Weekly) as Weekly

 

,(sum(x2.[Last 1 Weekly]) + sum(x2.[Last 2 Weekly])) / 2 AS Trend

 

,sum(x2.[Last 1 Weekly]) as ' + @colWeek1 + '

,sum(x2.[Last 2 Weekly]) as ' + @colWeek2 + '

,sum(x2.[Last 3 Weekly]) as ' + @colWeek3 + '

,sum(x2.[Last 4 Weekly]) as ' + @colWeek4 + '

 

,'+ @colSUM +'

 

 

 

FROM

(

select Type,ActID

,CASE WHEN [Activity Name] =''Electrical Cable Connection 01'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Electrical Cable Connection 02'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Instrument Cable Connection 01 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 01 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

ELSE

[Activity Name]

END AS [EICA Activity]

,Scope

,case when Cummulative is null then 0 else Cummulative end as Cummulative

,CASE WHEN [Last 4 Weekly] IS NULL THEN 0 ELSE [Last 4 Weekly] END AS [Last 4 Weekly]

,CASE WHEN [Last 3 Weekly] IS NULL THEN 0 ELSE [Last 3 Weekly] END AS [Last 3 Weekly]

,CASE WHEN [Last 2 Weekly] IS NULL THEN 0 ELSE [Last 2 Weekly] END AS [Last 2 Weekly]

,CASE WHEN [Last 1 Weekly] IS NULL THEN 0 ELSE [Last 1 Weekly] END AS [Last 1 Weekly]

,CASE WHEN Weekly IS NULL THEN 0 ELSE WEEKLY END AS Weekly

,'+ @col +' FROM

 

--******************************************************************

(---Electrical Cable Pulling             

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[EC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] is not null

group by EC_TYPE,[EC_Plan_Pulled_Date],EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([EC_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

tblEleCableList

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL
--******************************************************************
---Universal Equipment

select convert(char(10),cast(installedDate as smalldatetime),111) as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment WHERE active=1

and installedDate is not null

group by Discipline,installedDate,ActID

UNION ALL

select ''Cummulative'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,installedDate,ActID

UNION ALL

select ''Scope'' as Daily,

Discipline as [Activity Name]

,count(Tag) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

group by Discipline,ActID

--*********************************************************

UNION ALL

--******************************************************************

---Instrument Cable Pulling          

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([IC_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblInsCableList

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

---Electrical Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] is not null

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Electrical Cable Tray

select convert(char(10),cast([EL_Tray_Installed_date] as smalldatetime),111) as Daily,

''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

where [Production_Date] is not null

) as vETrayPro

where active=1

group by EL_Tray_Type,[EL_Tray_Installed_date],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by EL_Tray_Type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([EL_Tray_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblEleCableTray

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---Instrument Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrument Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Cummulative'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 1 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 2 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 3 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 4 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Scope'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,(count([iC_id]))*2 as ''Gland'',''Instrumentation'' as [Type],''Each'' as [Unit]

,IC_Plan_P6_ActID_Connect as ActID

FROM tblInsCableList

Where active = 1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

--**********************************************************************************

UNION ALL

---Instrument Installation - Stand Alone/Field

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Installation - In Line

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Hook Ups

select convert(char(10),cast(HookUp_Date as smalldatetime),111) as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup,hookup_date

UNION ALL

select ''Cummulative'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Scope'' as Daily,

''Hook Ups'' as [Activity Name]

,count([Instrument_Tag]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

--*********************************************************

UNION ALL

---Calibration

select convert(char(10),cast(Calibration_Date as smalldatetime),111) as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID,Calibration_Date

UNION ALL

select ''Cummulative'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Scope'' as Daily,

''Calibration'' as [Activity Name]

,count([Instrument_Tag]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID

--*********************************************************

UNION ALL

---Lighting Fixtures

select convert(char(10),cast(LF_Installed as smalldatetime),111) as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed is not null

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([TAG]) as ''Fixture Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

group by lf_ref_desc,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Cable Tray

select convert(char(10),cast([IN_Tray_Installed] as smalldatetime),111) as Daily,

''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] is not null

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

AND Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([IN_Tray_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblINSCableTray

where active=1

AND tblInsCableTray.IN_Tray_Type <>''F&G''

group by [IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---MSC Cable Pulling

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] is not null

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Cummulative'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 1 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 2 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 3 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 4 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Scope'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Length]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblMSCCable

where active=1

group by IC_Plan_P6_ActID_Pulling,type

--******************************************************************

UNION ALL

---Loop

select convert(char(10),cast(L_Done as smalldatetime),111) as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by L_Done,ACTIVITYID

UNION ALL

select ''Cummulative'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by ACTIVITYID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by L_Done,ACTIVITYID

UNION ALL

select ''Scope'' as Daily,

''Loop'' as [Activity Name]

,count(loopname) as ''Scope'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by ACTIVITYID

--*********************************************************

--******************************************************************

) as X

 

PIVOT

(sum (Pulled) for Daily in ('+ @col +',Scope,[Cummulative],[Last 1 Weekly],[Last 2 Weekly],[Last 3 Weekly],[Last 4 Weekly],weekly)

)as X1

) as X2

RIGHT JOIN tblActIDS AS ACTIVITIES ON X2.ActID = ACTIVITIES.ActID

WHERE ACTIVITIES.ResourceId IS NOT NULL AND ResourceId LIKE ''%IN%'' AND ACTIVITIES.PCS_Area = ''' + @unit + '''

group by ACTIVITIES.PCS_Area,ACTIVITIES.SubCon,ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM

) AS vInfo

INNER JOIN (

SELECT

ResourceId,ResourceName,Subcon,PCS_Area

,SUM(PCS_Budget) AS PCSBudget

FROM tblActIDS

GROUP BY ResourceId,ResourceName,Subcon,PCS_Area

) AS ResBudget

ON vInfo.ResourceId = ResBudget.ResourceId AND vInfo.subcon = ResBudget.Subcon AND vInfo.PCS_Area = ResBudget.PCS_Area

' 

execute(@result)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DailyTrackingResourceUnitFilterIns'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.DailyTrackingResourceUnitFilterIns
END
GO
CREATE PROC [dbo].[DailyTrackingResourceUnitFilterIns]

@unit NVARCHAR(255)

 

AS

 

declare @col as nvarchar(max)

declare @colSUM as nvarchar(max)

declare @result as nvarchar(max)

declare @startdate as char(10)

declare @enddate as char(10)

declare @startdate0 as date

declare @enddate0 as date

declare @colWeek4 as nvarchar(50)

declare @colWeek3 as nvarchar(50)

declare @colWeek2 as nvarchar(50)

declare @colWeek1 as nvarchar(50)

 

select @enddate0 =  [tmp_date] from [tblTMP] where [tmp_id]=1--convert(char(10),cast(getdate() as smalldatetime),111)

select @startdate0 = dateadd(d,-6,@enddate0) --'04/11/2015'

set @enddate =  convert(char(10),cast(@enddate0 as smalldatetime),111)

set @startdate = convert(char(10),cast(@startdate0 as smalldatetime),111)

 

select @colWeek4 = '[' + FORMAT(DATEADD(DAY, -28, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -28, @enddate0), 'MMM') + ']'

select @colWeek3 = '[' + FORMAT(DATEADD(DAY, -21, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -21, @enddate0), 'MMM') + ']'

select @colWeek2 = '[' + FORMAT(DATEADD(DAY, -14, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -14, @enddate0), 'MMM') + ']'

select @colWeek1 = '[' + FORMAT(DATEADD(DAY, -7, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -7, @enddate0), 'MMM') + ']'

 

select @col = STUFF((select distinct ',' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

select @colSUM =  STUFF((select distinct ',' + 'SUM(' + quotename(x.Date) + ') as ' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

 

set @result = '

 

SELECT

vInfo.*

,ResBudget.PCSBudget AS Scope

,ResBudget.PCSBudget - vInfo.Done AS Pending

,CASE WHEN ResBudget.PCSBudget = 0 THEN 0 ELSE CONVERT(FLOAT,vInfo.Done) / CONVERT(FLOAT,ResBudget.PCSBudget) END AS [% PROG]

 

FROM (

select

ACTIVITIES.PCS_Area,ACTIVITIES.SubCon,ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM

 

 

,sum(x2.Cummulative) as Done

,sum(x2.Weekly) as Weekly

 

,(sum(x2.[Last 1 Weekly]) + sum(x2.[Last 2 Weekly])) / 2 AS Trend

 

,sum(x2.[Last 1 Weekly]) as ' + @colWeek1 + '

,sum(x2.[Last 2 Weekly]) as ' + @colWeek2 + '

,sum(x2.[Last 3 Weekly]) as ' + @colWeek3 + '

,sum(x2.[Last 4 Weekly]) as ' + @colWeek4 + '

 

,'+ @colSUM +'

 

 

 

FROM

(

select Type,ActID

,CASE WHEN [Activity Name] =''Electrical Cable Connection 01'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Electrical Cable Connection 02'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Instrument Cable Connection 01 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 01 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

ELSE

[Activity Name]

END AS [EICA Activity]

,Scope

,case when Cummulative is null then 0 else Cummulative end as Cummulative

,CASE WHEN [Last 4 Weekly] IS NULL THEN 0 ELSE [Last 4 Weekly] END AS [Last 4 Weekly]

,CASE WHEN [Last 3 Weekly] IS NULL THEN 0 ELSE [Last 3 Weekly] END AS [Last 3 Weekly]

,CASE WHEN [Last 2 Weekly] IS NULL THEN 0 ELSE [Last 2 Weekly] END AS [Last 2 Weekly]

,CASE WHEN [Last 1 Weekly] IS NULL THEN 0 ELSE [Last 1 Weekly] END AS [Last 1 Weekly]

,CASE WHEN Weekly IS NULL THEN 0 ELSE WEEKLY END AS Weekly

,'+ @col +' FROM

 

--******************************************************************

(---Electrical Cable Pulling             

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[EC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] is not null

group by EC_TYPE,[EC_Plan_Pulled_Date],EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([EC_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

tblEleCableList

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL
--******************************************************************
---Universal Equipment

select convert(char(10),cast(installedDate as smalldatetime),111) as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment WHERE active=1

and installedDate is not null

group by Discipline,installedDate,ActID

UNION ALL

select ''Cummulative'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,installedDate,ActID

UNION ALL

select ''Scope'' as Daily,

Discipline as [Activity Name]

,count(Tag) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

group by Discipline,ActID

--*********************************************************

UNION ALL

--******************************************************************

---Instrument Cable Pulling          

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([IC_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblInsCableList

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

---Electrical Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] is not null

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Electrical Cable Tray

select convert(char(10),cast([EL_Tray_Installed_date] as smalldatetime),111) as Daily,

''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

where [Production_Date] is not null

) as vETrayPro

where active=1

group by EL_Tray_Type,[EL_Tray_Installed_date],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by EL_Tray_Type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([EL_Tray_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblEleCableTray

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---Instrument Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrument Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Cummulative'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 1 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 2 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 3 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 4 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Scope'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,(count([iC_id]))*2 as ''Gland'',''Instrumentation'' as [Type],''Each'' as [Unit]

,IC_Plan_P6_ActID_Connect as ActID

FROM tblInsCableList

Where active = 1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

--**********************************************************************************

UNION ALL

---Instrument Installation - Stand Alone/Field

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Installation - In Line

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Hook Ups

select convert(char(10),cast(HookUp_Date as smalldatetime),111) as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup,hookup_date

UNION ALL

select ''Cummulative'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Scope'' as Daily,

''Hook Ups'' as [Activity Name]

,count([Instrument_Tag]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

--*********************************************************

UNION ALL

---Calibration

select convert(char(10),cast(Calibration_Date as smalldatetime),111) as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID,Calibration_Date

UNION ALL

select ''Cummulative'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Scope'' as Daily,

''Calibration'' as [Activity Name]

,count([Instrument_Tag]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID

--*********************************************************

UNION ALL

---Lighting Fixtures

select convert(char(10),cast(LF_Installed as smalldatetime),111) as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed is not null

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([TAG]) as ''Fixture Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

group by lf_ref_desc,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Cable Tray

select convert(char(10),cast([IN_Tray_Installed] as smalldatetime),111) as Daily,

''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] is not null

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

AND Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([IN_Tray_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblINSCableTray

where active=1

AND tblInsCableTray.IN_Tray_Type <>''F&G''

group by [IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---MSC Cable Pulling

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] is not null

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Cummulative'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 1 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 2 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 3 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 4 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Scope'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Length]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblMSCCable

where active=1

group by IC_Plan_P6_ActID_Pulling,type

--******************************************************************

UNION ALL

---Loop

select convert(char(10),cast(L_Done as smalldatetime),111) as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by L_Done,ACTIVITYID

UNION ALL

select ''Cummulative'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by ACTIVITYID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by L_Done,ACTIVITYID

UNION ALL

select ''Scope'' as Daily,

''Loop'' as [Activity Name]

,count(loopname) as ''Scope'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by ACTIVITYID

--*********************************************************

--******************************************************************

) as X

 

PIVOT

(sum (Pulled) for Daily in ('+ @col +',Scope,[Cummulative],[Last 1 Weekly],[Last 2 Weekly],[Last 3 Weekly],[Last 4 Weekly],weekly)

)as X1

) as X2

RIGHT JOIN tblActIDS AS ACTIVITIES ON X2.ActID = ACTIVITIES.ActID

WHERE ACTIVITIES.ResourceId IS NOT NULL AND ResourceId LIKE ''%IN%'' AND ACTIVITIES.PCS_Area = ''' + @unit + '''

group by ACTIVITIES.PCS_Area,ACTIVITIES.SubCon,ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM

) AS vInfo

INNER JOIN (

SELECT

ResourceId,ResourceName,Subcon,PCS_Area

,SUM(PCS_Budget) AS PCSBudget

FROM tblActIDS

GROUP BY ResourceId,ResourceName,Subcon,PCS_Area

) AS ResBudget

ON vInfo.ResourceId = ResBudget.ResourceId AND vInfo.subcon = ResBudget.Subcon AND vInfo.PCS_Area = ResBudget.PCS_Area

' 

execute(@result)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DailyTrackingResourceUnitIns'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.DailyTrackingResourceUnitIns
END
GO
CREATE PROC [dbo].[DailyTrackingResourceUnitIns]

AS

 

declare @col as nvarchar(max)

declare @colSUM as nvarchar(max)

declare @result as nvarchar(max)

declare @startdate as char(10)

declare @enddate as char(10)

declare @startdate0 as date

declare @enddate0 as date

declare @colWeek4 as nvarchar(50)

declare @colWeek3 as nvarchar(50)

declare @colWeek2 as nvarchar(50)

declare @colWeek1 as nvarchar(50)

 

 

select @enddate0 =  [tmp_date] from [tblTMP] where [tmp_id]=1--convert(char(10),cast(getdate() as smalldatetime),111)

select @startdate0 = dateadd(d,-6,@enddate0) --'04/11/2015'

set @enddate =  convert(char(10),cast(@enddate0 as smalldatetime),111)

set @startdate = convert(char(10),cast(@startdate0 as smalldatetime),111)

 

select @colWeek4 = '[' + FORMAT(DATEADD(DAY, -28, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -28, @enddate0), 'MMM') + ']'

select @colWeek3 = '[' + FORMAT(DATEADD(DAY, -21, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -21, @enddate0), 'MMM') + ']'

select @colWeek2 = '[' + FORMAT(DATEADD(DAY, -14, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -14, @enddate0), 'MMM') + ']'

select @colWeek1 = '[' + FORMAT(DATEADD(DAY, -7, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -7, @enddate0), 'MMM') + ']'

 

select @col = STUFF((select distinct ',' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

select @colSUM =  STUFF((select distinct ',' + 'SUM(' + quotename(x.Date) + ') as ' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

 

set @result = '

 

SELECT

vInfo.*

,ResBudget.PCSBudget AS Scope

,ResBudget.PCSBudget - vInfo.Done AS Pending

,CASE WHEN ResBudget.PCSBudget = 0 THEN 0 ELSE CONVERT(FLOAT,vInfo.Done) / CONVERT(FLOAT,ResBudget.PCSBudget) END AS [% PROG]

 

FROM (

select

ACTIVITIES.PCS_Area,ACTIVITIES.SubCon,ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM

 

 

,sum(x2.Cummulative) as Done

,sum(x2.Weekly) as Weekly

 

,(sum(x2.[Last 1 Weekly]) + sum(x2.[Last 2 Weekly])) / 2 AS Trend

 

,sum(x2.[Last 1 Weekly]) as ' + @colWeek1 + '

,sum(x2.[Last 2 Weekly]) as ' + @colWeek2 + '

,sum(x2.[Last 3 Weekly]) as ' + @colWeek3 + '

,sum(x2.[Last 4 Weekly]) as ' + @colWeek4 + '

 

,'+ @colSUM +'

 

 

 

FROM

(

select Type,ActID

,CASE WHEN [Activity Name] =''Electrical Cable Connection 01'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Electrical Cable Connection 02'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Instrument Cable Connection 01 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 01 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

ELSE

[Activity Name]

END AS [EICA Activity]

,Scope

,case when Cummulative is null then 0 else Cummulative end as Cummulative

,CASE WHEN [Last 4 Weekly] IS NULL THEN 0 ELSE [Last 4 Weekly] END AS [Last 4 Weekly]

,CASE WHEN [Last 3 Weekly] IS NULL THEN 0 ELSE [Last 3 Weekly] END AS [Last 3 Weekly]

,CASE WHEN [Last 2 Weekly] IS NULL THEN 0 ELSE [Last 2 Weekly] END AS [Last 2 Weekly]

,CASE WHEN [Last 1 Weekly] IS NULL THEN 0 ELSE [Last 1 Weekly] END AS [Last 1 Weekly]

,CASE WHEN Weekly IS NULL THEN 0 ELSE WEEKLY END AS Weekly

,'+ @col +' FROM

 

--******************************************************************

(---Electrical Cable Pulling             

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[EC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] is not null

group by EC_TYPE,[EC_Plan_Pulled_Date],EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([EC_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

tblEleCableList

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL
--******************************************************************
---Universal Equipment

select convert(char(10),cast(installedDate as smalldatetime),111) as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment WHERE active=1

and installedDate is not null

group by Discipline,installedDate,ActID

UNION ALL

select ''Cummulative'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Discipline,installedDate,ActID

UNION ALL

select ''Weekly'' as Daily,

Discipline as [Activity Name]

,count([installedDate]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

and installedDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Discipline,installedDate,ActID

UNION ALL

select ''Scope'' as Daily,

Discipline as [Activity Name]

,count(Tag) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],ActID as ActID FROM tblEquipment where active=1

group by Discipline,ActID

--*********************************************************

UNION ALL

--******************************************************************

---Instrument Cable Pulling          

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([IC_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblInsCableList

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

---Electrical Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] is not null

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Electrical Cable Tray

select convert(char(10),cast([EL_Tray_Installed_date] as smalldatetime),111) as Daily,

''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

where [Production_Date] is not null

) as vETrayPro

where active=1

group by EL_Tray_Type,[EL_Tray_Installed_date],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by EL_Tray_Type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([EL_Tray_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblEleCableTray

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---Instrument Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrument Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Cummulative'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 1 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 2 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 3 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 4 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect + ''-GL'' as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Scope'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,(count([iC_id]))*2 as ''Gland'',''Instrumentation'' as [Type],''Each'' as [Unit]

,IC_Plan_P6_ActID_Connect as ActID

FROM tblInsCableList

Where active = 1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

--**********************************************************************************

UNION ALL

---Instrument Installation - Stand Alone/Field

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Installation - In Line

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Hook Ups

select convert(char(10),cast(HookUp_Date as smalldatetime),111) as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup,hookup_date

UNION ALL

select ''Cummulative'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Scope'' as Daily,

''Hook Ups'' as [Activity Name]

,count([Instrument_Tag]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

--*********************************************************

UNION ALL

---Calibration

select convert(char(10),cast(Calibration_Date as smalldatetime),111) as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID,Calibration_Date

UNION ALL

select ''Cummulative'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Scope'' as Daily,

''Calibration'' as [Activity Name]

,count([Instrument_Tag]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID

--*********************************************************

UNION ALL

---Lighting Fixtures

select convert(char(10),cast(LF_Installed as smalldatetime),111) as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed is not null

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([TAG]) as ''Fixture Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

group by lf_ref_desc,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Cable Tray

select convert(char(10),cast([IN_Tray_Installed] as smalldatetime),111) as Daily,

''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] is not null

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

AND Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([IN_Tray_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblINSCableTray

where active=1

AND tblInsCableTray.IN_Tray_Type <>''F&G''

group by [IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---MSC Cable Pulling

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] is not null

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Cummulative'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 1 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 2 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 3 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 4 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Scope'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Length]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblMSCCable

where active=1

group by IC_Plan_P6_ActID_Pulling,type

--******************************************************************

UNION ALL

---Loop

select convert(char(10),cast(L_Done as smalldatetime),111) as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by L_Done,ACTIVITYID

UNION ALL

select ''Cummulative'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by ACTIVITYID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by L_Done,ACTIVITYID

UNION ALL

select ''Scope'' as Daily,

''Loop'' as [Activity Name]

,count(loopname) as ''Scope'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by ACTIVITYID

--*********************************************************

--******************************************************************

) as X

 

PIVOT

(sum (Pulled) for Daily in ('+ @col +',Scope,[Cummulative],[Last 1 Weekly],[Last 2 Weekly],[Last 3 Weekly],[Last 4 Weekly],weekly)

)as X1

) as X2

RIGHT JOIN tblActIDS AS ACTIVITIES ON X2.ActID = ACTIVITIES.ActID

WHERE ACTIVITIES.ResourceId IS NOT NULL AND ResourceId LIKE ''%IN%''

group by ACTIVITIES.PCS_Area,ACTIVITIES.SubCon,ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM

) AS vInfo

INNER JOIN (

SELECT

ResourceId,ResourceName,Subcon,PCS_Area

,SUM(PCS_Budget) AS PCSBudget

FROM tblActIDS

GROUP BY ResourceId,ResourceName,Subcon,PCS_Area

) AS ResBudget

ON vInfo.ResourceId = ResBudget.ResourceId AND vInfo.subcon = ResBudget.Subcon AND vInfo.PCS_Area = ResBudget.PCS_Area

' 

execute(@result)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'SP_P6Summary_Est'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.SP_P6Summary_Est
END
GO
CREATE Proc [dbo].[SP_P6Summary_Est]
AS
SELECT
tblActIDS.Team
,vblock.Block,vblock.Unit
,rtrim(PCS_Area) AS [PCS Area]
,EICA_Area
,tblActIDS.ResourceId, tblActIDS.ResourceName, tblActIDS.UOM
,rtrim(tblActIDS.Family) as Family,rtrim(tblActIDS.SubCon) as SubCon
,tblActIDS.ActName,tblActIDS.ActID,tblActIDS.PCS_Budget
,tblActIDS.EstimatedScope AS EICA_Budget
,tblActIDS.PCS_Budget - tblActIDS.EstimatedScope as Diff
,[Qty Done] as EICA_Done
,tblActIDS.PCSDone AS [PCS Done %]
,weekly as EICA_Weekly
,Scope as [EICA Actual Scope]
FROM
(
select 
[Act ID]
,sum(Scope) as Scope
,sum([Qty Done]) as [Qty Done]
,sum(Weekly) as Weekly
from
(
select 
actid as [Act ID]
,Scope
,[Qty Done]
,Weekly
from
(
--F&G SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Final_Installed_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND Final_Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
AND Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
AND Calibration_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Final_Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
and Calibration_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Hookup SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.HookUp_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
AND HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Hookup_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
AND Hookup_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and  Active=1
and HookUp_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + 'QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and  Active=1
and Hookup_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------

UNION ALL
--Electrical Cable Scope
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Pulling as actid, tblEleCableList.Area, 
'LM' as [Measure]
,sum(tblEleCableList.EC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Pulling,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Quantity Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
WHERE Discipline='Ele Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction WITH (NOLOCK)
WHERE Discipline='Ele Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID,  vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Scope
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_PULLING as actid, tblInsCableList.Area, 
'LM' as [Measure]
,sum(tblInsCableList.IC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_PULLING,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Pulled
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
where Discipline='IC Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Ins Cable Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction WITH (NOLOCK)
where Discipline='IC Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID, vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_From) 
as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
AND IC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_to) 
as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
AND IC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_From)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_PLAN_P6_ACTID_CONNECT=tblActIDS.ACTID
where Active=1
and tblInsCableList.IC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_To)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
and tblInsCableList.IC_Plan_Connected_Date_to between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_From)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
AND EC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_to)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
AND EC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_From) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
and tblEleCableList.EC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_To) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
and tblEleCableList.EC_Plan_Connected_Date_To between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--Lighting JB SCOPE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB DONE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture SCOPE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.tag) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture DONE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Scope
SELECT DISTINCT 
tblMSCCable.Type as Discipline,'Cable Pulling' as [Activity],
IC_Plan_P6_ActID_Pulling as actid, Area, 
'LM' as [Measure]
,sum(Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMSCCable WITH (NOLOCK)
where active=1
GROUP BY tblMSCCable.Type,IC_Plan_P6_ActID_Pulling,  Area
-----------------------------------------------------------
UNION ALL
--Misc Cable Pulling Pulled
SELECT DISTINCT 
vCblParProductionTotal.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
where Discipline='Msc Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.Type,vCblParProductionTotal.PullingActID, vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Weekly
SELECT DISTINCT 
vCblParProduction.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.qnty) as Weekly
FROM vCblParProduction WITH (NOLOCK)
where Discipline='Msc Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.Type,vCblParProduction.PullingActID,  vCblParProduction.Area
---------------------------------------------------------
UNION ALL
--Cable Tray
SELECT DISTINCT 
Discipline,[Activity],
Actid  
, Area, 
'LM' as [Measure]
,[Scope LM] AS Scope
,[Pulled LM] as [Qty Done]
,[WK Pulled] as Weekly
FROM v_Trays
---------------------------------------------------------
UNION ALL
--Ele Cable Testing SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,COUNT(tblEleCableList.EC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,COUNT(tblInsCableList.IC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblEleCableList.EC_ID) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.EC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblInsCableList.IC_ID) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.IC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblEleCableList.EC_ID) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.EC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsCableList.IC_ID) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.IC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Misc Items SCOPE
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,sum(v_Items.item_scope) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Done
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,sum(v_Items.totalqnty) as [Qty Done]
,0 as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Weekly
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(v_Items.totalqnty) as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,count(tblEleCableList.ec_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.TR_QC_Released) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,count(tblInsCableList.ic_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Done
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.TR_QC_Released) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL

--Uni Equipment SCOPE
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEquipment 
where Active=1
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(InstalledDate) as [Qty Done]
,0 as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
AND InstalledDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed Weekly
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
and InstalledDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors SCOPE
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMotor 
where Active=1
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(solo_run_date) as [Qty Done]
,0 as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
AND solo_run_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed Weekly
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Equipment' as [Activity],
SoloRunActID AS ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
and solo_run_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Loop SCOPE
SELECT DISTINCT 
'Pre-Comm' as Discipline,'Loop Test' as [Activity],
tblInsLoop.ACTIVITYID as actid, tblInsLoop.Area, 
'Each' as [Measure]
,COUNT(tblInsLoop.LoopName) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsLoop WITH (NOLOCK)
where Active=1
GROUP BY tblInsLoop.ACTIVITYID,  tblInsLoop.Area
-----------------------------------------------------------
UNION ALL
--Loop DONE
SELECT DISTINCT 
'Pre-Comm' as Discipline,'Loop Test' as [Activity],
tblInsLoop.ACTIVITYID as actid, tblInsLoop.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsLoop.L_Done) as [Qty Done]
,0 as Weekly
FROM tblInsLoop WITH (NOLOCK)
where Active=1
AND L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsLoop.ACTIVITYID,  tblInsLoop.Area
-----------------------------------------------------------
UNION ALL
--Loop Weekly
SELECT DISTINCT 
'Pre-Comm' as Discipline,'Loop Test' as [Activity],
tblInsLoop.ACTIVITYID as actid, tblInsLoop.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsLoop.LoopName) as Weekly
FROM tblInsLoop WITH (NOLOCK)
where Active=1
and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsLoop.ACTIVITYID,  tblInsLoop.Area
-----------------------------------------------------------

) as v1
) as v2

where [Act ID] is not null

group by 
[Act ID]
) AS vDynamicAvts
inner JOIN tblActIDS
ON tblActIDS.ActID=vDynamicAvts.[Act ID]
inner join 
(
SELECT Area.Area,unit.unit,unit.Block  FROM [Area]
inner join unit
on [Area].Unit=unit.Unit 
) as vBlock
on eica_Area=vblock.Area
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'SP_P6Summary_Est_Vendor'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.SP_P6Summary_Est_Vendor
END
GO
CREATE proc [dbo].[SP_P6Summary_Est_Vendor]
AS
SELECT
vblock.Block,vblock.Unit
,rtrim(PCS_Area) AS [PCS Area]
,EICA_Area
,rtrim(tblActIDS.Family) as Family,rtrim(tblActIDS.SubCon) as SubCon
,tblActIDS.ActName,tblActIDS.ActID,tblActIDS.PCS_Budget
,tblActIDS.EstimatedScope AS EICA_Budget
,tblActIDS.PCS_Budget - tblActIDS.EstimatedScope as Diff
,[Qty Done] as EICA_Done
,tblActIDS.PCSDone AS [PCS Done %]
,weekly as EICA_Weekly
,Scope as [EICA Actual Scope]
FROM
(
select 
[Act ID]
,sum(Scope) as Scope
,sum([Qty Done]) as [Qty Done]
,sum(Weekly) as Weekly
from
(
select 
actid as [Act ID]
,Scope
,[Qty Done]
,Weekly
from
(
--F&G SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Final_Installed_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
AND Final_Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
AND Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
AND Calibration_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Final_Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Calibration_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Hookup SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.HookUp_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
AND HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Hookup_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
AND Hookup_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and HookUp_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + 'QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Hookup_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Electrical Cable Scope
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Pulling as actid, tblEleCableList.Area, 
'LM' as [Measure]
,sum(tblEleCableList.EC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Pulling,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Quantity Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
WHERE Discipline='Ele Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction WITH (NOLOCK)
WHERE Discipline='Ele Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID,  vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Scope
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_PULLING as actid, tblInsCableList.Area, 
'LM' as [Measure]
,sum(tblInsCableList.IC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_PULLING,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Pulled
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
where Discipline='IC Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Ins Cable Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction WITH (NOLOCK)
where Discipline='IC Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID, vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_From) 
as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where IC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_to) 
as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where IC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_From)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_PLAN_P6_ACTID_CONNECT=tblActIDS.ACTID
where tblInsCableList.IC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_To)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where tblInsCableList.IC_Plan_Connected_Date_to between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_From)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where EC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_to)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where EC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_From) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where tblEleCableList.EC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_To) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where tblEleCableList.EC_Plan_Connected_Date_To between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--Lighting JB SCOPE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where tblLightingFixture.LF_Ref_Desc ='Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB DONE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where tblLightingFixture.LF_Ref_Desc ='Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where tblLightingFixture.LF_Ref_Desc ='Lighting JB'
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture SCOPE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.tag) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture DONE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Scope
SELECT DISTINCT 
tblMSCCable.Type as Discipline,'Cable Pulling' as [Activity],
IC_Plan_P6_ActID_Pulling as actid, Area, 
'LM' as [Measure]
,sum(Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMSCCable WITH (NOLOCK)
GROUP BY tblMSCCable.Type,IC_Plan_P6_ActID_Pulling,  Area
-----------------------------------------------------------
UNION ALL
--Misc Cable Pulling Pulled
SELECT DISTINCT 
vCblParProductionTotal.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
where Discipline='Msc Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.Type,vCblParProductionTotal.PullingActID, vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Weekly
SELECT DISTINCT 
vCblParProduction.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.qnty) as Weekly
FROM vCblParProduction WITH (NOLOCK)
where Discipline='Msc Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.Type,vCblParProduction.PullingActID,  vCblParProduction.Area
---------------------------------------------------------
UNION ALL
--Cable Tray
SELECT DISTINCT 
Discipline,[Activity],
Actid  
, Area, 
'LM' as [Measure]
,[Scope LM] AS Scope
,[Pulled LM] as [Qty Done]
,[WK Pulled] as Weekly
FROM v_Trays
---------------------------------------------------------
UNION ALL
--Ele Cable Testing SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,COUNT(tblEleCableList.EC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,COUNT(tblInsCableList.IC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblEleCableList.EC_ID) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where tblEleCableList.EC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblInsCableList.IC_ID) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where tblInsCableList.IC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblEleCableList.EC_ID) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where tblEleCableList.EC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsCableList.IC_ID) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where tblInsCableList.IC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Done
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,sum(v_Items.totalqnty) as [Qty Done]
,0 as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Weekly
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(v_Items.totalqnty) as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,count(tblEleCableList.ec_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.TR_QC_Released) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,count(tblInsCableList.ic_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Done
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.TR_QC_Released) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------

UNION ALL

--Uni Equipment SCOPE
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEquipment 
where Active=1
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(InstalledDate) as [Qty Done]
,0 as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
AND InstalledDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed Weekly
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
and InstalledDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors SCOPE
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Solo Run' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMotor 
where Active=1
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Solo Run' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(solo_run_date) as [Qty Done]
,0 as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
AND solo_run_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed Weekly
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Solo Run' as [Activity],
SoloRunActID AS ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
and solo_run_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Loop SCOPE
SELECT DISTINCT 
'Pre-Comm' as Discipline,'Loop Test' as [Activity],
tblInsLoop.ACTIVITYID as actid, tblInsLoop.Area, 
'Each' as [Measure]
,COUNT(tblInsLoop.LoopName) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsLoop WITH (NOLOCK)
where Active=1
GROUP BY tblInsLoop.ACTIVITYID,  tblInsLoop.Area
-----------------------------------------------------------
UNION ALL
--Loop DONE
SELECT DISTINCT 
'Pre-Comm' as Discipline,'Loop Test' as [Activity],
tblInsLoop.ACTIVITYID as actid, tblInsLoop.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsLoop.L_Done) as [Qty Done]
,0 as Weekly
FROM tblInsLoop WITH (NOLOCK)
where Active=1
AND L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsLoop.ACTIVITYID,  tblInsLoop.Area
-----------------------------------------------------------
UNION ALL
--Loop Weekly
SELECT DISTINCT 
'Pre-Comm' as Discipline,'Loop Test' as [Activity],
tblInsLoop.ACTIVITYID as actid, tblInsLoop.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsLoop.LoopName) as Weekly
FROM tblInsLoop WITH (NOLOCK)
where Active=1
and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsLoop.ACTIVITYID,  tblInsLoop.Area
-----------------------------------------------------------

) as v1
) as v2

where [Act ID] is not null

group by 
[Act ID]
) AS vDynamicAvts
inner JOIN tblActIDS
ON tblActIDS.ActID=vDynamicAvts.[Act ID]
inner join 
(
SELECT Area.Area,unit.unit,unit.Block  FROM [Area]
inner join unit
on [Area].Unit=unit.Unit 
) as vBlock
on eica_Area=vblock.Area
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'SP_P6Summary_Est_Vendor'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.SP_P6Summary_Est_Vendor
END
GO
CREATE proc [dbo].[SP_P6Summary_Est_Vendor]
AS
SELECT
vblock.Block,vblock.Unit
,rtrim(PCS_Area) AS [PCS Area]
,EICA_Area
,rtrim(tblActIDS.Family) as Family,rtrim(tblActIDS.SubCon) as SubCon
,tblActIDS.ActName,tblActIDS.ActID,tblActIDS.PCS_Budget
,tblActIDS.EstimatedScope AS EICA_Budget
,tblActIDS.PCS_Budget - tblActIDS.EstimatedScope as Diff
,[Qty Done] as EICA_Done
,tblActIDS.PCSDone AS [PCS Done %]
,weekly as EICA_Weekly
,Scope as [EICA Actual Scope]
FROM
(
select 
[Act ID]
,sum(Scope) as Scope
,sum([Qty Done]) as [Qty Done]
,sum(Weekly) as Weekly
from
(
select 
actid as [Act ID]
,Scope
,[Qty Done]
,Weekly
from
(
--F&G SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Final_Installed_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
AND Final_Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
AND Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
AND Calibration_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Final_Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Calibration_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Hookup SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.HookUp_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
AND HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Hookup_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
AND Hookup_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and HookUp_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + 'QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Hookup_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Electrical Cable Scope
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Pulling as actid, tblEleCableList.Area, 
'LM' as [Measure]
,sum(tblEleCableList.EC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Pulling,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Quantity Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
WHERE Discipline='Ele Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction WITH (NOLOCK)
WHERE Discipline='Ele Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID,  vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Scope
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_PULLING as actid, tblInsCableList.Area, 
'LM' as [Measure]
,sum(tblInsCableList.IC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_PULLING,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Pulled
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
where Discipline='IC Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Ins Cable Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction WITH (NOLOCK)
where Discipline='IC Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID, vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_From) 
as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where IC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_to) 
as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where IC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_From)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_PLAN_P6_ACTID_CONNECT=tblActIDS.ACTID
where tblInsCableList.IC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_To)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where tblInsCableList.IC_Plan_Connected_Date_to between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_From)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where EC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_to)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where EC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_From) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where tblEleCableList.EC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_To) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where tblEleCableList.EC_Plan_Connected_Date_To between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--Lighting JB SCOPE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where tblLightingFixture.LF_Ref_Desc ='Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB DONE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where tblLightingFixture.LF_Ref_Desc ='Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where tblLightingFixture.LF_Ref_Desc ='Lighting JB'
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture SCOPE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.tag) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture DONE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Scope
SELECT DISTINCT 
tblMSCCable.Type as Discipline,'Cable Pulling' as [Activity],
IC_Plan_P6_ActID_Pulling as actid, Area, 
'LM' as [Measure]
,sum(Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMSCCable WITH (NOLOCK)
GROUP BY tblMSCCable.Type,IC_Plan_P6_ActID_Pulling,  Area
-----------------------------------------------------------
UNION ALL
--Misc Cable Pulling Pulled
SELECT DISTINCT 
vCblParProductionTotal.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
where Discipline='Msc Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.Type,vCblParProductionTotal.PullingActID, vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Weekly
SELECT DISTINCT 
vCblParProduction.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.qnty) as Weekly
FROM vCblParProduction WITH (NOLOCK)
where Discipline='Msc Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.Type,vCblParProduction.PullingActID,  vCblParProduction.Area
---------------------------------------------------------
UNION ALL
--Cable Tray
SELECT DISTINCT 
Discipline,[Activity],
Actid  
, Area, 
'LM' as [Measure]
,[Scope LM] AS Scope
,[Pulled LM] as [Qty Done]
,[WK Pulled] as Weekly
FROM v_Trays
---------------------------------------------------------
UNION ALL
--Ele Cable Testing SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,COUNT(tblEleCableList.EC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,COUNT(tblInsCableList.IC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblEleCableList.EC_ID) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where tblEleCableList.EC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblInsCableList.IC_ID) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where tblInsCableList.IC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblEleCableList.EC_ID) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where tblEleCableList.EC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsCableList.IC_ID) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where tblInsCableList.IC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Done
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,sum(v_Items.totalqnty) as [Qty Done]
,0 as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Weekly
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(v_Items.totalqnty) as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,count(tblEleCableList.ec_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.TR_QC_Released) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,count(tblInsCableList.ic_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Done
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.TR_QC_Released) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------

UNION ALL

--Uni Equipment SCOPE
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEquipment 
where Active=1
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(InstalledDate) as [Qty Done]
,0 as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
AND InstalledDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed Weekly
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
and InstalledDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors SCOPE
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Solo Run' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMotor 
where Active=1
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Solo Run' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(solo_run_date) as [Qty Done]
,0 as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
AND solo_run_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed Weekly
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Solo Run' as [Activity],
SoloRunActID AS ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
and solo_run_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Loop SCOPE
SELECT DISTINCT 
'Pre-Comm' as Discipline,'Loop Test' as [Activity],
tblInsLoop.ACTIVITYID as actid, tblInsLoop.Area, 
'Each' as [Measure]
,COUNT(tblInsLoop.LoopName) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsLoop WITH (NOLOCK)
where Active=1
GROUP BY tblInsLoop.ACTIVITYID,  tblInsLoop.Area
-----------------------------------------------------------
UNION ALL
--Loop DONE
SELECT DISTINCT 
'Pre-Comm' as Discipline,'Loop Test' as [Activity],
tblInsLoop.ACTIVITYID as actid, tblInsLoop.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsLoop.L_Done) as [Qty Done]
,0 as Weekly
FROM tblInsLoop WITH (NOLOCK)
where Active=1
AND L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsLoop.ACTIVITYID,  tblInsLoop.Area
-----------------------------------------------------------
UNION ALL
--Loop Weekly
SELECT DISTINCT 
'Pre-Comm' as Discipline,'Loop Test' as [Activity],
tblInsLoop.ACTIVITYID as actid, tblInsLoop.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsLoop.LoopName) as Weekly
FROM tblInsLoop WITH (NOLOCK)
where Active=1
and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsLoop.ACTIVITYID,  tblInsLoop.Area
-----------------------------------------------------------

) as v1
) as v2

where [Act ID] is not null

group by 
[Act ID]
) AS vDynamicAvts
inner JOIN tblActIDS
ON tblActIDS.ActID=vDynamicAvts.[Act ID]
inner join 
(
SELECT Area.Area,unit.unit,unit.Block  FROM [Area]
inner join unit
on [Area].Unit=unit.Unit 
) as vBlock
on eica_Area=vblock.Area
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'SP_P6Summary_Est_ver2'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.SP_P6Summary_Est_ver2
END
GO
CREATE Proc [dbo].[SP_P6Summary_Est_ver2]
AS

SELECT
vblock.Block,vblock.Unit
,rtrim(PCS_Area) AS [PCS Area]
,EICA_Area
,rtrim(tblActIDS.Family) as Family,rtrim(tblActIDS.SubCon) as SubCon
,tblActIDS.ActName,tblActIDS.ActID,tblActIDS.PCS_Budget
,tblActIDS.EstimatedScope AS EICA_Budget
,tblActIDS.PCS_Budget - tblActIDS.EstimatedScope as Diff
,[Qty Done] as EICA_Done
,tblActIDS.PCSDone AS [PCS Done %]
,weekly as EICA_Weekly
,Scope as [EICA Actual Scope]
FROM
(
select 
[Act ID]
,sum(Scope) as Scope
,sum([Qty Done]) as [Qty Done]
,sum(Weekly) as Weekly
from
(
select 
actid as [Act ID]
,Scope
,[Qty Done]
,Weekly
from
(
--F&G SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Final_Installed_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND Final_Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
AND Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
AND Calibration_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Final_Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
and Calibration_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Hookup SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.HookUp_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
AND HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Hookup_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
AND Hookup_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and  Active=1
and HookUp_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + 'QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and  Active=1
and Hookup_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_From) 
as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
AND IC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_to) 
as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
AND IC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_From)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_PLAN_P6_ACTID_CONNECT=tblActIDS.ACTID
where Active=1
and tblInsCableList.IC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_To)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
and tblInsCableList.IC_Plan_Connected_Date_to between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_From)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
AND EC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_to)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
AND EC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_From) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
and tblEleCableList.EC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_To) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
and tblEleCableList.EC_Plan_Connected_Date_To between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--Lighting JB SCOPE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB DONE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture SCOPE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.tag) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture DONE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Scope
SELECT DISTINCT 
tblMSCCable.Type as Discipline,'Cable Pulling' as [Activity],
IC_Plan_P6_ActID_Pulling as actid, Area, 
'LM' as [Measure]
,sum(Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMSCCable WITH (NOLOCK)
where active=1
GROUP BY tblMSCCable.Type,IC_Plan_P6_ActID_Pulling,  Area
-----------------------------------------------------------
UNION ALL
--Misc Cable Pulling Pulled
SELECT DISTINCT 
vCblParProductionTotal.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
where Discipline='Msc Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.Type,vCblParProductionTotal.PullingActID, vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Weekly
SELECT DISTINCT 
vCblParProduction.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.qnty) as Weekly
FROM vCblParProduction WITH (NOLOCK)
where Discipline='Msc Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.Type,vCblParProduction.PullingActID,  vCblParProduction.Area
---------------------------------------------------------
UNION ALL
--Cable Tray
SELECT DISTINCT 
Discipline,[Activity],
Actid  
, Area, 
'LM' as [Measure]
,[Scope LM] AS Scope
,[Pulled LM] as [Qty Done]
,[WK Pulled] as Weekly
FROM v_Trays
---------------------------------------------------------
UNION ALL
--Ele Cable Testing SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,COUNT(tblEleCableList.EC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,COUNT(tblInsCableList.IC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblEleCableList.EC_ID) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.EC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblInsCableList.IC_ID) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.IC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblEleCableList.EC_ID) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.EC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsCableList.IC_ID) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.IC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Misc Items SCOPE
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,sum(v_Items.item_scope) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Done
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,sum(v_Items.totalqnty) as [Qty Done]
,0 as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Weekly
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(v_Items.totalqnty) as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,count(tblEleCableList.ec_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.TR_QC_Released) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,count(tblInsCableList.ic_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Done
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.TR_QC_Released) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Scope
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Pulling as actid, tblEleCableList.Area, 
'LM' as [Measure]
,sum(tblEleCableList.EC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Pulling,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Quantity Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal
WHERE Discipline='Ele Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction
WHERE Discipline='Ele Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID,  vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Scope
SELECT DISTINCT 
'Instrumentation' as Discipline,tblInsCableList.IC_Type + ' - Cable Pulling' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_PULLING as actid, tblInsCableList.Area, 
'LM' as [Measure]
,sum(tblInsCableList.IC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList
where Active=1
GROUP BY tblInsCableList.IC_Type,tblInsCableList.IC_PLAN_P6_ACTID_PULLING,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Pulled
SELECT DISTINCT 
'Instrumentation' as Discipline,vCblParProductionTotal.type + ' - Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal
where Discipline='IC Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.type,vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Ins Cable Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,vCblParProduction.type + ' - Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction
where Discipline='IC Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.type,vCblParProduction.PullingActID, vCblParProduction.Area
-----------------------------------------------------------
UNION ALL

--Uni Equipment SCOPE
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEquipment 
where Active=1
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(InstalledDate) as [Qty Done]
,0 as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
AND InstalledDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed Weekly
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
and InstalledDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors SCOPE
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Solo Run' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMotor 
where Active=1
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Solo Run' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(solo_run_date) as [Qty Done]
,0 as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
AND solo_run_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed Weekly
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Solo Run' as [Activity],
SoloRunActID AS ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
and solo_run_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Loop SCOPE
SELECT DISTINCT 
'Pre-Comm' as Discipline,'Loop Test' as [Activity],
tblInsLoop.ACTIVITYID as actid, tblInsLoop.Area, 
'Each' as [Measure]
,COUNT(tblInsLoop.LoopName) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsLoop WITH (NOLOCK)
where Active=1
GROUP BY tblInsLoop.ACTIVITYID,  tblInsLoop.Area
-----------------------------------------------------------
UNION ALL
--Loop DONE
SELECT DISTINCT 
'Pre-Comm' as Discipline,'Loop Test' as [Activity],
tblInsLoop.ACTIVITYID as actid, tblInsLoop.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsLoop.L_Done) as [Qty Done]
,0 as Weekly
FROM tblInsLoop WITH (NOLOCK)
where Active=1
AND L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsLoop.ACTIVITYID,  tblInsLoop.Area
-----------------------------------------------------------
UNION ALL
--Loop Weekly
SELECT DISTINCT 
'Pre-Comm' as Discipline,'Loop Test' as [Activity],
tblInsLoop.ACTIVITYID as actid, tblInsLoop.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsLoop.LoopName) as Weekly
FROM tblInsLoop WITH (NOLOCK)
where Active=1
and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsLoop.ACTIVITYID,  tblInsLoop.Area
-----------------------------------------------------------

) as v1
) as v2

where [Act ID] is not null

group by 
[Act ID]
) AS vDynamicAvts
inner JOIN tblActIDS
ON tblActIDS.ActID=vDynamicAvts.[Act ID]
inner join 
(
SELECT Area.Area,unit.unit,unit.Block  FROM [Area]
inner join unit
on [Area].Unit=unit.Unit 
) as vBlock
on eica_Area=vblock.Area
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'SP_P6Summary_Est2'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.SP_P6Summary_Est2
END
GO
CREATE Proc [dbo].[SP_P6Summary_Est2]
AS
SELECT
tblActIDS.Team,tblActIDS.PCS_Area,tblActIDS.UOM,tblActIDS.ResourceName
,rtrim(PCS_Area) AS [PCS Area]
,EICA_Area
,tblActIDS.ResourceId, tblActIDS.ResourceName, tblActIDS.UOM
,rtrim(tblActIDS.Family) as Family,rtrim(tblActIDS.SubCon) as SubCon
,tblActIDS.ActName,tblActIDS.ActID,tblActIDS.PCS_Budget
,tblActIDS.EstimatedScope AS EICA_Budget
,tblActIDS.PCS_Budget - tblActIDS.EstimatedScope as Diff
,[Qty Done] as EICA_Done
,tblActIDS.PCSDone AS [PCS Done %]
,weekly as EICA_Weekly
,Scope as [EICA Actual Scope]
FROM
(
select 
[Act ID]
,sum(Scope) as Scope
,sum([Qty Done]) as [Qty Done]
,sum(Weekly) as Weekly
from
(
select 
actid as [Act ID]
,Scope
,[Qty Done]
,Weekly
from
(
--F&G SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--F&G Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'FG' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument ='F&G'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Final_Installed_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND Final_Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
AND Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
AND Calibration_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Final_Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
and Calibration_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Hookup SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.HookUp_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
AND HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Hookup_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
AND Hookup_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and  Active=1
and HookUp_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + 'QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and  Active=1
and Hookup_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Electrical Cable Scope
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Pulling as actid, tblEleCableList.Area, 
'LM' as [Measure]
,sum(tblEleCableList.EC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Pulling,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Quantity Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
WHERE Discipline='Ele Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction WITH (NOLOCK)
WHERE Discipline='Ele Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID,  vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Scope
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_PULLING as actid, tblInsCableList.Area, 
'LM' as [Measure]
,sum(tblInsCableList.IC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_PULLING,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Pulled
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
where Discipline='IC Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Ins Cable Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction WITH (NOLOCK)
where Discipline='IC Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID, vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_From) 
as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
AND IC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,count(tblInsCableList.IC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area AS Area,
'EACH' as [Measure]
,0 AS Scope
,count(tblInsCableList.IC_Plan_Connected_Date_to) 
as [Qty Done]
,0 as Weekly--UNION ALL
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
AND IC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 01 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection1' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_CONNECT as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_From)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_PLAN_P6_ACTID_CONNECT=tblActIDS.ACTID
where Active=1
and tblInsCableList.IC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_PLAN_P6_ACTID_CONNECT,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS 02 wEEKLY
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Connection2' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.IC_Plan_Connected_Date_To)  as Weekly
FROM tblInsCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblInsCableList.IC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
and tblInsCableList.IC_Plan_Connected_Date_to between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_From)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
AND EC_Plan_Connected_Date_From <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(tblEleCableList.EC_Plan_P6_ActID_Connect_2) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 DONE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(tblEleCableList.EC_Plan_Connected_Date_to)
as [Qty Done]
,0 as weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
AND EC_Plan_Connected_Date_to <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2, tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 01 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection1' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_From) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect=tblActIDS.ACTID
where Active=1
and tblEleCableList.EC_Plan_Connected_Date_From between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS 02 Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Connection2' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect_2 as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.EC_Plan_Connected_Date_To) as Weekly
FROM tblEleCableList WITH (NOLOCK)
INNER JOIN tblActIDS
ON tblEleCableList.EC_Plan_P6_ActID_Connect_2=tblActIDS.ACTID
where Active=1
and tblEleCableList.EC_Plan_Connected_Date_To between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect_2,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--Lighting JB SCOPE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB DONE 
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Lighting JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture SCOPE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.tag) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture DONE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture WITH (NOLOCK)
where Active=1
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Scope
SELECT DISTINCT 
tblMSCCable.Type as Discipline,'Cable Pulling' as [Activity],
IC_Plan_P6_ActID_Pulling as actid, Area, 
'LM' as [Measure]
,sum(Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMSCCable WITH (NOLOCK)
where active=1
GROUP BY tblMSCCable.Type,IC_Plan_P6_ActID_Pulling,  Area
-----------------------------------------------------------
UNION ALL
--Misc Cable Pulling Pulled
SELECT DISTINCT 
vCblParProductionTotal.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal WITH (NOLOCK)
where Discipline='Msc Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.Type,vCblParProductionTotal.PullingActID, vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Weekly
SELECT DISTINCT 
vCblParProduction.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.qnty) as Weekly
FROM vCblParProduction WITH (NOLOCK)
where Discipline='Msc Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.Type,vCblParProduction.PullingActID,  vCblParProduction.Area
---------------------------------------------------------
UNION ALL
--Cable Tray
SELECT DISTINCT 
Discipline,[Activity],
Actid  
, Area, 
'LM' as [Measure]
,[Scope LM] AS Scope
,[Pulled LM] as [Qty Done]
,[WK Pulled] as Weekly
FROM v_Trays
---------------------------------------------------------
UNION ALL
--Ele Cable Testing SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,COUNT(tblEleCableList.EC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,COUNT(tblInsCableList.IC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblEleCableList.EC_ID) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.EC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblInsCableList.IC_ID) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.IC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblEleCableList.EC_ID) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.EC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsCableList.IC_ID) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.IC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Misc Items SCOPE
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,sum(v_Items.item_scope) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Done
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,sum(v_Items.totalqnty) as [Qty Done]
,0 as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Weekly
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(v_Items.totalqnty) as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,count(tblEleCableList.ec_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.TR_QC_Released) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,count(tblInsCableList.ic_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Done
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.TR_QC_Released) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL

--Uni Equipment SCOPE
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEquipment 
where Active=1
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(InstalledDate) as [Qty Done]
,0 as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
AND InstalledDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed Weekly
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
and InstalledDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors SCOPE
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Solo Run' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMotor 
where Active=1
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Solo Run' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(solo_run_date) as [Qty Done]
,0 as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
AND solo_run_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed Weekly
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Solo Run' as [Activity],
SoloRunActID AS ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
and solo_run_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Loop SCOPE
SELECT DISTINCT 
'Pre-Comm' as Discipline,'Loop Test' as [Activity],
tblInsLoop.ACTIVITYID as actid, tblInsLoop.Area, 
'Each' as [Measure]
,COUNT(tblInsLoop.LoopName) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsLoop WITH (NOLOCK)
where Active=1
GROUP BY tblInsLoop.ACTIVITYID,  tblInsLoop.Area
-----------------------------------------------------------
UNION ALL
--Loop DONE
SELECT DISTINCT 
'Pre-Comm' as Discipline,'Loop Test' as [Activity],
tblInsLoop.ACTIVITYID as actid, tblInsLoop.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsLoop.L_Done) as [Qty Done]
,0 as Weekly
FROM tblInsLoop WITH (NOLOCK)
where Active=1
AND L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsLoop.ACTIVITYID,  tblInsLoop.Area
-----------------------------------------------------------
UNION ALL
--Loop Weekly
SELECT DISTINCT 
'Pre-Comm' as Discipline,'Loop Test' as [Activity],
tblInsLoop.ACTIVITYID as actid, tblInsLoop.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsLoop.LoopName) as Weekly
FROM tblInsLoop WITH (NOLOCK)
where Active=1
and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsLoop.ACTIVITYID,  tblInsLoop.Area
-----------------------------------------------------------

) as v1
) as v2

where [Act ID] is not null

group by 
[Act ID]
) AS vDynamicAvts
inner JOIN tblActIDS
ON tblActIDS.ActID=vDynamicAvts.[Act ID]
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'sp_p6summary2'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.sp_p6summary2
END
GO
CREATE proc [dbo].[sp_p6summary2]
as
SELECT
Discipline
,[Activity]
,PCS_Area
,sum(PCS_Budget) as PCS_Budget
,sum(EICA_Budget) as EICA_Budget
,sum(PCS_Budget) - sum(EICA_Budget) as Diff
,sum(EICA_Done) as EICA_Done
,sum([PCS Done %])/count([PCS Done %]) as [PCS Done %]

FROM
(
SELECT
Discipline
,[Activity]
,PCS_Area
,tblActIDS.Family
,tblActIDS.PCS_Budget
,Scope AS EICA_Budget
,tblActIDS.PCS_Budget - Scope as Diff
,[Qty Done] as EICA_Done
,tblActIDS.PCSDone AS [PCS Done %]
,weekly as EICA_Weekly
FROM
(
select 
Discipline,[Activity]
,[Act ID]
,sum(Scope) as Scope
,sum([Qty Done]) as [Qty Done]
,sum(Weekly) as Weekly
from
(
select 
Discipline,[Activity]
,actid as [Act ID]
,Scope
,[Qty Done]
,Weekly
from
(
--Instrument SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument in ('instrument','Building_FG')
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(INSTRUMENT_TAG) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.installation_date) as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Instrument in ('instrument','Building_FG')
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND installation_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument QC Installed
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid 
, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Final_Installed_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
AND Final_Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Calibration_Type='yes'
and Active=1
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments 
where Calibration_Type='yes'
and Active=1
AND Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Calibration_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
AND Calibration_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments 
where Instrument in ('instrument','Building_FG')
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Installation_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Installed QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Installed' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Install + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Instrument = 'instrument'
and (Furnished_By is null or Furnished_By ='vendor loose') 
and Active=1
and Final_Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.IC_Plan_P6_ActID_Install,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments 
where Calibration_Type='yes'
and Active=1
and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Calibrated QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Calibration' as [Activity],
tblInstruments.P6_Precalibration_ActID + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where Calibration_Type='yes'
and Active=1
and Calibration_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY tblInstruments.P6_Precalibration_ActID,  tblInstruments.Area
------------------------------------------------------------------
UNION ALL
--Instrument Hookup SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments
where hookup_name is not null
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,COUNT(tblInstruments.Instrument_Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.HookUp_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments
where hookup_name is not null
and Active=1
AND HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC DONE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + '-QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInstruments.Hookup_QC_Date) as [Qty Done]
,0 as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and Active=1
AND Hookup_QC_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments
where hookup_name is not null
and  Active=1
and HookUp_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Instrument Hookup QC Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Ins Hookup' as [Activity],
tblInstruments.IC_Plan_P6_ActID_Hookup + 'QC' as actid, tblInstruments.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInstruments.Instrument_Tag) as Weekly
FROM tblInstruments WITH (NOLOCK)
where hookup_name is not null
and  Active=1
and Hookup_QC_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInstruments.IC_Plan_P6_ActID_Hookup,  tblInstruments.Area
---------------------------------------------------------------------
UNION ALL
--Electrical Cable Scope
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Pulling as actid, tblEleCableList.Area, 
'LM' as [Measure]
,sum(tblEleCableList.EC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Pulling,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Quantity Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal
WHERE Discipline='Ele Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
-----------------------------------------------------------
UNION ALL
--Electrical Cable Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction
WHERE Discipline='Ele Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.PullingActID,  vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Scope
SELECT DISTINCT 
'Instrumentation' as Discipline,tblInsCableList.IC_Type + ' - Cable Pulling' as [Activity],
tblInsCableList.IC_PLAN_P6_ACTID_PULLING as actid, tblInsCableList.Area, 
'LM' as [Measure]
,sum(tblInsCableList.IC_Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList
where Active=1
GROUP BY tblInsCableList.IC_Type,tblInsCableList.IC_PLAN_P6_ACTID_PULLING,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Pulling Pulled
SELECT DISTINCT 
'Instrumentation' as Discipline,vCblParProductionTotal.type + ' - Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal
where Discipline='IC Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.type,vCblParProductionTotal.PullingActID,  vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Ins Cable Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,vCblParProduction.type + ' - Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.QNTY) as Weekly
FROM vCblParProduction
where Discipline='IC Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.type,vCblParProduction.PullingActID, vCblParProduction.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS SCOPE
SELECT  
'Instrumentation' as Discipline,v_ICConn.ic_type + ' - Cable Connection' as [Activity],
v_ICConn.actid as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,count(v_ICConn.ACTID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM v_ICConn
INNER JOIN tblActIDS
ON v_ICConn.actid=tblActIDS.ACTID
GROUP BY v_ICConn.ic_type,v_ICConn.actid,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS DONE
SELECT  
'Instrumentation' as Discipline,v_ICConn.ic_type + ' - Cable Connection' as [Activity],
v_ICConn.actid as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,count(v_ICConn.conndate) 
as [Qty Done]
,0 as Weekly
FROM v_ICConn
INNER JOIN tblActIDS
ON v_ICConn.actid=tblActIDS.ACTID
AND ConnDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_ICConn.ic_type,v_ICConn.actid,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Ins Cable CONNECTIONS wEEKLY
SELECT  
'Instrumentation' as Discipline,v_ICConn.ic_type + ' - Cable Connection' as [Activity],
v_ICConn.actid as actid, tblActIDS.EICA_Area AS Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(v_ICConn.conndate)  as Weekly
FROM v_ICConn
INNER JOIN tblActIDS
ON v_ICConn.actid=tblActIDS.ACTID
where v_ICConn.conndate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_ICConn.ic_type,v_ICConn.actid,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS SCOPE
SELECT  
'Electrical' as Discipline,'Cable Connection' as [Activity],
v_ECConn.ACTID as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,count(v_ECConn.ACTID) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM v_ECConn
INNER JOIN tblActIDS
ON v_ECConn.ACTID=tblActIDS.ACTID
GROUP BY v_ECConn.ec_type,v_ECConn.ACTID,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS DONE
SELECT  
'Electrical' as Discipline,'Cable Connection' as [Activity],
v_ECConn.ACTID as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,count(v_ECConn.CONNDATE)
as [Qty Done]
,0 as weekly
FROM v_ECConn
INNER JOIN tblActIDS
ON v_ECConn.ACTID=tblActIDS.ACTID
AND v_ECConn.CONNDATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_ECConn.ec_type,v_ECConn.ACTID,  tblActIDS.EICA_Area
---------------------------------------------------------
UNION ALL
--ELECTRICAL CABLES CONNECTIONS Weekly
SELECT  
'Electrical' as Discipline,'Cable Connection' as [Activity],
v_ECConn.ACTID as actid, tblActIDS.EICA_Area, 
'EACH' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(v_ECConn.CONNDATE) as Weekly
FROM v_ECConn
INNER JOIN tblActIDS
ON v_ECConn.ACTID=tblActIDS.ACTID
where v_ECConn.CONNDATE between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_ECConn.ec_type,v_ECConn.ACTID,  tblActIDS.EICA_Area
-----------------------------------------------------------
UNION ALL
--Lighting JB SCOPE 
SELECT DISTINCT 
'Lighting' as Discipline,'JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.TAG) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB DONE 
SELECT DISTINCT 
'Lighting' as Discipline,'JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting JB Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'JB' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture
where Active=1
and tblLightingFixture.LF_Ref_Desc ='Lighting JB'
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture SCOPE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,COUNT(tblLightingFixture.tag) AS Scope
,0 as [Qty Done]
,0 as weekly
FROM tblLightingFixture
where Active=1
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture DONE
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblLightingFixture.LF_Installed) as [Qty Done]
,0 as weekly
FROM tblLightingFixture
where Active=1
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
AND LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
-----------------------------------------------------------
UNION ALL
--Lighting Fixture Weekly
SELECT DISTINCT 
'Lighting' as Discipline,'Fixture' as [Activity],
tblLightingFixture.IC_Plan_P6_ActID_Install as actid, tblLightingFixture.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblLightingFixture.LF_Installed) as Weekly
FROM tblLightingFixture
where Active=1
and tblLightingFixture.LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
and tblLightingFixture.LF_Ref_Desc <> 'Lighting JB'
GROUP BY tblLightingFixture.IC_Plan_P6_ActID_Install,  tblLightingFixture.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Scope
SELECT DISTINCT 
tblMSCCable.Type as Discipline,'Cable Pulling' as [Activity],
IC_Plan_P6_ActID_Pulling as actid, Area, 
'LM' as [Measure]
,sum(Length) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMSCCable
where active=1
GROUP BY tblMSCCable.Type,IC_Plan_P6_ActID_Pulling,  Area
-----------------------------------------------------------
UNION ALL
--Misc Cable Pulling Pulled
SELECT DISTINCT 
vCblParProductionTotal.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProductionTotal.PullingActID as actid, vCblParProductionTotal.Area, 
'LM' as [Measure]
,0 AS Scope
,sum(vCblParProductionTotal.[Total Done]) as [Qty Done]
,0 as Weekly
FROM vCblParProductionTotal
where Discipline='Msc Cable'
AND PRO_DATE <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProductionTotal.Type,vCblParProductionTotal.PullingActID, vCblParProductionTotal.Area
---------------------------------------------------------
UNION ALL
--Misc Cable Weekly
SELECT DISTINCT 
vCblParProduction.Type as Discipline,'Cable Pulling' as [Activity],
vCblParProduction.PullingActID as actid, vCblParProduction.Area, 
'LM' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(vCblParProduction.qnty) as Weekly
FROM vCblParProduction
where Discipline='Msc Cable'
and vCblParProduction.Pro_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY vCblParProduction.Type,vCblParProduction.PullingActID,  vCblParProduction.Area
---------------------------------------------------------
UNION ALL
--Cable Tray
SELECT DISTINCT 
Discipline,[Activity],
Actid  
, Area, 
'LM' as [Measure]
,[Scope LM] AS Scope
,[Pulled LM] as [Qty Done]
,[WK Pulled] as Weekly
FROM v_Trays
---------------------------------------------------------
UNION ALL
--Ele Cable Testing Scope
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,COUNT(tblEleCableList.EC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Scope
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,COUNT(tblInsCableList.IC_ID) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblEleCableList.EC_ID) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.EC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,COUNT(tblInsCableList.IC_ID) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.IC_Megger <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Test as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblEleCableList.EC_ID) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.EC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Test,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable Testing Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable' as [Activity],
tblInsCableList.IC_Plan_P6_ActID_Test as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsCableList.IC_ID) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.IC_Megger between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.IC_Plan_P6_ActID_Test,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Done
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,sum(v_Items.totalqnty) as [Qty Done]
,0 as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Misc Items Weekly
SELECT DISTINCT 
'Misc Items' as Discipline,v_Items.type_id as [Activity],
v_Items.activity_id as actid, v_Items.Area, 
'Bulk' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,sum(v_Items.totalqnty) as Weekly
FROM v_Items WITH (NOLOCK)
where Active=1
and v_Items.lastupdatedate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY v_Items.type_id,v_Items.activity_id,  v_Items.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released SCOPE
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,count(tblEleCableList.ec_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Done
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblEleCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ele Cable QC Released Weekly
SELECT DISTINCT 
'Electrical' as Discipline,'Cable Released' as [Activity],
tblEleCableList.EC_Plan_P6_ActID_Connect + '-QC' as actid, tblEleCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblEleCableList.TR_QC_Released) as Weekly
FROM tblEleCableList WITH (NOLOCK)
where Active=1
and tblEleCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblEleCableList.EC_Plan_P6_ActID_Connect,  tblEleCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released SCOPE
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,count(tblInsCableList.ic_id) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Done
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsCableList.TR_QC_Released) as [Qty Done]
,0 as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL
--Ins Cable QC Released Weekly
SELECT DISTINCT 
'Instrumentation' as Discipline,'Cable Released' as [Activity],
tblInsCableList.iC_Plan_P6_ActID_Connect + '-QC' as actid, tblInsCableList.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,count(tblInsCableList.TR_QC_Released) as Weekly
FROM tblInsCableList WITH (NOLOCK)
where Active=1
and tblInsCableList.TR_QC_Released between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsCableList.iC_Plan_P6_ActID_Connect,  tblInsCableList.Area
-----------------------------------------------------------
UNION ALL

--Uni Equipment SCOPE
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblEquipment 
where Active=1
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(InstalledDate) as [Qty Done]
,0 as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
AND InstalledDate <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Equipment Installed Weekly
SELECT DISTINCT 
Discipline,'Equipment' as [Activity],
ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblEquipment WITH (NOLOCK)
where Active=1
and InstalledDate between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY Discipline, ActId,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors SCOPE
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Solo Run' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,COUNT(Tag) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblMotor 
where Active=1
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Solo Run' as [Activity],
SoloRunActID AS ActId
, Area, 
'Each' as [Measure]
,0 AS Scope
,count(solo_run_date) as [Qty Done]
,0 as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
AND solo_run_date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Uni Motors Installed Weekly
SELECT DISTINCT 
'Pre-Comm' AS Discipline,'Solo Run' as [Activity],
SoloRunActID AS ActId, Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(Tag) as Weekly
FROM tblMotor WITH (NOLOCK)
where Active=1
and solo_run_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1) 
GROUP BY SoloRunActID,  Area
------------------------------------------------------------------
UNION ALL
--Loop SCOPE
SELECT DISTINCT 
'Pre-Comm' as Discipline,'Loop Test' as [Activity],
tblInsLoop.ACTIVITYID as actid, tblInsLoop.Area, 
'Each' as [Measure]
,COUNT(tblInsLoop.LoopName) AS Scope
,0 as [Qty Done]
,0 as Weekly
FROM tblInsLoop WITH (NOLOCK)
where Active=1
GROUP BY tblInsLoop.ACTIVITYID,  tblInsLoop.Area
-----------------------------------------------------------
UNION ALL
--Loop DONE
SELECT DISTINCT 
'Pre-Comm' as Discipline,'Loop Test' as [Activity],
tblInsLoop.ACTIVITYID as actid, tblInsLoop.Area, 
'Each' as [Measure]
,0 AS Scope
,count(tblInsLoop.L_Done) as [Qty Done]
,0 as Weekly
FROM tblInsLoop WITH (NOLOCK)
where Active=1
AND L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsLoop.ACTIVITYID,  tblInsLoop.Area
-----------------------------------------------------------
UNION ALL
--Loop Weekly
SELECT DISTINCT 
'Pre-Comm' as Discipline,'Loop Test' as [Activity],
tblInsLoop.ACTIVITYID as actid, tblInsLoop.Area, 
'Each' as [Measure]
,0 AS Scope
,0 as [Qty Done]
,COUNT(tblInsLoop.LoopName) as Weekly
FROM tblInsLoop WITH (NOLOCK)
where Active=1
and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)
GROUP BY tblInsLoop.ACTIVITYID,  tblInsLoop.Area
-----------------------------------------------------------


) as v1
) as v2

where [Act ID] is not null
and [Act ID] <> ''
group by 
Discipline,[Activity],[Act ID]
) AS vDynamicAvts
inner JOIN tblActIDS
ON tblActIDS.ActID=vDynamicAvts.[Act ID]
inner join 
(
SELECT Area.Area,unit.unit,unit.Block  FROM [Area]
inner join unit
on [Area].Unit=unit.Unit 
) as vBlock
on eica_Area=vblock.Area
) as VSum
WHERE [Activity]<>'Cable Connection2'
group by
Discipline,[Activity],PCS_Area

order by Discipline,[Activity],PCS_Area
GO
IF NOT EXISTS(SELECT 1 FROM sys.columns 
          WHERE Name = N'Family'
          AND Object_ID = Object_ID(N'dbo.tblEquipment'))
BEGIN
    ALTER TABLE tblEquipment
    ADD Family NVARCHAR(250) NULL
END
GO

IF NOT EXISTS(SELECT 1 FROM sys.columns 
          WHERE Name = N'PO'
          AND Object_ID = Object_ID(N'dbo.tblEquipment'))
BEGIN
    ALTER TABLE tblEquipment
    ADD PO NVARCHAR(250) NULL
END
GO

IF NOT EXISTS(SELECT 1 FROM sys.columns 
          WHERE Name = N'ForecastedDate'
          AND Object_ID = Object_ID(N'dbo.tblEquipment'))
BEGIN
    ALTER TABLE tblEquipment
    ADD ForecastedDate DATE NULL
END
GO

IF NOT EXISTS(SELECT 1 FROM sys.columns 
          WHERE Name = N'ReceivedDate'
          AND Object_ID = Object_ID(N'dbo.tblEquipment'))
BEGIN
    ALTER TABLE tblEquipment
    ADD ReceivedDate DATE NULL
END
GO

IF NOT EXISTS(SELECT 1 FROM sys.columns 
          WHERE Name = N'Status'
          AND Object_ID = Object_ID(N'dbo.tblEquipment'))
BEGIN
    ALTER TABLE tblEquipment
    ADD [Status] NVARCHAR(250) NULL
END
GO

IF NOT EXISTS(SELECT 1 FROM sys.columns 
          WHERE Name = N'Remarks'
          AND Object_ID = Object_ID(N'dbo.tblEquipment'))
BEGIN
    ALTER TABLE tblEquipment
    ADD Remarks NVARCHAR(250) NULL
END
GO

IF NOT EXISTS(SELECT 1 FROM sys.columns 
          WHERE Name = N'Location'
          AND Object_ID = Object_ID(N'dbo.tblEquipment'))
BEGIN
    ALTER TABLE tblEquipment
    ADD [Location] NVARCHAR(250) NULL
END
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetPDSModelSummary'
			AND schema_id = (select schema_id from sys.schemas where name = 'PLANNING')
			)
BEGIN
	DROP PROC PLANNING.GetPDSModelSummary
END
GO
CREATE PROC PLANNING.GetPDSModelSummary


AS


WITH ActIDS AS (
    SELECT
        ActID, PDSModel
        FROM tblActIDS
), ECPro AS (
    SELECT
        Tag, SUM(Per_Qnty) AS TotalPer
    FROM tblEleCableProduction
    GROUP BY Tag
), ICPro AS (
    SELECT
        Tag, SUM(Per_Qnty) AS TotalPer
    FROM tblEleCableProduction
    GROUP BY Tag
)

SELECT
    PDSModel,
    SUM([Ele. Pulling Scope]) AS [Ele. Pulling Scope], SUM([Ele. Pulling Done]) AS [Ele. Pulling Done], SUM([Ele. Pulling Pending]) AS [Ele. Pulling Pending],
    SUM([Ele. Termination Scope]) AS [Ele. Termination Scope], SUM([Ele. Termination Done]) AS [Ele. Termination Done], SUM([Ele. Termination Pending]) AS [Ele. Termination Pending],
    SUM([Ele. Equipment Scope]) AS [Ele. Equipment Scope], SUM([Ele. Equipment Done]) AS [Ele. Equipment Done], SUM([Ele. Equipment Pending]) AS [Ele. Equipment Pending],
    SUM([Ins. Pulling Scope]) AS [Ins. Pulling Scope], SUM([Ins. Pulling Done]) AS [Ins. Pulling Done], SUM([Ins. Pulling Pending]) AS [Ins. Pulling Pending],
    SUM([Ins. Termination Scope]) AS [Ins. Termination Scope], SUM([Ins. Termination Done]) AS [Ins. Termination Done], SUM([Ins. Termination Pending]) AS [Ins. Termination Pending],
    SUM([Inst. Installation Scope]) AS [Inst. Installation Scope], SUM([Inst. Installation Done]) AS [Inst. Installation Done], SUM([Inst. Installation Pending]) AS [Inst. Installation Pending],
    SUM([Inst. Calibration Scope]) AS [Inst. Calibration Scope], SUM([Inst. Calibration Done]) AS [Inst. Calibration Done], SUM([Inst. Calibration Pending]) AS [Inst. Calibration Pending],
    SUM([Inst. Hookup Scope]) AS [Inst. Hookup Scope], SUM([Inst. Hookup Done]) AS [Inst. Hookup Done], SUM([Inst. Hookup Pending]) AS [Inst. Hookup Pending],
    SUM([Inst Equipment Scope]) AS [Inst Equipment Scope], SUM([Inst. Equipment Done]) AS [Inst. Equipment Done], SUM([Ins. Equipment Pending]) AS [Ins. Equipment Pending]

FROM (

    --Ele Pulling

    SELECT
    PDSModel, 
    SUM(ScopePulled) AS [Ele. Pulling Scope], SUM(DonePulled) AS [Ele. Pulling Done], SUM(ScopePulled) - SUM(DonePulled) AS [Ele. Pulling Pending],
    0 AS [Ele. Termination Scope], 0 AS [Ele. Termination Done], 0 AS [Ele. Termination Pending],
    0 AS [Ele. Equipment Scope], 0 AS [Ele. Equipment Done], 0 AS [Ele. Equipment Pending],
    0 AS [Ins. Pulling Scope], 0 AS [Ins. Pulling Done], 0 AS [Ins. Pulling Pending],
    0 AS [Ins. Termination Scope], 0 AS [Ins. Termination Done], 0 AS [Ins. Termination Pending],
    0 AS [Inst. Installation Scope], 0 AS [Inst. Installation Done], 0 AS [Inst. Installation Pending],
    0 AS [Inst. Calibration Scope], 0 AS [Inst. Calibration Done], 0 AS [Inst. Calibration Pending],
    0 AS [Inst. Hookup Scope], 0 AS [Inst. Hookup Done], 0 AS [Inst. Hookup Pending],
    0 AS [Inst Equipment Scope], 0 AS [Inst. Equipment Done], 0 AS [Ins. Equipment Pending]

    FROM (
        SELECT
        ActIDS.PDSModel,
        SUM(tblEleCableList.EC_Length) AS ScopePulled,
        SUM(ECPRO.TotalPer / 100 * tblEleCableList.EC_Length) AS DonePulled
        FROM tblEleCableList
        INNER JOIN ActIDS ON tblEleCableList.EC_Plan_P6_ActID_Pulling = ActIDS.ActID
        LEFT JOIN ECPro ON tblEleCableList.EC_ID = ECPro.Tag
        WHERE tblEleCableList.Active = 1
        GROUP BY ActIDS.PDSModel
    ) AS CableTer
    GROUP BY PDSModel

    UNION ALL

    --Ele Termination
    SELECT
    PDSModel, 
    0 AS [Ele. Pulling Scope], 0 AS [Ele. Pulling Done], 0 AS [Ele. Pulling Pending],
    SUM(ScopeCon) AS [Ele. Termination Scope], SUM(DoneCon) AS [Ele. Termination Done], SUM(ScopeCon) - SUM(DoneCon) AS [Ele. Termination Pending],
    0 AS [Ele. Equipment Scope], 0 AS [Ele. Equipment Done], 0 AS [Ele. Equipment Pending],
    0 AS [Ins. Pulling Scope], 0 AS [Ins. Pulling Done], 0 AS [Ins. Pulling Pending],
    0 AS [Ins. Termination Scope], 0 AS [Ins. Termination Done], 0 AS [Ins. Termination Pending],
    0 AS [Inst. Installation Scope], 0 AS [Inst. Installation Done], 0 AS [Inst. Installation Pending],
    0 AS [Inst. Calibration Scope], 0 AS [Inst. Calibration Done], 0 AS [Inst. Calibration Pending],
    0 AS [Inst. Hookup Scope], 0 AS [Inst. Hookup Done], 0 AS [Inst. Hookup Pending],
    0 AS [Inst Equipment Scope], 0 AS [Inst. Equipment Done], 0 AS [Ins. Equipment Pending]

    FROM (
        SELECT
        ActIDS.PDSModel,
        COUNT(EC_Plan_P6_ActID_Connect) AS ScopeCon,
        COUNT(EC_Plan_Connected_Date_From) AS DoneCon
        FROM tblEleCableList
        INNER JOIN ActIDS ON tblEleCableList.EC_Plan_P6_ActID_Connect = ActIDS.ActID
        WHERE tblEleCableList.Active = 1
        GROUP BY ActIDS.PDSModel
        UNION ALL
        SELECT
        ActIDS.PDSModel,
        COUNT(EC_Plan_P6_ActID_Connect_2) AS ScopeCon,
        COUNT(EC_Plan_Connected_Date_To) AS DoneCon
        FROM tblEleCableList
        INNER JOIN ActIDS ON tblEleCableList.EC_Plan_P6_ActID_Connect_2 = ActIDS.ActID
        WHERE tblEleCableList.Active = 1
        GROUP BY ActIDS.PDSModel
    ) AS CableTer
    GROUP BY PDSModel

    UNION ALL

    --Ele Equipment
    SELECT
    PDSModel, 
    0 AS [Ele. Pulling Scope], 0 AS [Ele. Pulling Done], 0 AS [Ele. Pulling Pending],
    0 AS [Ele. Termination Scope], 0 AS [Ele. Termination Done], 0 AS [Ele. Termination Pending],
    SUM(Scope) AS [Ele. Equipment Scope], SUM(Done) AS [Ele. Equipment Done], SUM(Scope) - SUM(Done) AS [Ele. Equipment Pending],
    0 AS [Ins. Pulling Scope], 0 AS [Ins. Pulling Done], 0 AS [Ins. Pulling Pending],
    0 AS [Ins. Termination Scope], 0 AS [Ins. Termination Done], 0 AS [Ins. Termination Pending],
    0 AS [Inst. Installation Scope], 0 AS [Inst. Installation Done], 0 AS [Inst. Installation Pending],
    0 AS [Inst. Calibration Scope], 0 AS [Inst. Calibration Done], 0 AS [Inst. Calibration Pending],
    0 AS [Inst. Hookup Scope], 0 AS [Inst. Hookup Done], 0 AS [Inst. Hookup Pending],
    0 AS [Inst Equipment Scope], 0 AS [Inst. Equipment Done], 0 AS [Ins. Equipment Pending]

    FROM (
        SELECT
        ActIDS.PDSModel,
        COUNT(Tag) AS Scope,
        COUNT(InstalledDate) AS Done
        FROM tblEquipment
        INNER JOIN ActIDS ON tblEquipment.ActId = ActIDS.ActID
        WHERE tblEquipment.Active = 1 AND tblEquipment.Discipline = 'Electrical'
        GROUP BY ActIDS.PDSModel
    ) AS CableTer
    GROUP BY PDSModel

    --Ins Pulling
    UNION ALL

    SELECT
    PDSModel, 
    0 AS [Ele. Pulling Scope], 0 AS [Ele. Pulling Done], 0 AS [Ele. Pulling Pending],
    0 AS [Ele. Termination Scope], 0 AS [Ele. Termination Done], 0 AS [Ele. Termination Pending],
    0 AS [Ele. Equipment Scope], 0 AS [Ele. Equipment Done], 0 AS [Ele. Equipment Pending],
    SUM(ScopePulled) AS [Ins. Pulling Scope], SUM(DonePulled) AS [Ins. Pulling Done], SUM(ScopePulled) - SUM(DonePulled) AS [Ins. Pulling Pending],
    0 AS [Ins. Termination Scope], 0 AS [Ins. Termination Done], 0 AS [Ins. Termination Pending],
    0 AS [Inst. Installation Scope], 0 AS [Inst. Installation Done], 0 AS [Inst. Installation Pending],
    0 AS [Inst. Calibration Scope], 0 AS [Inst. Calibration Done], 0 AS [Inst. Calibration Pending],
    0 AS [Inst. Hookup Scope], 0 AS [Inst. Hookup Done], 0 AS [Inst. Hookup Pending],
    0 AS [Inst Equipment Scope], 0 AS [Inst. Equipment Done], 0 AS [Ins. Equipment Pending]

    FROM (
        SELECT
        ActIDS.PDSModel,
        SUM(tblInsCableList.IC_Length) AS ScopePulled,
        SUM(ICPRO.TotalPer / 100 * tblInsCableList.IC_Length) AS DonePulled
        FROM tblInsCableList
        INNER JOIN ActIDS ON tblInsCableList.IC_Plan_P6_ActID_Pulling = ActIDS.ActID
        LEFT JOIN ICPro ON tblInsCableList.IC_ID = ICPro.Tag
        WHERE tblInsCableList.Active = 1
        GROUP BY ActIDS.PDSModel
    ) AS CableTer
    GROUP BY PDSModel

    --Ins Termination
    UNION ALL

    SELECT
    PDSModel,
    0 AS [Ele. Pulling Scope], 0 AS [Ele. Pulling Done], 0 AS [Ele. Pulling Pending],
    0 AS [Ele. Termination Scope], 0 AS [Ele. Termination Done], 0 AS [Ele. Termination Pending],
    0 AS [Ele. Equipment Scope], 0 AS [Ele. Equipment Done], 0 AS [Ele. Equipment Pending],
    0 AS [Ins. Pulling Scope], 0 AS [Ins. Pulling Done], 0 AS [Ins. Pulling Pending],
    SUM(ScopeCon) AS [Ins. Termination Scope], SUM(DoneCon) AS [Ins. Termination Done], SUM(ScopeCon) - SUM(DoneCon) AS [Ins. Termination Pending],
    0 AS [Inst. Installation Scope], 0 AS [Inst. Installation Done], 0 AS [Inst. Installation Pending],
    0 AS [Inst. Calibration Scope], 0 AS [Inst. Calibration Done], 0 AS [Inst. Calibration Pending],
    0 AS [Inst. Hookup Scope], 0 AS [Inst. Hookup Done], 0 AS [Inst. Hookup Pending],

    0 AS [Inst Equipment Scope], 0 AS [Inst. Equipment Done], 0 AS [Ins. Equipment Pending]
    FROM (
        SELECT
        ActIDS.PDSModel,
        COUNT(IC_Plan_P6_ActID_Connect) AS ScopeCon,
        COUNT(IC_Plan_Connected_Date_From) AS DoneCon
        FROM tblInsCableList
        INNER JOIN ActIDS ON tblInsCableList.IC_Plan_P6_ActID_Connect = ActIDS.ActID
        WHERE tblInsCableList.Active = 1
        GROUP BY ActIDS.PDSModel
        UNION ALL
        SELECT
        ActIDS.PDSModel,
        COUNT(IC_Plan_P6_ActID_Connect_2) AS ScopeCon,
        COUNT(IC_Plan_Connected_Date_To) AS DoneCon
        FROM tblInsCableList
        INNER JOIN ActIDS ON tblInsCableList.IC_Plan_P6_ActID_Connect_2 = ActIDS.ActID
        WHERE tblInsCableList.Active = 1
        GROUP BY ActIDS.PDSModel
    ) AS CableTer
    GROUP BY PDSModel

    UNION ALL

    --Inst INstallation
    SELECT
    PDSModel, 
    0 AS [Ele. Pulling Scope], 0 AS [Ele. Pulling Done], 0 AS [Ele. Pulling Pending],
    0 AS [Ele. Termination Scope], 0 AS [Ele. Termination Done], 0 AS [Ele. Termination Pending],
    0 AS [Ele. Equipment Scope], 0 AS [Ele. Equipment Done], 0 AS [Ele. Equipment Pending],
    0 AS [Ins. Pulling Scope], 0 AS [Ins. Pulling Done], 0 AS [Ins. Pulling Pending],
    0 AS [Ins. Termination Scope], 0 AS [Ins. Termination Done], 0 AS [Ins. Termination Pending],
    SUM(Scope) AS [Inst. Installation Scope], SUM(Done) AS [Inst. Installation Done], SUM(Scope) - SUM(Done) AS [Inst. Installation Pending],
    0 AS [Inst. Calibration Scope], 0 AS [Inst. Calibration Done], 0 AS [Inst. Calibration Pending],
    0 AS [Inst. Hookup Scope], 0 AS [Inst. Hookup Done], 0 AS [Inst. Hookup Pending],
    0 AS [Inst Equipment Scope], 0 AS [Inst. Equipment Done], 0 AS [Ins. Equipment Pending]

    FROM (
        SELECT
        ActIDS.PDSModel,
        COUNT(Instrument_Tag) AS Scope,
        COUNT(Installation_Date) AS Done
        FROM tblInstruments
        INNER JOIN ActIDS ON tblInstruments.IC_Plan_P6_ActID_Install = ActIDS.ActID
        WHERE tblInstruments.Active = 1 AND ((tblInstruments.Furnished_By <> 'Vendor') OR (tblInstruments.Furnished_By IS NULL)) AND tblInstruments.Instrument  = 'Instrument'
        GROUP BY ActIDS.PDSModel
    ) AS CableTer
    GROUP BY PDSModel

    UNION ALL

    --Inst Calibration
    SELECT
    PDSModel, 
    0 AS [Ele. Pulling Scope], 0 AS [Ele. Pulling Done], 0 AS [Ele. Pulling Pending],
    0 AS [Ele. Termination Scope], 0 AS [Ele. Termination Done], 0 AS [Ele. Termination Pending],
    0 AS [Ele. Equipment Scope], 0 AS [Ele. Equipment Done], 0 AS [Ele. Equipment Pending],
    0 AS [Ins. Pulling Scope], 0 AS [Ins. Pulling Done], 0 AS [Ins. Pulling Pending],
    0 AS [Ins. Termination Scope], 0 AS [Ins. Termination Done], 0 AS [Ins. Termination Pending],
    0 AS [Inst. Installation Scope], 0 AS [Inst. Installation Done], 0 AS [Inst. Installation Pending],
    SUM(Scope) AS [Inst. Calibration Scope], SUM(Done) AS [Inst. Calibration Done], SUM(Scope) - SUM(Done) AS [Inst. Calibration Pending],
    0 AS [Inst. Hookup Scope], 0 AS [Inst. Hookup Done], 0 AS [Inst. Hookup Pending],
    0 AS [Inst Equipment Scope], 0 AS [Inst. Equipment Done], 0 AS [Ins. Equipment Pending]

    FROM (
        SELECT
        ActIDS.PDSModel,
        COUNT(Instrument_Tag) AS Scope,
        COUNT(Calibration_Date) AS Done
        FROM tblInstruments
        INNER JOIN ActIDS ON tblInstruments.P6_Precalibration_ActID = ActIDS.ActID
        WHERE tblInstruments.Active = 1 AND tblInstruments.Calibration_Type  = 'yes'
        GROUP BY ActIDS.PDSModel
    ) AS CableTer
    GROUP BY PDSModel

    UNION ALL

    --Inst Hookup
    SELECT
    PDSModel, 
    0 AS [Ele. Pulling Scope], 0 AS [Ele. Pulling Done], 0 AS [Ele. Pulling Pending],
    0 AS [Ele. Termination Scope], 0 AS [Ele. Termination Done], 0 AS [Ele. Termination Pending],
    0 AS [Ele. Equipment Scope], 0 AS [Ele. Equipment Done], 0 AS [Ele. Equipment Pending],
    0 AS [Ins. Pulling Scope], 0 AS [Ins. Pulling Done], 0 AS [Ins. Pulling Pending],
    0 AS [Ins. Termination Scope], 0 AS [Ins. Termination Done], 0 AS [Ins. Termination Pending],
    0 AS [Inst. Installation Scope], 0 AS [Inst. Installation Done], 0 AS [Inst. Installation Pending],
    0 AS [Inst. Calibration Scope], 0 AS [Inst. Calibration Done], 0 AS [Inst. Calibration Pending],
    SUM(Scope) AS [Inst. Hookup Scope], SUM(Done) AS [Inst. Hookup Done], SUM(Scope) - SUM(Done) AS [Inst. Hookup Pending],
    0 AS [Inst Equipment Scope], 0 AS [Inst. Equipment Done], 0 AS [Ins. Equipment Pending]

    FROM (
        SELECT
        ActIDS.PDSModel,
        COUNT(Instrument_Tag) AS Scope,
        COUNT(HookUp_Date) AS Done
        FROM tblInstruments
        INNER JOIN ActIDS ON tblInstruments.IC_Plan_P6_ActID_Hookup = ActIDS.ActID
        WHERE tblInstruments.Active = 1 AND tblInstruments.hookup_name  IS NOT NULL
        GROUP BY ActIDS.PDSModel
    ) AS CableTer
    GROUP BY PDSModel

    UNION ALL

    --Ins Equipment
    SELECT
    PDSModel, 
    0 AS [Ele. Pulling Scope], 0 AS [Ele. Pulling Done], 0 AS [Ele. Pulling Pending],
    0 AS [Ele. Termination Scope], 0 AS [Ele. Termination Done], 0 AS [Ele. Termination Pending],
    0 AS [Ele. Equipment Scope], 0 AS [Ele. Equipment Done], 0 AS [Ele. Equipment Pending],
    0 AS [Ins. Pulling Scope], 0 AS [Ins. Pulling Done], 0 AS [Ins. Pulling Pending],
    0 AS [Ins. Termination Scope], 0 AS [Ins. Termination Done], 0 AS [Ins. Termination Pending],
    0 AS [Inst. Installation Scope], 0 AS [Inst. Installation Done], 0 AS [Inst. Installation Pending],
    0 AS [Inst. Calibration Scope], 0 AS [Inst. Calibration Done], 0 AS [Inst. Calibration Pending],
    0 AS [Inst. Hookup Scope], 0 AS [Inst. Hookup Done], 0 AS [Inst. Hookup Pending],
    SUM(Scope) AS [Inst Equipment Scope], SUM(Done) AS [Inst. Equipment Done], SUM(Scope) - SUM(Done) AS [Ins. Equipment Pending]

    FROM (
        SELECT
        ActIDS.PDSModel,
        COUNT(Tag) AS Scope,
        COUNT(InstalledDate) AS Done
        FROM tblEquipment
        INNER JOIN ActIDS ON tblEquipment.ActId = ActIDS.ActID
        WHERE tblEquipment.Active = 1 AND tblEquipment.Discipline <> 'Electrical'
        GROUP BY ActIDS.PDSModel
    ) AS CableTer
    GROUP BY PDSModel
) AS VAll
GROUP BY PDSModel



OPTION (USE HINT ('DISABLE_ROW_MODE_MEMORY_GRANT_FEEDBACK'))
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetPDSModelItemDetailsEleCables'
			AND schema_id = (select schema_id from sys.schemas where name = 'PLANNING')
			)
BEGIN
	DROP PROC PLANNING.GetPDSModelItemDetailsEleCables
END
GO
CREATE PROC PLANNING.GetPDSModelItemDetailsEleCables
@PDDSModel NVARCHAR(250)

AS

WITH ActIDS AS (
    SELECT
        ActID, PDSModel
        FROM tblActIDS
        WHERE PDSModel = @PDDSModel
), ECPro AS (
    SELECT
        Tag, SUM(Per_Qnty) AS TotalPer
    FROM tblEleCableProduction
    GROUP BY Tag
), ICPro AS (
    SELECT
        Tag, SUM(Per_Qnty) AS TotalPer
    FROM tblEleCableProduction
    GROUP BY Tag
)


--Ele Pulling

SELECT
tblEleCableList.EC_ID
FROM tblEleCableList
INNER JOIN ActIDS ON tblEleCableList.EC_Plan_P6_ActID_Pulling = ActIDS.ActID
LEFT JOIN ECPro ON tblEleCableList.EC_ID = ECPro.Tag
WHERE tblEleCableList.Active = 1

GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetLighting'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.GetLighting
END
GO
CREATE PROC [CONSTRUCTION].[GetLighting]
AS
SELECT tblLightingFixture.[TBL_ID] AS Id
      ,[Tag]
      ,[Area]
      ,[LF_Ref_Desc] AS [Type]
      ,[IC_Plan_P6_ActID_Install] As [ActId]
      ,tblActIDS.ActName
      ,tblActIDS.SubCon AS [Act Subcon]
      ,[LF_Dwg] AS [Drawing Number]
      ,[Subsystem]
      ,[Arrival_Date] AS [Received Date]
      ,[LF_Installed] AS [Installed Date]
	  ,reportedBy AS [Reported By]
	  ,tblLightingFixture.PDSModel
      ,tblLightingFixture.[Team]
	  ,CASE WHEN Active = 1 THEN 'Active' ELSE 'DELETED' END AS Status
      ,CASE WHEN Res.ItemId IS NOT NULL THEN 'Yes' ELSE 'No' END AS [Resource]
  FROM [tblLightingFixture] WITH (NOLOCK)
  LEFT JOIN tblActIDS on tblLightingFixture.IC_Plan_P6_ActID_Install = tblActIDS.ActID
  LEFT JOIN (SELECT [ItemId] FROM [dbo].[tblResourcesItem] WITH (NOLOCK) WHERE GroupId = 900) AS Res ON tblLightingFixture.TBL_ID = Res.ItemId
  OPTION (USE HINT ('DISABLE_ROW_MODE_MEMORY_GRANT_FEEDBACK'))
GO