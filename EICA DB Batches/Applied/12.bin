--version10.5
UPDATE [dbo].[tblSettings] SET SetValue = 10.5 WHERE SetName = 'VERSION'
GO
IF NOT EXISTS(SELECT 1 FROM sys.columns 
          WHERE Name = N'Discipline'
          AND Object_ID = Object_ID(N'dbo.tblEleCableList'))
BEGIN
    ALTER TABLE tblEleCableList
    ADD Discipline NVARCHAR(250) NOT NULL DEFAULT 'Electrical'
END
GO
IF NOT EXISTS(SELECT 1 FROM sys.columns 
          WHERE Name = N'Discipline'
          AND Object_ID = Object_ID(N'dbo.tblInsCableList'))
BEGIN
    ALTER TABLE tblInsCableList
    ADD Discipline NVARCHAR(250) NOT NULL DEFAULT 'Instrumentation'
END
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetCables'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.GetCables
END
GO
CREATE PROC [CONSTRUCTION].[GetCables]
AS
WITH ElePro AS (
SELECT 
      [Tag]
      ,SUM([Per_Qnty]) AS TotalPercentage
      ,MAX([Pro_Date]) AS LastUpdated
FROM [tblEleCableProduction] WITH (NOLOCK)
GROUP BY Tag
), InsPro AS (
SELECT 
      [Tag]
      ,SUM([Per_Qnty]) AS TotalPercentage
      ,MAX([Pro_Date]) AS LastUpdated
FROM [tblInsCableProduction] WITH (NOLOCK)
GROUP BY Tag
)

SELECT 
Discipline,[Area],[EC_Type] AS [Type],[EC_ID] AS Tag,[EC_Length] AS [Length],[EC_Description] AS [Description],Routing
,[SubSystem],[EC_From] AS [From],[From_Description] AS [From Description],[EC_To] AS [To],[To_Description] AS [To Description],Drawing

,[EC_Plan_P6_ActID_Pulling] AS [Pulling ActId]
,[EC_Plan_P6_ActID_Connect] AS [Con From ActId]
,[EC_Plan_P6_ActID_Connect_2] AS [Con To ActId]
,[EC_Plan_P6_ActID_Test] AS [Test ActId]

,PullingWorkfront AS [Pulling Workfront]
,ElePro.TotalPercentage * EC.EC_Length / 100 AS [Pulled Lm]
,ElePro.LastUpdated [Pulled Date]
,ElePro.TotalPercentage

,GlandFromWorkfront AS [Gland From Workfront]
,EC_Cable_Gland_From AS [Gland From Date]

,GlandToWorkfront AS [Gland To Workfront]
,EC_Cable_Gland_To AS [Gland To Date]

,ConnFromWorkfront AS [Conn From Workfront]
,[EC_Plan_Connected_Date_From] AS [Con From Date]

,ConnToWorkfront AS [Conn To Workfront]
,[EC_Plan_Connected_Date_To] AS [Con To Date]

,[EC_Megger] AS [Test Date]
,[TR_QC_Released] AS [QC Released Date]
,RFINumber
,PDSModel
,[Remarks]
,[Team]
,CASE WHEN Active = 1 THEN 'Active' ELSE 'DELETED' END AS Status
FROM [tblEleCableList] AS EC WITH (NOLOCK)
LEFT JOIN ElePro ON EC.EC_ID = ElePro.Tag


UNION ALL

SELECT 
Discipline,[Area],[IC_Type] AS [Type],[IC_ID] AS Tag,[IC_Length] AS [Length],[IC_Description] AS [Description],Routing
,[SubSystem],[IC_From] AS [From],[From_Description] AS [From Description],[IC_To] AS [To],[To_Description] AS [To Description],Drawing

,[IC_Plan_P6_ActID_Pulling] AS [Pulling ActId]
,[IC_Plan_P6_ActID_Connect] AS [Con From ActId]
,[IC_Plan_P6_ActID_Connect_2] AS [Con To ActId]
,[IC_Plan_P6_ActID_Test] AS [Test ActId]

,PullingWorkfront AS [Pulling Workfront]
,InsPro.TotalPercentage * IC.IC_Length / 100 AS [Pulled Lm]
,InsPro.LastUpdated [Pulled Date]
,InsPro.TotalPercentage

,GlandFromWorkfront AS [Gland From Workfront]
,IC_Cable_Gland_From AS [Gland From Date]

,GlandToWorkfront AS [Gland To Workfront]
,IC_Cable_Gland_To AS [Gland To Date]

,ConnFromWorkfront AS [Conn From Workfront]
,[IC_Plan_Connected_Date_From] AS [Con From Date]

,ConnToWorkfront AS [Conn To Workfront]
,[IC_Plan_Connected_Date_To] AS [Con To Date]

,[IC_Megger] AS [Test Date]
,[TR_QC_Released] AS [QC Released Date]
,RFINumber
,PDSModel
,[Remarks]
,[Team]
,CASE WHEN Active = 1 THEN 'Active' ELSE 'DELETED' END AS Status
FROM [tblInsCableList] AS IC WITH (NOLOCK)
LEFT JOIN InsPro ON IC.IC_ID = InsPro.Tag
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetCablesFull'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.GetCablesFull
END
GO
CREATE PROC [CONSTRUCTION].[GetCablesFull]
AS

If(OBJECT_ID('tempdb..#Equipment') Is Not Null)
Begin
    Drop Table #Equipment
End

If(OBJECT_ID('tempdb..#ElePro') Is Not Null)
Begin
    Drop Table #ElePro
End

If(OBJECT_ID('tempdb..#InsPro') Is Not Null)
Begin
    Drop Table #InsPro
End

If(OBJECT_ID('tempdb..#ActId') Is Not Null)
Begin
    Drop Table #ActId
End

DECLARE @cutoff DATE
SELECT @cutoff = tblTMP.tmp_date FROM tblTmp WHERE tblTMP.tmp_id = 1

CREATE TABLE #Equipment (
Discipline NVARCHAR(250) NOT NULL,
Type NVARCHAR(250) NULL,
SubType NVARCHAR(250) NULL,
Area NVARCHAR(250) NULL,
Subsystem NVARCHAR(250) NULL,
Tag NVARCHAR(250) NOT NULL,
Description NVARCHAR(250) NULL,
ActId NVARCHAR(250) NULL,
InstallationDate DATE NULL,
QCReleasedDate DATE NULL,
InstallationScope NVARCHAR(250) NULL,
RFI NVARCHAR(250) NULL,
PDSModel NVARCHAR(250) NULL,
Team NVARCHAR(250) NULL,
Status NVARCHAR(50) NOT NULL
)

CREATE TABLE #ElePro (
Tag NVARCHAR(250) NOT NULL,
TotalPercentage FLOAT NOT NULL DEFAULT 0,
LastUpdated DATE NOT NULL,
Weekly FLOAT NOT NULL DEFAULT 0
)

CREATE TABLE #InsPro (
Tag NVARCHAR(250) NOT NULL,
TotalPercentage FLOAT NOT NULL DEFAULT 0,
LastUpdated DATE NOT NULL,
Weekly FLOAT NOT NULL DEFAULT 0
)

CREATE TABLE #ActId (
[ActID] NVARCHAR(250) NOT NULL,
[ActName] NVARCHAR(250) NULL,
[SubCon] NVARCHAR(250) NULL,
[Family] NVARCHAR(250) NULL,
[EICA_Area] NVARCHAR(250) NULL,
[Team] NVARCHAR(250) NULL,
[StartDate] DATE NULL,
[EndDate] DATE NULL
)

INSERT INTO #ElePro 
SELECT 
      [Tag]
      ,SUM([Per_Qnty]) AS TotalPercentage
      ,MAX([Pro_Date]) AS LastUpdated
      ,SUM(CASE WHEN pro_Date BETWEEN DATEADD(DAY, -6, @cutoff) AND @cutoff THEN Per_Qnty ELSE 0 END) AS Weekly
FROM [tblEleCableProduction] WITH (NOLOCK)
GROUP BY Tag



INSERT INTO #InsPro
SELECT 
      [Tag]
      ,SUM([Per_Qnty]) AS TotalPercentage
      ,MAX([Pro_Date]) AS LastUpdated
      ,SUM(CASE WHEN pro_Date BETWEEN DATEADD(DAY, -6, @cutoff) AND @cutoff THEN Per_Qnty ELSE 0 END) AS Weekly
FROM [tblInsCableProduction] WITH (NOLOCK)
GROUP BY Tag


INSERT INTO #Equipment
EXEC CONSTRUCTION.GetEquipment

INSERT INTO #Equipment
SELECT 
'Instrumentation' AS Discipline,Ins_Type AS [Type],[Furnished_By] AS SubType,Area,[Subsystem]
,Instrument_Tag AS Tag
,[Instrument_Type_Desc] AS [Description]
,[IC_Plan_P6_ActID_Install] AS [ActId]
,Installation_Date AS [Installed Date]
,Final_Installed_Date AS [QC Released Date]
,RFINumberInstallation AS RFI
,NULL AS [Installation Scope]
,PDSModel
,[Team]
,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
FROM tblInstruments WITH (NOLOCK)

INSERT INTO #ActId
SELECT [ActID],[ActName],[SubCon],[Family],[EICA_Area],[Team],[StartDate],[EndDate] FROM [tblActIDS] WITH (NOLOCK)

SELECT DISTINCT
EC.Discipline,EC.[Area],[EC_Type] AS [Type],[EC_ID] AS Tag,[EC_Length] AS [Length],[EC_Description] AS [Description],Routing
,EC.[SubSystem]
,[EC_From] AS [From],[From_Description] AS [From Description], EqFrom.Area AS [Eq From Area], EqFrom.PDSModel AS [Eq From PDSModel], EqFrom.Team AS [Eq From Team], EqFrom.[Status] AS [Eq From Status]
,[EC_To] AS [To],[To_Description] AS [To Description], EqTo.Area AS [Eq To Area], EqTo.PDSModel AS [Eq To PDSModel], EqTo.Team AS [Eq To Team], EqTo.[Status] AS [Eq To Status]
,Drawing

,[EC_Plan_P6_ActID_Pulling] AS [Pulling ActId], PullAct.ActName AS [Pulling ActName],PullAct.EICA_Area AS [Pulling Act Area],PullAct.Family AS [Pulling Act Family],PullAct.SubCon AS [Pulling Act Subcon],PullAct.Team AS [Pulling Act Team],PullAct.StartDate AS [Pulling Act StartDate],PullAct.EndDate AS [Pulling Act EndDate]
,[EC_Plan_P6_ActID_Connect] AS [Con From ActId], ConFromAct.ActName AS [ConFrom ActName],ConFromAct.EICA_Area AS [ConFrom Act Area],ConFromAct.Family AS [ConFrom Act Family],ConFromAct.SubCon AS [ConFrom Act Subcon],ConFromAct.Team AS [ConFrom Act Team],ConFromAct.StartDate AS [ConFrom Act StartDate],ConFromAct.EndDate AS [ConFrom Act EndDate]
,[EC_Plan_P6_ActID_Connect_2] AS [Con To ActId], ConToAct.ActName AS [ConTo ActName],ConToAct.EICA_Area AS [ConTo Act Area],ConToAct.Family AS [ConTo Act Family],ConToAct.SubCon AS [ConTo Act Subcon],ConToAct.Team AS [ConTo Act Team],ConToAct.StartDate AS [ConTo Act StartDate],ConToAct.EndDate AS [ConTo Act EndDate]
,[EC_Plan_P6_ActID_Test] AS [Test ActId]

,PullingWorkfront AS [Pulling Workfront]
,#ElePro.TotalPercentage * EC.EC_Length / 100 AS [Pulled Lm]
,#ElePro.LastUpdated [Pulled Date]
,#ElePro.TotalPercentage
,#ElePro.Weekly * EC.EC_Length / 100 AS [Weekly Pulled Lm]

,GlandFromWorkfront AS [Gland From Workfront]
,EC_Cable_Gland_From AS [Gland From Date]

,GlandToWorkfront AS [Gland To Workfront]
,EC_Cable_Gland_To AS [Gland To Date]

,ConnFromWorkfront AS [Conn From Workfront]
,[EC_Plan_Connected_Date_From] AS [Con From Date]

,ConnToWorkfront AS [Conn To Workfront]
,[EC_Plan_Connected_Date_To] AS [Con To Date]

,[EC_Megger] AS [Test Date]
,[TR_QC_Released] AS [QC Released Date]
,RFINumber
,EC.PDSModel
,[Remarks]
,EC.[Team]
,CASE WHEN Active = 1 THEN 'Active' ELSE 'DELETED' END AS Status
FROM [tblEleCableList] AS EC WITH (NOLOCK)
LEFT JOIN #ElePro ON EC.EC_ID = #ElePro.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #Equipment AS EqFrom ON EC.EC_From = EqFrom.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #Equipment AS EqTo ON EC.EC_To = EqTo.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS PullAct ON EC.EC_Plan_P6_ActID_Pulling = PullAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS ConFromAct ON EC.EC_Plan_P6_ActID_Connect = ConFromAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS ConToAct ON EC.EC_Plan_P6_ActID_Connect_2 = ConToAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS


UNION ALL

SELECT DISTINCT
IC.Discipline,IC.[Area],[IC_Type] AS [Type],[IC_ID] AS Tag,[IC_Length] AS [Length],[IC_Description] AS [Description],Routing
,IC.[SubSystem]
,[IC_From] AS [From],[From_Description] AS [From Description], EqFrom.Area AS [Eq From Area], EqFrom.PDSModel AS [Eq From PDSModel], EqFrom.Team AS [Eq From Team], EqFrom.[Status] AS [Eq From Status]
,[IC_To] AS [To],[To_Description] AS [To Description], EqTo.Area AS [Eq To Area], EqTo.PDSModel AS [Eq To PDSModel], EqTo.Team AS [Eq To Team], EqTo.[Status] AS [Eq To Status]
,Drawing

,[IC_Plan_P6_ActID_Pulling] AS [Pulling ActId], PullAct.ActName AS [Pulling ActName],PullAct.EICA_Area AS [Pulling Act Area],PullAct.Family AS [Pulling Act Family],PullAct.SubCon AS [Pulling Act Subcon],PullAct.Team AS [Pulling Act Team],PullAct.StartDate AS [Pulling Act StartDate],PullAct.EndDate AS [Pulling Act EndDate]
,[IC_Plan_P6_ActID_Connect] AS [Con From ActId], ConFromAct.ActName AS [ConFrom ActName],ConFromAct.EICA_Area AS [ConFrom Act Area],ConFromAct.Family AS [ConFrom Act Family],ConFromAct.SubCon AS [ConFrom Act Subcon],ConFromAct.Team AS [ConFrom Act Team],ConFromAct.StartDate AS [ConFrom Act StartDate],ConFromAct.EndDate AS [ConFrom Act EndDate]
,[IC_Plan_P6_ActID_Connect_2] AS [Con To ActId], ConToAct.ActName AS [ConTo ActName],ConToAct.EICA_Area AS [ConTo Act Area],ConToAct.Family AS [ConTo Act Family],ConToAct.SubCon AS [ConTo Act Subcon],ConToAct.Team AS [ConTo Act Team],ConToAct.StartDate AS [ConTo Act StartDate],ConToAct.EndDate AS [ConTo Act EndDate]
,[IC_Plan_P6_ActID_Test] AS [Test ActId]

,PullingWorkfront AS [Pulling Workfront]
,#InsPro.TotalPercentage * IC.IC_Length / 100 AS [Pulled Lm]
,#InsPro.LastUpdated [Pulled Date]
,#InsPro.TotalPercentage
,#InsPro.Weekly * IC.IC_Length / 100 AS [Weekly Pulled Lm]

,GlandFromWorkfront AS [Gland From Workfront]
,IC_Cable_Gland_From AS [Gland From Date]

,GlandToWorkfront AS [Gland To Workfront]
,IC_Cable_Gland_To AS [Gland To Date]

,ConnFromWorkfront AS [Conn From Workfront]
,[IC_Plan_Connected_Date_From] AS [Con From Date]

,ConnToWorkfront AS [Conn To Workfront]
,[IC_Plan_Connected_Date_To] AS [Con To Date]

,[IC_Megger] AS [Test Date]
,[TR_QC_Released] AS [QC Released Date]
,RFINumber
,IC.PDSModel
,[Remarks]
,IC.[Team]
,CASE WHEN Active = 1 THEN 'Active' ELSE 'DELETED' END AS Status
FROM [tblInsCableList] AS IC WITH (NOLOCK)
LEFT JOIN #InsPro ON IC.IC_ID = #InsPro.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #Equipment AS EqFrom ON IC.IC_From = EqFrom.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #Equipment AS EqTo ON IC.IC_To = EqTo.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS PullAct ON IC.IC_Plan_P6_ActID_Pulling = PullAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS ConFromAct ON IC.IC_Plan_P6_ActID_Connect = ConFromAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS ConToAct ON IC.IC_Plan_P6_ActID_Connect_2 = ConToAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetLoopsHCS'
			AND schema_id = (select schema_id from sys.schemas where name = 'LOOPS')
			)
BEGIN
	DROP PROC LOOPS.GetLoopsHCS
END
GO
CREATE PROC [LOOPS].[GetLoopsHCS]
AS
WITH LoopsData AS (

SELECT DISTINCT [TBL_ID] AS Id
	  ,Area
      ,[LoopName] As [Loop Name]
	  ,L_Description AS [Description]
      ,[L_Type] As [Type]
      ,[Sub_Type] AS [Sub Type]
	  ,[Subsystem]
	  ,[Subcontractor]
      ,[Vendor]
	  ,[Folder_Preparation] AS [Folder Printed HO]
	  ,L_Constr_Release AS [Cons Released]
	  ,TR_Loop_Folder_QC_Release AS [QC Released]
	  ,HCS_Folder_Ready AS [Folder Ready QCC]
	  ,Submitted_to_Precom AS [Submitted To Precomm]
	  ,L_Done AS [Done]
	  ,L_FinalApproval AS [Final Approval]
      
	  ,CASE WHEN L_FinalApproval IS NOT NULL THEN 'Folder Approved'
				WHEN L_Done IS NOT NULL THEN 'Loop Done'
		WHEN Submitted_to_Precom IS NOT NULL THEN 'Submitted To Pre-Comm'
		WHEN HCS_Folder_Ready IS NOT NULL THEN 'Folder Ready'
		WHEN TR_Loop_Folder_QC_Release IS NOT NULL THEN 'QC Released'
		WHEN [Folder_Preparation] IS NOT NULL THEN 'Folder Prepared'
		ELSE 'Not Ready'
		END AS [Folder Status]
		,LoopPriority
		,tblProject.Pro_Title AS [Project]
		--,[qrCode] AS QRCode
		,tblInsLoop.ProUUID 
  FROM [tblInsLoop] WITH (NOLOCK)
  INNER JOIN tblProject ON [tblInsLoop].ProUUID = tblProject.UUID
  WHERE [tblInsLoop].Active = 1
)

SELECT DISTINCT
CASE WHEN LOOPS.tblLoopsCons.isClosed = 0 THEN 'Yes' ELSE 'No' END AS [Has Blockage]
,LoopsData.*

FROM LoopsData
LEFT JOIN LOOPS.tblLoopsCons WITH (NOLOCK) ON LoopsData.Id = LOOPS.tblLoopsCons.loopId
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'V' 
			AND name = 'vECList'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP VIEW dbo.vECList
END
GO
CREATE VIEW [dbo].[vECList]
AS
SELECT        TOP (100) PERCENT dbo.tblEleCableList.Area, dbo.tblEleCableList.EC_Type AS Type, dbo.tblEleCableList.EC_ID AS Tag, dbo.tblEleCableList.EC_Length AS [Eng Length], 
                         dbo.vCblParProductionTotal_Vendor.[Total Done] AS [Partial Qnty Done], dbo.V_CBLEACTUALlENGTH.Actual_Length AS [Actual Length], dbo.vCblParProductionTotal_Vendor.Percentage, 
                         dbo.vCblParProductionTotal_Vendor.Pro_Date AS [Last Pulling Update], dbo.tblEleCableList.Pulled_con AS [Pulling Validate], dbo.tblEleCableList.EC_Cable_Gland_From AS [Gland From Date], 
                         dbo.tblEleCableList.EC_Cable_Gland_From_con AS [Gland From Validate], dbo.tblEleCableList.EC_Cable_Gland_To AS [Gland To Date], dbo.tblEleCableList.EC_Cable_Gland_To_con AS [Gland To Validate], 
                         dbo.tblEleCableList.EC_Plan_Connected_Date_From AS [Connect From Date], dbo.tblEleCableList.EC_Plan_Connected_Date_From_con AS [Connect From Validate], 
                         dbo.tblEleCableList.EC_Plan_Connected_Date_To AS [Connect To Date], dbo.tblEleCableList.EC_Plan_Connected_Date_To_con AS [Connect To Validate], dbo.tblEleCableList.EC_Megger AS [Test Date], 
                         dbo.tblEleCableList.EC_Megger_con AS [Test Validate], dbo.tblEleCableList.EC_Plan_Continuity_Date AS [Continuity Test Date], dbo.tblEleCableList.TR_QC_Released AS [Qc Released Date], 
                         dbo.tblEleCableList.EC_Description AS Description, dbo.tblEleCableList.EC_From AS [From Location], dbo.tblEleCableList.From_Description, dbo.tblEleCableList.EC_To AS [To Location], dbo.tblEleCableList.To_Description, 
                         dbo.tblEleCableList.SubSystem, dbo.tblEleCableList.PDSModel, dbo.tblEleCableList.Constraints, dbo.tblEleCableList.Remarks, dbo.tblEleCableList.TrayReleased, dbo.tblActIDS.SubCon AS [Pulling Subcontractor], 
                         tblActIDS_1.SubCon AS [Con 1 Subcontractor], tblActIDS_2.SubCon AS [Con 2 Subcontractor], tblActIDS_3.SubCon AS [Test Subcontractor], dbo.tblEleCableList.EC_Plan_P6_ActID_Pulling, 
                         dbo.tblEleCableList.EC_Plan_P6_ActID_Connect, dbo.tblEleCableList.EC_Plan_P6_ActID_Connect_2, dbo.tblEleCableList.EC_Plan_P6_ActID_Test, dbo.tblEleCableList.Active, dbo.tblEleCableList.Team, 
                         dbo.tblEleCableList.Routing
FROM            dbo.V_CBLEACTUALlENGTH RIGHT OUTER JOIN
                         dbo.tblEleCableList ON dbo.V_CBLEACTUALlENGTH.Tag = dbo.tblEleCableList.EC_ID LEFT OUTER JOIN
                         dbo.vCblParProductionTotal_Vendor ON dbo.tblEleCableList.EC_ID = dbo.vCblParProductionTotal_Vendor.Tag LEFT OUTER JOIN
                         dbo.tblActIDS AS tblActIDS_2 ON dbo.tblEleCableList.EC_Plan_P6_ActID_Connect_2 = tblActIDS_2.ActID LEFT OUTER JOIN
                         dbo.tblActIDS AS tblActIDS_1 ON dbo.tblEleCableList.EC_Plan_P6_ActID_Connect = tblActIDS_1.ActID LEFT OUTER JOIN
                         dbo.tblActIDS ON dbo.tblEleCableList.EC_Plan_P6_ActID_Pulling = dbo.tblActIDS.ActID LEFT OUTER JOIN
                         dbo.tblActIDS AS tblActIDS_3 ON dbo.tblEleCableList.EC_Plan_P6_ActID_Test = tblActIDS_3.ActID
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'V' 
			AND name = 'vICList'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP VIEW dbo.vICList
END
GO
CREATE VIEW [dbo].[vICList]
AS
SELECT        TOP (100) PERCENT dbo.tblInsCableList.Area, dbo.tblInsCableList.IC_Type AS Type, dbo.tblInsCableList.IC_ID AS Tag, dbo.tblInsCableList.IC_Length AS [Eng Length], 
                         dbo.vCblParProductionTotal_Vendor.[Total Done] AS [Partial Qnty Done], dbo.V_CBLEACTUALlENGTH.Actual_Length AS [Actual Length], dbo.vCblParProductionTotal_Vendor.Percentage, 
                         dbo.vCblParProductionTotal_Vendor.Pro_Date AS [Last Pulling Update], dbo.tblInsCableList.Pulled_con AS [Pulling Validate], dbo.tblInsCableList.IC_Cable_Gland_From AS [Gland From Date], 
                         dbo.tblInsCableList.IC_Cable_Gland_From_con AS [Gland From Validate], dbo.tblInsCableList.IC_Cable_Gland_To AS [Gland To Date], dbo.tblInsCableList.IC_Cable_Gland_To_con AS [Gland To Validate], 
                         dbo.tblInsCableList.IC_Plan_Connected_Date_From AS [Connect From Date], dbo.tblInsCableList.IC_Plan_Connected_Date_From_con AS [Connect From Validate], 
                         dbo.tblInsCableList.IC_Plan_Connected_Date_To AS [Connect To Date], dbo.tblInsCableList.IC_Plan_Connected_Date_To_con AS [Connect To Validate], dbo.tblInsCableList.IC_Megger AS [Test Date], 
                         dbo.tblInsCableList.IC_Megger_con AS [Test Validate], dbo.tblInsCableList.TR_QC_Released AS [Qc Released Date], dbo.tblInsCableList.IC_Description AS Description, dbo.tblInsCableList.IC_From AS [From Location], 
                         dbo.tblInsCableList.From_Description, dbo.tblInsCableList.IC_To AS [To Location], dbo.tblInsCableList.To_Description, dbo.tblInsCableList.Subsystem, dbo.tblInsCableList.PDSModel, dbo.tblInsCableList.Remarks, 
                         dbo.tblInsCableList.TrayReleased, dbo.tblActIDS.SubCon AS [Pulling Subcontractor], tblActIDS_1.SubCon AS [Con 1 Subcontractor], tblActIDS_2.SubCon AS [Con 2 Subcontractor], tblActIDS_3.SubCon AS [Test Subcontractor], 
                         dbo.tblInsCableList.IC_Plan_P6_ActID_Pulling, dbo.tblInsCableList.IC_Plan_P6_ActID_Connect, dbo.tblInsCableList.IC_Plan_P6_ActID_Connect_2, dbo.tblInsCableList.IC_Plan_P6_ActID_Test, dbo.tblInsCableList.Active, 
                         dbo.tblInsCableList.Team, dbo.tblInsCableList.Routing
FROM            dbo.V_CBLEACTUALlENGTH RIGHT OUTER JOIN
                         dbo.tblInsCableList ON dbo.V_CBLEACTUALlENGTH.Tag = dbo.tblInsCableList.IC_ID LEFT OUTER JOIN
                         dbo.tblActIDS AS tblActIDS_3 ON dbo.tblInsCableList.IC_Plan_P6_ActID_Test = tblActIDS_3.ActID LEFT OUTER JOIN
                         dbo.tblActIDS AS tblActIDS_2 ON dbo.tblInsCableList.IC_Plan_P6_ActID_Connect_2 = tblActIDS_2.ActID LEFT OUTER JOIN
                         dbo.tblActIDS ON dbo.tblInsCableList.IC_Plan_P6_ActID_Pulling = dbo.tblActIDS.ActID LEFT OUTER JOIN
                         dbo.tblActIDS AS tblActIDS_1 ON dbo.tblInsCableList.IC_Plan_P6_ActID_Connect = tblActIDS_1.ActID LEFT OUTER JOIN
                         dbo.vCblParProductionTotal_Vendor ON dbo.tblInsCableList.IC_ID = dbo.vCblParProductionTotal_Vendor.Tag
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetEICAItems2'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.GetEICAItems2
END
GO
CREATE PROC [dbo].[GetEICAItems2]
AS

WITH CblETPro AS (
    SELECT [Tag]
        ,SUM([Production_Qnty]) AS Production_Qnty
        ,MAX([Production_Date]) AS Production_Date
    FROM [tblEleCableTrayProduction]
    GROUP BY Tag
), CblITPro AS (
    SELECT [Tag]
        ,SUM([Production_Qnty]) AS Production_Qnty
        ,MAX([Production_Date]) AS Production_Date
    FROM [tblInsCableTrayProduction]
    GROUP BY Tag
), MiscCblePro AS (
    SELECT [Tag]
        ,SUM([Per_Qnty]) AS Production_Qnty
        ,MAX([Pro_Date]) AS Production_Date
    FROM [tblMSCCableProduction]
    GROUP BY Tag
)

SELECT Team, Area,'Electrical Cable' AS Discipline,Type,Tag AS Tag,[Eng Length] AS Scope
,NULL AS Forecast,NULL AS Available,[Last Pulling Update] AS [Pulled/Installed]
,vECList.[Partial Qnty Done] AS [Qnty Done]
,CONVERT(NVARCHAR (50),[Connect FROM Date]) AS [Cable Con 1]
,CONVERT(NVARCHAR (50),[Connect To Date]) AS [Cable Con 2]
,CONVERT(NVARCHAR (50),[Test Date]) AS [Calibrated/Tested]
,'N/A' AS [Hookup]
,'N/A' AS [Hookup Name]
,NULL AS PO
,Subsystem,[Qc Released Date] AS [QC/HCS Released]
,Routing
FROM vECList with (Nolock)
WHERE Active = 1



UNION ALL
SELECT Team, Area,'Instrument Cable' AS Discipline,Type,TAG AS Tag,[Eng Length] AS Scope
,NULL AS Forecast,NULL AS Available,[Last Pulling Update] AS [Pulled/Installed]
,vICList.[Partial Qnty Done] AS [Qnty Done]
,CONVERT(NVARCHAR (50),[Connect FROM Date]) AS [Cable Con 1]
,CONVERT(NVARCHAR (50),[Connect To Date]) AS [Cable Con 2]
,CONVERT(NVARCHAR (50),[Test Date]) AS [Calibrated/Tested]
,'N/A' AS [Hookup]
,'N/A' AS [Hookup Name]
,NULL AS PO
,Subsystem,[Qc Released Date] AS [QC/HCS Released]
,Routing
FROM vICList with (Nolock)
WHERE Active = 1
 

UNION ALL
SELECT Team, Area,'Electrical Equipment' AS Discipline,Type,Tag,0 AS Scope
,ForeCast_Date AS Forecast,CONVERT(NVARCHAR (255),Arrived_Date) AS Available,Installed_Date AS [Pulled/Installed]
,CASE WHEN Installed_Date IS NOT NULL THEN 1 ELSE 0 END AS [Qnty Done]
,'N/A' AS [Cable Con 1]
,'N/A' AS [Cable Con 2]
,'N/A' AS [Calibrated/Tested]
,'N/A' AS [Hookup]
,'N/A' AS [Hookup Name]
,case when PO is null then 'No Mat Info' else po end AS PO
,Subsystem,tblElectricalEquipment.Installed_Date AS [QC/HCS Released]
,NULL AS Routing
FROM tblElectricalEquipment with (Nolock)
WHERE Active = 1


UNION ALL
SELECT Team, Area,'Instrument Equipment' AS Discipline,Type,Tag,0 AS Scope
,ForeCast_Date AS Forecast,CONVERT(NVARCHAR (255),Arrived_Date) AS Available,Installed_Date AS [Pulled/Installed]
,CASE WHEN Installed_Date IS NOT NULL THEN 1 ELSE 0 END AS [Qnty Done]
,'N/A' AS [Cable Con 1]
,'N/A' AS [Cable Con 2]
,'N/A' AS [Calibrated/Tested]
,'N/A' AS [Hookup]
,'N/A' AS [Hookup Name]
,case when PO is null then 'No Mat Info' else po end AS PO
,Subsystem,tblInsEquipment.Installed_Date AS [QC/HCS Released]
,NULL AS Routing
FROM tblInsEquipment with (Nolock)
WHERE Active = 1


UNION ALL
SELECT Team, Area,'Electrical JB' AS Discipline,JE_Type AS Type,Tag,0 AS Scope
,JE_ArriveSiteForeCast AS Forecast,CONVERT(NVARCHAR (255),JE_ArriveSite) AS Available,JE_Installed AS [Pulled/Installed]
,CASE WHEN JE_Installed IS NOT NULL THEN 1 ELSE 0 END AS [Qnty Done]
,'N/A' AS [Cable Con 1]
,'N/A' AS [Cable Con 2]
,'N/A' AS [Calibrated/Tested]
,'N/A' AS [Hookup]
,'N/A' AS [Hookup Name]
,case when PO is null then 'No Mat Info' else po end AS PO
,Subsystem,tblEleJunctionBox.JE_TRQC AS [QC/HCS Released]
,NULL AS Routing
FROM tblEleJunctionBox with (Nolock)
WHERE Active = 1

UNION ALL
SELECT Team, Area,'Instrument JB' AS Discipline,ji_Type AS Type,JunctionBox AS Tag,0 AS Scope
,JI_ArriveForeCast AS Forecast,CONVERT(NVARCHAR (255),ji_ArriveSite) AS Available,ji_Installed AS [Pulled/Installed]
,CASE WHEN ji_Installed IS NOT NULL THEN 1 ELSE 0 END AS [Qnty Done]
,'N/A' AS [Cable Con 1]
,'N/A' AS [Cable Con 2]
,'N/A' AS [Calibrated/Tested]
,'N/A' AS [Hookup]
,'N/A' AS [Hookup Name]
,case when PO is null then 'No Mat Info' else po end AS PO
,Subsystem,JunctionBox.JI_TRQC AS [QC/HCS Released]
,NULL AS Routing
FROM JunctionBox with (Nolock)
WHERE Active = 1

UNION ALL
SELECT Team, Area,'Instruments' AS Discipline
,case when [Furnished_By] is null then 'Instrument' else 'Instrument' + ' ' + [Furnished_By] end AS Type
,instrument_tag AS Tag,0 AS Scope
,[IN_Proc_ArrivalAtSite_Forecasted] AS Forecast,CONVERT(NVARCHAR (255),[Received_Date]) AS Available
,[Installation_Date] AS [Pulled/Installed]
,CASE WHEN [Installation_Date] IS NOT NULL THEN 1 ELSE 0 END AS [Qnty Done]
,'N/A' AS [Cable Con 1]
,'N/A' AS [Cable Con 2]
,case when Calibration_Type='no' then 'N/A'
else CONVERT(NVARCHAR (50),Calibration_Date) end AS [Calibrated/Tested]
,case when hookup_name is null then 'N/A'
else CONVERT(NVARCHAR (50),HookUp_Date) end AS [Hookup]
,hookup_name AS [Hookup Name]
,case when PO is null then 'No Mat Info' else po + ' - ' +  MANUFACTURER end AS PO
,Subsystem,tblInstruments.Final_Installed_Date AS [QC/HCS Released]
,NULL AS Routing
FROM tblInstruments with (Nolock)
WHERE Active = 1

UNION ALL
SELECT Team, Area,'Lighting' AS Discipline,LF_Ref_Desc AS Type,Tag AS Tag,0 AS Scope
,Forecast_Date AS Forecast,CONVERT(NVARCHAR (255),Arrival_Date) AS Available,LF_Installed AS [Pulled/Installed]
,CASE WHEN LF_Installed IS NOT NULL THEN 1 ELSE 0 END AS [Qnty Done]
,'N/A' AS [Cable Con 1]
,'N/A' AS [Cable Con 2]
,'N/A' AS [Calibrated/Tested]
,'N/A' AS [Hookup]
,'N/A' AS [Hookup Name]
,case when PO is null then 'No Mat Info' else po end AS PO
,Subsystem,LF_QC_Date AS [QC/HCS Released]
,NULL AS Routing
FROM tblLightingFixture with (Nolock)
WHERE Active = 1

UNION ALL
SELECT Team, Area,'Misc Items' AS Discipline,[Type_ID] AS Type,Item_Name AS Tag,Item_Scope AS Scope
,NULL AS Forecast,NULL AS Available,[LastUpdateDate] AS [Pulled/Installed]
,v_Items.TotalQnty AS [Qnty Done]
,'N/A' AS [Cable Con 1]
,'N/A' AS [Cable Con 2]
,'N/A' AS [Calibrated/Tested]
,'N/A' AS [Hookup]
,'N/A' AS [Hookup Name]
,NULL AS PO
,NULL,NULL AS [QC/HCS Released]
,NULL AS Routing
FROM v_Items with (Nolock)
WHERE Active = 1

UNION ALL
SELECT tblEleCableTray.Team, tblEleCableTray.Area,'Electrical Tray' AS Discipline, tblEleCableTray.EL_Tray_Type AS Type,tblEleCableTray.Tag AS Tag,tblEleCableTray.EL_Tray_Length AS Scope
,NULL AS Forecast,NULL AS Available,CblETPro.Production_Date AS [Pulled/Installed]
,CASE WHEN CblETPro.Production_Qnty > tblEleCableTray.EL_Tray_Length THEN tblEleCableTray.EL_Tray_Length ELSE CblETPro.Production_Qnty END AS [Qnty Done]
,'N/A' AS [Cable Con 1]
,'N/A' AS [Cable Con 2]
,'N/A' AS [Calibrated/Tested]
,'N/A' AS [Hookup]
,'N/A' AS [Hookup Name]
,NULL AS PO
,NULL,NULL AS [QC/HCS Released]
,NULL AS Routing
FROM tblEleCableTray WITH (NOLOCK)
LEFT JOIN CblETPro ON tblEleCableTray.Tag = CblETPro.Tag
WHERE tblEleCableTray.Active = 1

UNION ALL
SELECT tblInsCableTray.Team, tblInsCableTray.Area,'Instrument Tray' AS Discipline, tblInsCableTray.IN_Tray_Type AS Type,tblInsCableTray.Tag AS Tag,tblInsCableTray.IN_Tray_Length AS Scope
,NULL AS Forecast,NULL AS Available,CblITPro.Production_Date AS [Pulled/Installed]
,CASE WHEN CblITPro.Production_Qnty > tblInsCableTray.IN_Tray_Length THEN tblInsCableTray.IN_Tray_Length ELSE CblITPro.Production_Qnty END AS [Qnty Done]
,'N/A' AS [Cable Con 1]
,'N/A' AS [Cable Con 2]
,'N/A' AS [Calibrated/Tested]
,'N/A' AS [Hookup]
,'N/A' AS [Hookup Name]
,NULL AS PO
,NULL,NULL AS [QC/HCS Released]
,NULL AS Routing
FROM tblInsCableTray WITH (NOLOCK)
LEFT JOIN CblITPro ON tblInsCableTray.Tag = CblITPro.Tag
WHERE tblInsCableTray.Active = 1

UNION ALL
SELECT tblMSCCable.Team, tblMSCCable.Area,'Misc Cable' AS Discipline, tblMSCCable.Type,tblMSCCable.Tag AS Tag,tblMSCCable.Length AS Scope
,NULL AS Forecast,NULL AS Available,MiscCblePro.Production_Date AS [Pulled/Installed]
,CASE WHEN MiscCblePro.Production_Qnty > tblMSCCable.Length THEN tblMSCCable.Length ELSE MiscCblePro.Production_Qnty END AS [Qnty Done]
,'N/A' AS [Cable Con 1]
,'N/A' AS [Cable Con 2]
,'N/A' AS [Calibrated/Tested]
,'N/A' AS [Hookup]
,'N/A' AS [Hookup Name]
,NULL AS PO
,NULL,NULL AS [QC/HCS Released]
,NULL AS Routing
FROM tblMSCCable WITH (NOLOCK)
LEFT JOIN MiscCblePro ON tblMSCCable.Tag = MiscCblePro.Tag
WHERE tblMSCCable.Active = 1
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetLighting'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.GetLighting
END
GO
CREATE PROC [CONSTRUCTION].[GetLighting]
AS
SELECT tblLightingFixture.[TBL_ID] AS Id
      ,[TAG]
      ,[Area]
      ,[LF_Ref_Desc] AS [Type]
      ,[IC_Plan_P6_ActID_Install] As [ActId]
      ,tblActIDS.ActName
      ,tblActIDS.SubCon AS [Act Subcon]
      ,[LF_Dwg] AS [Drawing Number]
      ,[Subsystem]
      ,[Arrival_Date] AS [Received Date]
      ,[LF_Installed] AS [Installed Date]
	  ,reportedBy AS [Reported By]
	  ,PDSModel
      ,tblLightingFixture.[Team]
	  ,CASE WHEN Active = 1 THEN 'Active' ELSE 'DELETED' END AS Status
  FROM [tblLightingFixture] WITH (NOLOCK)
  LEFT JOIN tblActIDS on tblLightingFixture.IC_Plan_P6_ActID_Install = tblActIDS.ActID
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetEquipment'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.GetEquipment
END
GO
CREATE PROC [CONSTRUCTION].[GetEquipment]
AS

SELECT
VALL.Discipline,VALL.[Type],VALL.Subtype,VALL.Area,VALL.Subsystem,VALL.Tag,VALL.[Description],
VALL.ActId,tblActIDS.ActName,tblActIDS.SubCon AS [Act Subcon],
VALL.[Installed Date],VALL.[QC Released Date],VALL.RFINumber,VALL.[Installation Scope],
VALL.PDSModel,VALL.Team,VALL.[Status]

FROM (
    SELECT 
    'Instrumentation' AS Discipline,[JI_Type] AS [Type],NULL AS Subtype,
    [Area],[Subsystem],[JunctionBox] AS Tag
    ,[JI_Description] AS [Description]
    ,[IC_Plan_P6_ActID_Install] AS [ActId]
    ,[JI_Installed] AS [Installed Date]
    ,[JI_TRQC] AS [QC Released Date]
    ,NULL AS RFINumber
    ,[Furnished_By] AS [Installation Scope]
    ,PDSModel
    ,[Team]
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM [JunctionBox] WITH (NOLOCK)

    UNION ALL

    SELECT 
    'Instrumentation' AS Discipline,[Type],Type_Description AS Subtype,
    [Area],[Subsystem],Tag AS Tag
    ,[des] AS [Description]
    ,[IC_Plan_P6_ActID_Install] AS [ActId]
    ,Installed_Date AS [Installed Date]
    ,TR_QC_Released AS [QC Released Date]
    ,NULL AS RFINumber
    ,NULL AS [Installation Scope]
    ,PDSModel
    ,[Team]
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM tblInsEquipment WITH (NOLOCK)

    UNION ALL

    SELECT 
    'Electrical' AS Discipline,[JE_Type] AS [Type],NULL AS Subtype,
    [Area],[Subsystem],Tag AS Tag
    ,JE_Description AS [Description]
    ,[IC_Plan_P6_ActID_Install] AS [ActId]
    ,JE_Installed AS [Installed Date]
    ,JE_TRQC AS [QC Released Date]
    ,NULL AS RFINumber
    ,[Furnished_By] AS [Installation Scope]
    ,PDSModel
    ,[Team]
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM tblEleJunctionBox WITH (NOLOCK)

    UNION ALL

    SELECT 
    'Electrical' AS Discipline,[Type],Type_Description AS Subtype,
    [Area],[Subsystem],Tag AS Tag
    ,[des] AS [Description]
    ,[IC_Plan_P6_ActID_Install] AS [ActId]
    ,Installed_Date AS [Installed Date]
    ,TR_QC_Released AS [QC Released Date]
    ,NULL AS RFINumber
    ,NULL AS [Installation Scope]
    ,PDSModel
    ,[Team]
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM tblElectricalEquipment WITH (NOLOCK)

    UNION ALL

    SELECT 
    Discipline,[Type],Subtype,
    [Area],[Subsystem],Tag
    ,[Description]
    ,[ActId]
    ,InstalledDate AS [Installed Date]
    ,QCDate AS [QC Released Date]
    ,RFINumber
    ,NULL AS [Installation Scope]
    ,PDSModel
    ,[Team]
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM tblEquipment WITH (NOLOCK)
) AS VALL
LEFT JOIN tblActIDS ON VALL.ActId = tblActIDS.ActID
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'ChangeTeam'
			AND schema_id = (select schema_id from sys.schemas where name = 'PLANNING')
			)
BEGIN
	DROP PROC PLANNING.ChangeTeam
END
GO
CREATE PROC [PLANNING].[ChangeTeam]
@Tag NVARCHAR(255),
@Team NVARCHAR(250),
@Discipline NVARCHAR(250)

AS
IF @Discipline = 'EleCable'
    UPDATE tblEleCableList SET Team = @Team WHERE EC_ID = @Tag

IF @Discipline = 'InsCable'
    UPDATE tblInsCableList SET Team = @Team WHERE IC_ID = @Tag

IF @Discipline = 'EleTray'
    UPDATE tblEleCableTray SET Team = @Team WHERE Tag = @Tag

IF @Discipline = 'InsTray'
    UPDATE tblInsCableTray SET Team = @Team WHERE Tag = @Tag

IF @Discipline = 'EleJB'
    UPDATE tblEleJunctionBox SET Team = @Team WHERE Tag = @Tag

IF @Discipline = 'InsJB'
    UPDATE JunctionBox SET Team = @Team WHERE JunctionBox = @Tag

IF @Discipline = 'EleEq'
    UPDATE tblElectricalEquipment SET Team = @Team WHERE Tag = @Tag

IF @Discipline = 'InsEq'
    UPDATE tblInsEquipment SET Team = @Team WHERE Tag = @Tag

IF @Discipline = 'Eq'
    UPDATE tblEquipment SET Team = @Team WHERE Tag = @Tag

IF @Discipline = 'Ins'
    UPDATE tblInstruments SET Team = @Team WHERE Instrument_Tag = @Tag

IF @Discipline = 'Fixture'
    UPDATE tblLightingFixture SET Team = @Team WHERE Tag = @Tag

IF @Discipline = 'MiscItem'
    UPDATE tblItems SET Team = @Team WHERE Item_Name = @Tag

IF @Discipline = 'MiscCable'
    UPDATE tblMSCCable SET Team = @Team WHERE Tag = @Tag

IF @Discipline = 'Equipment'
    UPDATE tblEquipment SET Team = @Team WHERE Tag = @Tag
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetCablesFull'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.GetCablesFull
END
GO
CREATE PROC [CONSTRUCTION].[GetCablesFull]
AS

If(OBJECT_ID('tempdb..#Equipment') Is Not Null)
Begin
    Drop Table #Equipment
End

If(OBJECT_ID('tempdb..#ElePro') Is Not Null)
Begin
    Drop Table #ElePro
End

If(OBJECT_ID('tempdb..#InsPro') Is Not Null)
Begin
    Drop Table #InsPro
End

If(OBJECT_ID('tempdb..#ActId') Is Not Null)
Begin
    Drop Table #ActId
End

DECLARE @cutoff DATE
SELECT @cutoff = tblTMP.tmp_date FROM tblTmp WHERE tblTMP.tmp_id = 1

CREATE TABLE #Equipment (
Discipline NVARCHAR(250) NOT NULL,
Type NVARCHAR(250) NULL,
SubType NVARCHAR(250) NULL,
Area NVARCHAR(250) NULL,
Subsystem NVARCHAR(250) NULL,
Tag NVARCHAR(250) NOT NULL,
Description NVARCHAR(250) NULL,
ActId NVARCHAR(250) NULL,
InstallationDate DATE NULL,
QCReleasedDate DATE NULL,
InstallationScope NVARCHAR(250) NULL,
RFI NVARCHAR(250) NULL,
PDSModel NVARCHAR(250) NULL,
Team NVARCHAR(250) NULL,
Status NVARCHAR(50) NOT NULL
)

CREATE TABLE #ElePro (
Tag NVARCHAR(250) NOT NULL,
TotalPercentage FLOAT NOT NULL DEFAULT 0,
LastUpdated DATE NOT NULL,
Weekly FLOAT NOT NULL DEFAULT 0
)

CREATE TABLE #InsPro (
Tag NVARCHAR(250) NOT NULL,
TotalPercentage FLOAT NOT NULL DEFAULT 0,
LastUpdated DATE NOT NULL,
Weekly FLOAT NOT NULL DEFAULT 0
)

CREATE TABLE #ActId (
[ActID] NVARCHAR(250) NOT NULL,
[ActName] NVARCHAR(250) NULL,
[SubCon] NVARCHAR(250) NULL,
[Family] NVARCHAR(250) NULL,
[EICA_Area] NVARCHAR(250) NULL,
[Team] NVARCHAR(250) NULL,
[StartDate] DATE NULL,
[EndDate] DATE NULL
)

INSERT INTO #ElePro 
SELECT 
      [Tag]
      ,SUM([Per_Qnty]) AS TotalPercentage
      ,MAX([Pro_Date]) AS LastUpdated
      ,SUM(CASE WHEN pro_Date BETWEEN DATEADD(DAY, -6, @cutoff) AND @cutoff THEN Per_Qnty ELSE 0 END) AS Weekly
FROM [tblEleCableProduction] WITH (NOLOCK)
GROUP BY Tag



INSERT INTO #InsPro
SELECT 
      [Tag]
      ,SUM([Per_Qnty]) AS TotalPercentage
      ,MAX([Pro_Date]) AS LastUpdated
      ,SUM(CASE WHEN pro_Date BETWEEN DATEADD(DAY, -6, @cutoff) AND @cutoff THEN Per_Qnty ELSE 0 END) AS Weekly
FROM [tblInsCableProduction] WITH (NOLOCK)
GROUP BY Tag


INSERT INTO #Equipment
EXEC CONSTRUCTION.GetEquipment

INSERT INTO #Equipment
SELECT 
'Instrumentation' AS Discipline,Ins_Type AS [Type],[Furnished_By] AS SubType,Area,[Subsystem]
,Instrument_Tag AS Tag
,[Instrument_Type_Desc] AS [Description]
,[IC_Plan_P6_ActID_Install] AS [ActId]
,Installation_Date AS [Installed Date]
,Final_Installed_Date AS [QC Released Date]
,RFINumberInstallation AS RFI
,NULL AS [Installation Scope]
,PDSModel
,[Team]
,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
FROM tblInstruments WITH (NOLOCK)

INSERT INTO #ActId
SELECT [ActID],[ActName],[SubCon],[Family],[EICA_Area],[Team],[StartDate],[EndDate] FROM [tblActIDS] WITH (NOLOCK)

SELECT DISTINCT
EC.Discipline,EC.[Area],[EC_Type] AS [Type],[EC_ID] AS Tag,[EC_Length] AS [Length],[EC_Description] AS [Description],Routing
,EC.[SubSystem]
,[EC_From] AS [From],[From_Description] AS [From Description], EqFrom.Area AS [Eq From Area], EqFrom.PDSModel AS [Eq From PDSModel], EqFrom.Team AS [Eq From Team], EqFrom.[Status] AS [Eq From Status]
,[EC_To] AS [To],[To_Description] AS [To Description], EqTo.Area AS [Eq To Area], EqTo.PDSModel AS [Eq To PDSModel], EqTo.Team AS [Eq To Team], EqTo.[Status] AS [Eq To Status]
,Drawing

,[EC_Plan_P6_ActID_Pulling] AS [Pulling ActId], PullAct.ActName AS [Pulling ActName],PullAct.EICA_Area AS [Pulling Act Area],PullAct.Family AS [Pulling Act Family],PullAct.SubCon AS [Pulling Act Subcon],PullAct.Team AS [Pulling Act Team],PullAct.StartDate AS [Pulling Act StartDate],PullAct.EndDate AS [Pulling Act EndDate]
,[EC_Plan_P6_ActID_Connect] AS [Con From ActId], ConFromAct.ActName AS [ConFrom ActName],ConFromAct.EICA_Area AS [ConFrom Act Area],ConFromAct.Family AS [ConFrom Act Family],ConFromAct.SubCon AS [ConFrom Act Subcon],ConFromAct.Team AS [ConFrom Act Team],ConFromAct.StartDate AS [ConFrom Act StartDate],ConFromAct.EndDate AS [ConFrom Act EndDate]
,[EC_Plan_P6_ActID_Connect_2] AS [Con To ActId], ConToAct.ActName AS [ConTo ActName],ConToAct.EICA_Area AS [ConTo Act Area],ConToAct.Family AS [ConTo Act Family],ConToAct.SubCon AS [ConTo Act Subcon],ConToAct.Team AS [ConTo Act Team],ConToAct.StartDate AS [ConTo Act StartDate],ConToAct.EndDate AS [ConTo Act EndDate]
,[EC_Plan_P6_ActID_Test] AS [Test ActId]

,PullingWorkfront AS [Pulling Workfront]
,#ElePro.TotalPercentage * EC.EC_Length / 100 AS [Pulled Lm]
,#ElePro.LastUpdated [Pulled Date]
,#ElePro.TotalPercentage
,#ElePro.Weekly * EC.EC_Length / 100 AS [Weekly Pulled Lm]

,GlandFromWorkfront AS [Gland From Workfront]
,EC_Cable_Gland_From AS [Gland From Date]

,GlandToWorkfront AS [Gland To Workfront]
,EC_Cable_Gland_To AS [Gland To Date]

,ConnFromWorkfront AS [Conn From Workfront]
,[EC_Plan_Connected_Date_From] AS [Con From Date]

,ConnToWorkfront AS [Conn To Workfront]
,[EC_Plan_Connected_Date_To] AS [Con To Date]

,[EC_Megger] AS [Test Date]
,[TR_QC_Released] AS [QC Released Date]
,RFINumber
,EC.PDSModel
,[Remarks]
,EC.[Team]
,CASE WHEN Active = 1 THEN 'Active' ELSE 'DELETED' END AS Status
FROM [tblEleCableList] AS EC WITH (NOLOCK)
LEFT JOIN #ElePro ON EC.EC_ID = #ElePro.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #Equipment AS EqFrom ON EC.EC_From = EqFrom.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #Equipment AS EqTo ON EC.EC_To = EqTo.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS PullAct ON EC.EC_Plan_P6_ActID_Pulling = PullAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS ConFromAct ON EC.EC_Plan_P6_ActID_Connect = ConFromAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS ConToAct ON EC.EC_Plan_P6_ActID_Connect_2 = ConToAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS


UNION ALL

SELECT DISTINCT
IC.Discipline,IC.[Area],[IC_Type] AS [Type],[IC_ID] AS Tag,[IC_Length] AS [Length],[IC_Description] AS [Description],Routing
,IC.[SubSystem]
,[IC_From] AS [From],[From_Description] AS [From Description], EqFrom.Area AS [Eq From Area], EqFrom.PDSModel AS [Eq From PDSModel], EqFrom.Team AS [Eq From Team], EqFrom.[Status] AS [Eq From Status]
,[IC_To] AS [To],[To_Description] AS [To Description], EqTo.Area AS [Eq To Area], EqTo.PDSModel AS [Eq To PDSModel], EqTo.Team AS [Eq To Team], EqTo.[Status] AS [Eq To Status]
,Drawing

,[IC_Plan_P6_ActID_Pulling] AS [Pulling ActId], PullAct.ActName AS [Pulling ActName],PullAct.EICA_Area AS [Pulling Act Area],PullAct.Family AS [Pulling Act Family],PullAct.SubCon AS [Pulling Act Subcon],PullAct.Team AS [Pulling Act Team],PullAct.StartDate AS [Pulling Act StartDate],PullAct.EndDate AS [Pulling Act EndDate]
,[IC_Plan_P6_ActID_Connect] AS [Con From ActId], ConFromAct.ActName AS [ConFrom ActName],ConFromAct.EICA_Area AS [ConFrom Act Area],ConFromAct.Family AS [ConFrom Act Family],ConFromAct.SubCon AS [ConFrom Act Subcon],ConFromAct.Team AS [ConFrom Act Team],ConFromAct.StartDate AS [ConFrom Act StartDate],ConFromAct.EndDate AS [ConFrom Act EndDate]
,[IC_Plan_P6_ActID_Connect_2] AS [Con To ActId], ConToAct.ActName AS [ConTo ActName],ConToAct.EICA_Area AS [ConTo Act Area],ConToAct.Family AS [ConTo Act Family],ConToAct.SubCon AS [ConTo Act Subcon],ConToAct.Team AS [ConTo Act Team],ConToAct.StartDate AS [ConTo Act StartDate],ConToAct.EndDate AS [ConTo Act EndDate]
,[IC_Plan_P6_ActID_Test] AS [Test ActId]

,PullingWorkfront AS [Pulling Workfront]
,#InsPro.TotalPercentage * IC.IC_Length / 100 AS [Pulled Lm]
,#InsPro.LastUpdated [Pulled Date]
,#InsPro.TotalPercentage
,#InsPro.Weekly * IC.IC_Length / 100 AS [Weekly Pulled Lm]

,GlandFromWorkfront AS [Gland From Workfront]
,IC_Cable_Gland_From AS [Gland From Date]

,GlandToWorkfront AS [Gland To Workfront]
,IC_Cable_Gland_To AS [Gland To Date]

,ConnFromWorkfront AS [Conn From Workfront]
,[IC_Plan_Connected_Date_From] AS [Con From Date]

,ConnToWorkfront AS [Conn To Workfront]
,[IC_Plan_Connected_Date_To] AS [Con To Date]

,[IC_Megger] AS [Test Date]
,[TR_QC_Released] AS [QC Released Date]
,RFINumber
,IC.PDSModel
,[Remarks]
,IC.[Team]
,CASE WHEN Active = 1 THEN 'Active' ELSE 'DELETED' END AS Status
FROM [tblInsCableList] AS IC WITH (NOLOCK)
LEFT JOIN #InsPro ON IC.IC_ID = #InsPro.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #Equipment AS EqFrom ON IC.IC_From = EqFrom.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #Equipment AS EqTo ON IC.IC_To = EqTo.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS PullAct ON IC.IC_Plan_P6_ActID_Pulling = PullAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS ConFromAct ON IC.IC_Plan_P6_ActID_Connect = ConFromAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS ConToAct ON IC.IC_Plan_P6_ActID_Connect_2 = ConToAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'ChangeActIds'
			AND schema_id = (select schema_id from sys.schemas where name = 'PLANNING')
			)
BEGIN
	DROP PROC PLANNING.ChangeActIds
END
GO
CREATE PROC [PLANNING].[ChangeActIds]
@Tag NVARCHAR(255),
@ActID NVARCHAR(250),
@Discipline NVARCHAR(250),
@Key NVARCHAR(50)

AS
IF @Discipline = 'EleCable'
    BEGIN
        IF @Key = 'Pulling'
            UPDATE tblEleCableList SET EC_Plan_P6_ActID_Pulling = @ActID WHERE EC_ID = @Tag
        IF @Key = 'Conn1'
            UPDATE tblEleCableList SET EC_Plan_P6_ActID_Connect = @ActID WHERE EC_ID = @Tag
        IF @Key = 'Conn2'
            UPDATE tblEleCableList SET EC_Plan_P6_ActID_Connect_2 = @ActID WHERE EC_ID = @Tag
        IF @Key = 'Test'
            UPDATE tblEleCableList SET EC_Plan_P6_ActID_Test = @ActID WHERE EC_ID = @Tag
    END
IF @Discipline = 'InsCable'
    BEGIN
        IF @Key = 'Pulling'
            UPDATE tblInsCableList SET IC_Plan_P6_ActID_Pulling = @ActID WHERE IC_ID = @Tag
        IF @Key = 'Conn1'
            UPDATE tblInsCableList SET IC_Plan_P6_ActID_Connect = @ActID WHERE IC_ID = @Tag
        IF @Key = 'Conn2'
            UPDATE tblInsCableList SET IC_Plan_P6_ActID_Connect_2 = @ActID WHERE IC_ID = @Tag
        IF @Key = 'Test'
            UPDATE tblInsCableList SET IC_Plan_P6_ActID_Test = @ActID WHERE IC_ID = @Tag
    END
IF @Discipline = 'EleTray'
    BEGIN
        IF @Key = 'Erect'
            UPDATE tblEleCableTray SET IC_Plan_P6_ActID_Install = @ActID WHERE Tag = @Tag
    END
IF @Discipline = 'InsTray'
    BEGIN
        IF @Key = 'Erect'
            UPDATE tblInsCableTray SET IC_Plan_P6_ActID_Install = @ActID WHERE Tag = @Tag
    END
IF @Discipline = 'EleJB'
    BEGIN
        IF @Key = 'Erect'
            UPDATE tblEleJunctionBox SET IC_Plan_P6_ActID_Install = @ActID WHERE Tag = @Tag
    END
IF @Discipline = 'InsJB'
    BEGIN
        IF @Key = 'Erect'
            UPDATE JunctionBox SET IC_Plan_P6_ActID_Install = @ActID WHERE JunctionBox = @Tag
    END
IF @Discipline = 'EleEq'
    BEGIN
        IF @Key = 'Erect'
            UPDATE tblElectricalEquipment SET IC_Plan_P6_ActID_Install = @ActID WHERE Tag = @Tag
    END
IF @Discipline = 'InsEq'
    BEGIN
        IF @Key = 'Erect'
            UPDATE tblInsEquipment SET IC_Plan_P6_ActID_Install = @ActID WHERE Tag = @Tag
    END
IF @Discipline = 'Eq'
    BEGIN
        IF @Key = 'Erect'
            UPDATE tblEquipment SET ActId = @ActID WHERE Tag = @Tag
    END
IF @Discipline = 'Ins'
    BEGIN
        IF @Key = 'Erect'
            UPDATE tblInstruments SET IC_Plan_P6_ActID_Install = @ActID WHERE Instrument_Tag = @Tag
        IF @Key = 'Calib'
            UPDATE tblInstruments SET P6_Precalibration_ActID = @ActID WHERE Instrument_Tag = @Tag
        IF @Key = 'Hook'
            UPDATE tblInstruments SET IC_Plan_P6_ActID_Hookup = @ActID WHERE Instrument_Tag = @Tag
    END
IF @Discipline = 'Fixture'
    BEGIN
        IF @Key = 'Erect'
            UPDATE tblLightingFixture SET IC_Plan_P6_ActID_Install = @ActID WHERE Tag = @Tag
    END
IF @Discipline = 'MiscItem'
    BEGIN
        IF @Key = 'Erect'
            UPDATE tblItems SET Activity_ID = @ActID WHERE Item_Name = @Tag
    END
IF @Discipline = 'MiscCable'
    BEGIN
        IF @Key = 'Pulling'
            UPDATE tblMSCCable SET IC_Plan_P6_ActID_Pulling = @ActID WHERE Tag = @Tag
    END
IF @Discipline = 'Equipment'
    BEGIN
        IF @Key = 'Erect'
            UPDATE tblEquipment SET ActId = @ActID WHERE Tag = @Tag
    END
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'SetInstCalibrated'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.SetInstCalibrated
END
GO
CREATE PROC [CONSTRUCTION].[SetInstCalibrated]
@tag NVARCHAR(250),
@date DATE = NULL,
@overwrite BIT = 0

AS
IF @overwrite = 0
    UPDATE tblInstruments SET Calibration_Date = @date WHERE Instrument_Tag = @tag AND Calibration_Date IS NULL
ELSE
    UPDATE tblInstruments SET Calibration_Date = @date WHERE Instrument_Tag = @tag
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'SetInstInstalled'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.SetInstInstalled
END
GO
CREATE PROC [CONSTRUCTION].[SetInstInstalled]
@tag NVARCHAR(250),
@date DATE = NULL,
@overwrite BIT = 0

AS

IF @overwrite = 0
    UPDATE tblInstruments SET Installation_Date = @date WHERE Instrument_Tag = @tag AND Installation_Date IS NULL
ELSE
    UPDATE tblInstruments SET Installation_Date = @date WHERE Instrument_Tag = @tag
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'SetInstHookup'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.SetInstHookup
END
GO
CREATE PROC [CONSTRUCTION].[SetInstHookup]
@tag NVARCHAR(250),
@date DATE = NULL,
@overwrite BIT = 0

AS

IF @overwrite = 0
    UPDATE tblInstruments SET HookUp_Date = @date WHERE Instrument_Tag = @tag AND HookUp_Date IS NULL
ELSE
    UPDATE tblInstruments SET HookUp_Date = @date WHERE Instrument_Tag = @tag
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'SetLightingInstalled'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.SetLightingInstalled
END
GO
CREATE PROC [CONSTRUCTION].[SetLightingInstalled]
@id INT,
@date DATE,
@reportedby NVARCHAR(250),
@overwrite BIT = 0

AS

IF @overwrite = 0
    UPDATE [tblLightingFixture] SET LF_Installed = @date, ReportedBy = @reportedby WHERE TBL_ID = @id AND LF_Installed IS NULL
ELSE
    UPDATE [tblLightingFixture] SET LF_Installed = @date, ReportedBy = @reportedby WHERE TBL_ID = @id
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetEquipmentMini'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.GetEquipmentMini
END
GO
CREATE PROC [CONSTRUCTION].[GetEquipmentMini]
AS


    SELECT 
    'Instrumentation' AS Discipline,[JI_Type] AS [Type],NULL AS Subtype,
    [Area],[Subsystem],[JunctionBox] AS Tag
    ,[JI_Description] AS [Description]
    ,[IC_Plan_P6_ActID_Install] AS [ActId]
    ,[JI_Installed] AS [Installed Date]
    ,[JI_TRQC] AS [QC Released Date]
    ,NULL AS RFINumber
    ,[Furnished_By] AS [Installation Scope]
    ,PDSModel
    ,[Team]
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM [JunctionBox] WITH (NOLOCK)

    UNION ALL

    SELECT 
    'Instrumentation' AS Discipline,[Type],Type_Description AS Subtype,
    [Area],[Subsystem],Tag AS Tag
    ,[des] AS [Description]
    ,[IC_Plan_P6_ActID_Install] AS [ActId]
    ,Installed_Date AS [Installed Date]
    ,TR_QC_Released AS [QC Released Date]
    ,NULL AS RFINumber
    ,NULL AS [Installation Scope]
    ,PDSModel
    ,[Team]
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM tblInsEquipment WITH (NOLOCK)

    UNION ALL

    SELECT 
    'Electrical' AS Discipline,[JE_Type] AS [Type],NULL AS Subtype,
    [Area],[Subsystem],Tag AS Tag
    ,JE_Description AS [Description]
    ,[IC_Plan_P6_ActID_Install] AS [ActId]
    ,JE_Installed AS [Installed Date]
    ,JE_TRQC AS [QC Released Date]
    ,NULL AS RFINumber
    ,[Furnished_By] AS [Installation Scope]
    ,PDSModel
    ,[Team]
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM tblEleJunctionBox WITH (NOLOCK)

    UNION ALL

    SELECT 
    'Electrical' AS Discipline,[Type],Type_Description AS Subtype,
    [Area],[Subsystem],Tag AS Tag
    ,[des] AS [Description]
    ,[IC_Plan_P6_ActID_Install] AS [ActId]
    ,Installed_Date AS [Installed Date]
    ,TR_QC_Released AS [QC Released Date]
    ,NULL AS RFINumber
    ,NULL AS [Installation Scope]
    ,PDSModel
    ,[Team]
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM tblElectricalEquipment WITH (NOLOCK)

    UNION ALL

    SELECT 
    Discipline,[Type],Subtype,
    [Area],[Subsystem],Tag
    ,[Description]
    ,[ActId]
    ,InstalledDate AS [Installed Date]
    ,QCDate AS [QC Released Date]
    ,RFINumber
    ,NULL AS [Installation Scope]
    ,PDSModel
    ,[Team]
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM tblEquipment WITH (NOLOCK)

GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetCablesFull'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.GetCablesFull
END
GO
CREATE PROC [CONSTRUCTION].[GetCablesFull]
AS

If(OBJECT_ID('tempdb..#Equipment') Is Not Null)
Begin
    Drop Table #Equipment
End

If(OBJECT_ID('tempdb..#ElePro') Is Not Null)
Begin
    Drop Table #ElePro
End

If(OBJECT_ID('tempdb..#InsPro') Is Not Null)
Begin
    Drop Table #InsPro
End

If(OBJECT_ID('tempdb..#ActId') Is Not Null)
Begin
    Drop Table #ActId
End

DECLARE @cutoff DATE
SELECT @cutoff = tblTMP.tmp_date FROM tblTmp WHERE tblTMP.tmp_id = 1

CREATE TABLE #Equipment (
Discipline NVARCHAR(250) NOT NULL,
Type NVARCHAR(250) NULL,
SubType NVARCHAR(250) NULL,
Area NVARCHAR(250) NULL,
Subsystem NVARCHAR(250) NULL,
Tag NVARCHAR(250) NOT NULL,
Description NVARCHAR(250) NULL,
ActId NVARCHAR(250) NULL,
InstallationDate DATE NULL,
QCReleasedDate DATE NULL,
InstallationScope NVARCHAR(250) NULL,
RFI NVARCHAR(250) NULL,
PDSModel NVARCHAR(250) NULL,
Team NVARCHAR(250) NULL,
Status NVARCHAR(50) NOT NULL
)

CREATE TABLE #ElePro (
Tag NVARCHAR(250) NOT NULL,
TotalPercentage FLOAT NOT NULL DEFAULT 0,
LastUpdated DATE NOT NULL,
Weekly FLOAT NOT NULL DEFAULT 0
)

CREATE TABLE #InsPro (
Tag NVARCHAR(250) NOT NULL,
TotalPercentage FLOAT NOT NULL DEFAULT 0,
LastUpdated DATE NOT NULL,
Weekly FLOAT NOT NULL DEFAULT 0
)

CREATE TABLE #ActId (
[ActID] NVARCHAR(250) NOT NULL,
[ActName] NVARCHAR(250) NULL,
[SubCon] NVARCHAR(250) NULL,
[Family] NVARCHAR(250) NULL,
[EICA_Area] NVARCHAR(250) NULL,
[Team] NVARCHAR(250) NULL,
[StartDate] DATE NULL,
[EndDate] DATE NULL
)

INSERT INTO #ElePro 
SELECT 
      [Tag]
      ,SUM([Per_Qnty]) AS TotalPercentage
      ,MAX([Pro_Date]) AS LastUpdated
      ,SUM(CASE WHEN pro_Date BETWEEN DATEADD(DAY, -6, @cutoff) AND @cutoff THEN Per_Qnty ELSE 0 END) AS Weekly
FROM [tblEleCableProduction] WITH (NOLOCK)
GROUP BY Tag



INSERT INTO #InsPro
SELECT 
      [Tag]
      ,SUM([Per_Qnty]) AS TotalPercentage
      ,MAX([Pro_Date]) AS LastUpdated
      ,SUM(CASE WHEN pro_Date BETWEEN DATEADD(DAY, -6, @cutoff) AND @cutoff THEN Per_Qnty ELSE 0 END) AS Weekly
FROM [tblInsCableProduction] WITH (NOLOCK)
GROUP BY Tag


INSERT INTO #Equipment
EXEC CONSTRUCTION.GetEquipmentMini

INSERT INTO #Equipment
SELECT 
'Instrumentation' AS Discipline,Ins_Type AS [Type],[Furnished_By] AS SubType,Area,[Subsystem]
,Instrument_Tag AS Tag
,[Instrument_Type_Desc] AS [Description]
,[IC_Plan_P6_ActID_Install] AS [ActId]
,Installation_Date AS [Installed Date]
,Final_Installed_Date AS [QC Released Date]
,RFINumberInstallation AS RFI
,NULL AS [Installation Scope]
,PDSModel
,[Team]
,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
FROM tblInstruments WITH (NOLOCK)

INSERT INTO #ActId
SELECT [ActID],[ActName],[SubCon],[Family],[EICA_Area],[Team],[StartDate],[EndDate] FROM [tblActIDS] WITH (NOLOCK)

SELECT DISTINCT
EC.Discipline,EC.[Area],[EC_Type] AS [Type],[EC_ID] AS Tag,[EC_Length] AS [Length],[EC_Description] AS [Description],Routing
,EC.[SubSystem]
,[EC_From] AS [From],[From_Description] AS [From Description], EqFrom.Area AS [Eq From Area], EqFrom.PDSModel AS [Eq From PDSModel], EqFrom.Team AS [Eq From Team], EqFrom.[Status] AS [Eq From Status]
,[EC_To] AS [To],[To_Description] AS [To Description], EqTo.Area AS [Eq To Area], EqTo.PDSModel AS [Eq To PDSModel], EqTo.Team AS [Eq To Team], EqTo.[Status] AS [Eq To Status]
,Drawing

,[EC_Plan_P6_ActID_Pulling] AS [Pulling ActId], PullAct.ActName AS [Pulling ActName],PullAct.EICA_Area AS [Pulling Act Area],PullAct.Family AS [Pulling Act Family],PullAct.SubCon AS [Pulling Act Subcon],PullAct.Team AS [Pulling Act Team],PullAct.StartDate AS [Pulling Act StartDate],PullAct.EndDate AS [Pulling Act EndDate]
,[EC_Plan_P6_ActID_Connect] AS [Con From ActId], ConFromAct.ActName AS [ConFrom ActName],ConFromAct.EICA_Area AS [ConFrom Act Area],ConFromAct.Family AS [ConFrom Act Family],ConFromAct.SubCon AS [ConFrom Act Subcon],ConFromAct.Team AS [ConFrom Act Team],ConFromAct.StartDate AS [ConFrom Act StartDate],ConFromAct.EndDate AS [ConFrom Act EndDate]
,[EC_Plan_P6_ActID_Connect_2] AS [Con To ActId], ConToAct.ActName AS [ConTo ActName],ConToAct.EICA_Area AS [ConTo Act Area],ConToAct.Family AS [ConTo Act Family],ConToAct.SubCon AS [ConTo Act Subcon],ConToAct.Team AS [ConTo Act Team],ConToAct.StartDate AS [ConTo Act StartDate],ConToAct.EndDate AS [ConTo Act EndDate]
,[EC_Plan_P6_ActID_Test] AS [Test ActId]

,PullingWorkfront AS [Pulling Workfront]
,#ElePro.TotalPercentage * EC.EC_Length / 100 AS [Pulled Lm]
,#ElePro.LastUpdated [Pulled Date]
,#ElePro.TotalPercentage
,#ElePro.Weekly * EC.EC_Length / 100 AS [Weekly Pulled Lm]

,GlandFromWorkfront AS [Gland From Workfront]
,EC_Cable_Gland_From AS [Gland From Date]

,GlandToWorkfront AS [Gland To Workfront]
,EC_Cable_Gland_To AS [Gland To Date]

,ConnFromWorkfront AS [Conn From Workfront]
,[EC_Plan_Connected_Date_From] AS [Con From Date]

,ConnToWorkfront AS [Conn To Workfront]
,[EC_Plan_Connected_Date_To] AS [Con To Date]

,[EC_Megger] AS [Test Date]
,[TR_QC_Released] AS [QC Released Date]
,RFINumber
,EC.PDSModel
,[Remarks]
,EC.[Team]
,CASE WHEN Active = 1 THEN 'Active' ELSE 'DELETED' END AS Status
FROM [tblEleCableList] AS EC WITH (NOLOCK)
LEFT JOIN #ElePro ON EC.EC_ID = #ElePro.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #Equipment AS EqFrom ON EC.EC_From = EqFrom.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #Equipment AS EqTo ON EC.EC_To = EqTo.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS PullAct ON EC.EC_Plan_P6_ActID_Pulling = PullAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS ConFromAct ON EC.EC_Plan_P6_ActID_Connect = ConFromAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS ConToAct ON EC.EC_Plan_P6_ActID_Connect_2 = ConToAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS


UNION ALL

SELECT DISTINCT
IC.Discipline,IC.[Area],[IC_Type] AS [Type],[IC_ID] AS Tag,[IC_Length] AS [Length],[IC_Description] AS [Description],Routing
,IC.[SubSystem]
,[IC_From] AS [From],[From_Description] AS [From Description], EqFrom.Area AS [Eq From Area], EqFrom.PDSModel AS [Eq From PDSModel], EqFrom.Team AS [Eq From Team], EqFrom.[Status] AS [Eq From Status]
,[IC_To] AS [To],[To_Description] AS [To Description], EqTo.Area AS [Eq To Area], EqTo.PDSModel AS [Eq To PDSModel], EqTo.Team AS [Eq To Team], EqTo.[Status] AS [Eq To Status]
,Drawing

,[IC_Plan_P6_ActID_Pulling] AS [Pulling ActId], PullAct.ActName AS [Pulling ActName],PullAct.EICA_Area AS [Pulling Act Area],PullAct.Family AS [Pulling Act Family],PullAct.SubCon AS [Pulling Act Subcon],PullAct.Team AS [Pulling Act Team],PullAct.StartDate AS [Pulling Act StartDate],PullAct.EndDate AS [Pulling Act EndDate]
,[IC_Plan_P6_ActID_Connect] AS [Con From ActId], ConFromAct.ActName AS [ConFrom ActName],ConFromAct.EICA_Area AS [ConFrom Act Area],ConFromAct.Family AS [ConFrom Act Family],ConFromAct.SubCon AS [ConFrom Act Subcon],ConFromAct.Team AS [ConFrom Act Team],ConFromAct.StartDate AS [ConFrom Act StartDate],ConFromAct.EndDate AS [ConFrom Act EndDate]
,[IC_Plan_P6_ActID_Connect_2] AS [Con To ActId], ConToAct.ActName AS [ConTo ActName],ConToAct.EICA_Area AS [ConTo Act Area],ConToAct.Family AS [ConTo Act Family],ConToAct.SubCon AS [ConTo Act Subcon],ConToAct.Team AS [ConTo Act Team],ConToAct.StartDate AS [ConTo Act StartDate],ConToAct.EndDate AS [ConTo Act EndDate]
,[IC_Plan_P6_ActID_Test] AS [Test ActId]

,PullingWorkfront AS [Pulling Workfront]
,#InsPro.TotalPercentage * IC.IC_Length / 100 AS [Pulled Lm]
,#InsPro.LastUpdated [Pulled Date]
,#InsPro.TotalPercentage
,#InsPro.Weekly * IC.IC_Length / 100 AS [Weekly Pulled Lm]

,GlandFromWorkfront AS [Gland From Workfront]
,IC_Cable_Gland_From AS [Gland From Date]

,GlandToWorkfront AS [Gland To Workfront]
,IC_Cable_Gland_To AS [Gland To Date]

,ConnFromWorkfront AS [Conn From Workfront]
,[IC_Plan_Connected_Date_From] AS [Con From Date]

,ConnToWorkfront AS [Conn To Workfront]
,[IC_Plan_Connected_Date_To] AS [Con To Date]

,[IC_Megger] AS [Test Date]
,[TR_QC_Released] AS [QC Released Date]
,RFINumber
,IC.PDSModel
,[Remarks]
,IC.[Team]
,CASE WHEN Active = 1 THEN 'Active' ELSE 'DELETED' END AS Status
FROM [tblInsCableList] AS IC WITH (NOLOCK)
LEFT JOIN #InsPro ON IC.IC_ID = #InsPro.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #Equipment AS EqFrom ON IC.IC_From = EqFrom.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #Equipment AS EqTo ON IC.IC_To = EqTo.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS PullAct ON IC.IC_Plan_P6_ActID_Pulling = PullAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS ConFromAct ON IC.IC_Plan_P6_ActID_Connect = ConFromAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS ConToAct ON IC.IC_Plan_P6_ActID_Connect_2 = ConToAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'MoveICEC'
			AND schema_id = (select schema_id from sys.schemas where name = 'PLANNING')
			)
BEGIN
	DROP PROC PLANNING.MoveICEC
END
GO
CREATE PROC [PLANNING].[MoveICEC]
-- Move Ele Cable To Instrument
@Tag NVARCHAR(250),
@ActIdPulling NVARCHAR(250),
@ActIdConFrom NVARCHAR(250),
@ActIdConTo NVARCHAR(250),
@ActIdTest NVARCHAR(250),
@Type NVARCHAR(250)

AS


BEGIN TRY
    BEGIN TRANSACTION

        -- Check if cable exists
		DECLARE @ecId INT

		SELECT @ecId = tblEleCableList.TBL_ID FROM tblEleCableList WHERE EC_ID = @Tag
		IF @ecId IS NULL
			BEGIN
				-- Delete Production from ins cable production
				DELETE FROM tblEleCableProduction WHERE Tag = @Tag

				--Copy Cable To Ele Cable List
				INSERT INTO tblEleCableList (EC_ID, EC_Type, EC_Description, EC_Length, EC_Load, EC_Kw, EC_From, EC_To, EC_Status, EC_Plan_P6_ActID_Pulling, EC_Plan_P6_ActID_Connect, EC_Plan_P6_ActID_Connect_2, EC_Plan_P6_ActID_Test, Area,
				Subsystem, PDSModel, Gland_1_Name, Gland_2_Name, EC_Cable_Gland_From, EC_Cable_Gland_To, EC_Plan_Connected_Date_From, EC_Plan_Connected_Date_To, Remarks, Active, TrayReleased, 
				TR_QC_Released, EC_Cable_Gland_From_con, EC_Cable_Gland_To_con, EC_Plan_Connected_Date_From_con, EC_Plan_Connected_Date_To_con, Pulled_con, To_Description, Forecast_Length, cable_mark_2_from,
				cable_mark_2_to, EC_rev, Routing, Drawing, PullingWorkfront, GlandFromWorkfront, GlandToWorkfront, ConnFromWorkfront, ConnToWorkfront, Team)

				SELECT
				IC_ID, @Type, IC_Description, IC_Length, IC_Load, IC_Kw, IC_From, IC_To, IC_Status, @ActIdPulling, @ActIdConFrom, @ActIdConTo, @ActIdTest, Area,
				Subsystem, PDSModel, Gland_Name_1, Gland_Name_2, IC_Cable_Gland_From, IC_Cable_Gland_To, IC_Plan_Connected_Date_From, IC_Plan_Connected_Date_To, Remarks, Active, TrayReleased, 
				TR_QC_Released, IC_Cable_Gland_From_con, IC_Cable_Gland_To_con, IC_Plan_Connected_Date_From_con, IC_Plan_Connected_Date_To_con, Pulled_con, To_Description, Forecast_Length, cable_mark_2_from,
				cable_mark_2_to, IC_rev, Routing, Drawing, PullingWorkfront, GlandFromWorkfront, GlandToWorkfront, ConnFromWorkfront, ConnToWorkfront, Team
				FROM tblInsCableList WHERE IC_ID = @Tag

				--Copy Production
				INSERT INTO tblEleCableProduction (Tag, Per_Qnty, Pro_Date, ActualSubcontractor, ActualDrum, cable_mark_1_from, cable_mark_1_to, Validated)
				
				SELECT Tag, Per_Qnty, Pro_Date, ActualSubcontractor, ActualDrum, cable_mark_1_from, cable_mark_1_to, Validated FROM tblInsCableProduction WHERE Tag = @Tag

				--Delete Original Production
				DELETE FROM tblInsCableProduction WHERE Tag = @Tag

				--Delete original canble
				DELETE FROM tblInsCableList WHERE IC_ID = @Tag

			END
		ELSE
			BEGIN
				RAISERROR ('This cable already exists in Electrical Cable List', 14, 1);
			END

    COMMIT TRAN -- Transaction Success!
END TRY
BEGIN CATCH
    IF @@TRANCOUNT > 0
        ROLLBACK TRAN --RollBack in case of Error

    DECLARE @ErrorMessage NVARCHAR(4000);  
    DECLARE @ErrorSeverity INT;  
    DECLARE @ErrorState INT;  

    SELECT   
       @ErrorMessage = ERROR_MESSAGE(),  
       @ErrorSeverity = ERROR_SEVERITY(),  
       @ErrorState = ERROR_STATE();  

    RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState);  

END CATCH
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'MoveECIC'
			AND schema_id = (select schema_id from sys.schemas where name = 'PLANNING')
			)
BEGIN
	DROP PROC PLANNING.MoveECIC
END
GO
CREATE PROC [PLANNING].[MoveECIC]
-- Move Ele Cable To Instrument
@Tag NVARCHAR(250),
@ActIdPulling NVARCHAR(250),
@ActIdConFrom NVARCHAR(250),
@ActIdConTo NVARCHAR(250),
@ActIdTest NVARCHAR(250),
@Type NVARCHAR(250)

AS


BEGIN TRY
    BEGIN TRANSACTION

        -- Check if cable exists
		DECLARE @insId INT

		SELECT @insId = tblInsCableList.TBL_ID FROM tblInsCableList WHERE IC_ID = @Tag
		IF @insId IS NULL
			BEGIN
				-- Delete Production from ins cable production
				DELETE FROM tblInsCableProduction WHERE Tag = @Tag

				--Copy Cable To Ins Cable List
				INSERT INTO tblInsCableList (IC_ID, IC_Type, IC_Description, IC_Length, IC_Load, IC_Kw, IC_From, IC_To, IC_Status, IC_Plan_P6_ActID_Pulling, IC_Plan_P6_ActID_Connect, IC_Plan_P6_ActID_Connect_2, IC_Plan_P6_ActID_Test, Area,
				Subsystem, PDSModel, Gland_Name_1, Gland_Name_2, IC_Cable_Gland_From, IC_Cable_Gland_To, IC_Plan_Connected_Date_From, IC_Plan_Connected_Date_To, Remarks, Active, TrayReleased, 
				TR_QC_Released, IC_Cable_Gland_From_con, IC_Cable_Gland_To_con, IC_Plan_Connected_Date_From_con, IC_Plan_Connected_Date_To_con, Pulled_con, To_Description, Forecast_Length, cable_mark_2_from,
				cable_mark_2_to, ic_rev, Routing, Drawing, PullingWorkfront, GlandFromWorkfront, GlandToWorkfront, ConnFromWorkfront, ConnToWorkfront, Team)

				SELECT
				EC_ID, @Type, EC_Description, EC_Length, EC_Load, EC_Kw, EC_From, EC_To, EC_Status, @ActIdPulling, @ActIdConFrom, @ActIdConTo, @ActIdTest, Area,
				Subsystem, PDSModel, Gland_1_Name, Gland_2_Name, EC_Cable_Gland_From, EC_Cable_Gland_To, EC_Plan_Connected_Date_From, EC_Plan_Connected_Date_To, Remarks, Active, TrayReleased, 
				TR_QC_Released, EC_Cable_Gland_From_con, EC_Cable_Gland_To_con, EC_Plan_Connected_Date_From_con, EC_Plan_Connected_Date_To_con, Pulled_con, To_Description, Forecast_Length, cable_mark_2_from,
				cable_mark_2_to, EC_rev, Routing, Drawing, PullingWorkfront, GlandFromWorkfront, GlandToWorkfront, ConnFromWorkfront, ConnToWorkfront, Team
				FROM tblEleCableList WHERE EC_ID = @Tag

				--Copy Production
				INSERT INTO tblInsCableProduction (Tag, Per_Qnty, Pro_Date, ActualSubcontractor, ActualDrum, cable_mark_1_from, cable_mark_1_to, Validated)
				
				SELECT Tag, Per_Qnty, Pro_Date, ActualSubcontractor, ActualDrum, cable_mark_1_from, cable_mark_1_to, Validated FROM tblEleCableProduction WHERE Tag = @Tag

				--Delete Original Production
				DELETE FROM tblEleCableProduction WHERE Tag = @Tag

				--Delete original canble
				DELETE FROM tblEleCableList WHERE EC_ID = @Tag

			END
		ELSE
			BEGIN
				RAISERROR ('This cable already exists in Instrument Cable List', 14, 1);
			END

    COMMIT TRAN -- Transaction Success!
END TRY
BEGIN CATCH
    IF @@TRANCOUNT > 0
        ROLLBACK TRAN --RollBack in case of Error

    DECLARE @ErrorMessage NVARCHAR(4000);  
    DECLARE @ErrorSeverity INT;  
    DECLARE @ErrorState INT;  

    SELECT   
       @ErrorMessage = ERROR_MESSAGE(),  
       @ErrorSeverity = ERROR_SEVERITY(),  
       @ErrorState = ERROR_STATE();  

    RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState);  

END CATCH
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'CreateGlandingActs'
			AND schema_id = (select schema_id from sys.schemas where name = 'PLANNING')
			)
BEGIN
	DROP PROC PLANNING.CreateGlandingActs
END
GO
CREATE PROC PLANNING.CreateGlandingActs
AS
--DELETE Dummy GLANDING ACTIVITIES
DELETE FROM tblActIDS WHERE ActID LIKE '%-GL'

--INSERT DUMMY ACTIVITIES
INSERT INTO tblActIDS (ActID, ActName, PCS_Area, SubCon, PCS_Budget, Family, EICA_Area, EICA_Budget, Package, KeyQnty, wps, ResourceId, ResourceName, [UOM],[Location],[Team],[StartDate],[EndDate])

SELECT
[ActID] + '-GL' AS ActID,
[ActName],[PCS_Area],[SubCon],[PCS_Budget],
REPLACE(REPLACE(REPLACE([Family], 'CO', 'GL'),'FC', 'FG'), 'GC', 'GG') AS Family,
[EICA_Area],[EICA_Budget],[Package],0 AS [KeyQnty],[wps],
REPLACE([ResourceId], 'CO', 'GL') AS ResourceId,
REPLACE([ResourceName], 'Connections', 'Glanding') AS ResourceName,
[UOM],[Location],[Team],[StartDate],[EndDate]
FROM tblActIDS
WHERE Team = 'SITE' AND ActName LIKE '%conn%'
-----
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DailyTrackingResourceAllEle'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.DailyTrackingResourceAllEle
END
GO
CREATE PROC [dbo].[DailyTrackingResourceAllEle]

AS

 

declare @col as nvarchar(max)

declare @colSUM as nvarchar(max)

declare @result as nvarchar(max)

declare @startdate as char(10)

declare @enddate as char(10)

declare @startdate0 as date

declare @enddate0 as date

declare @colWeek4 as nvarchar(50)

declare @colWeek3 as nvarchar(50)

declare @colWeek2 as nvarchar(50)

declare @colWeek1 as nvarchar(50)

 

select @enddate0 =  [tmp_date] from [tblTMP] where [tmp_id]=1--convert(char(10),cast(getdate() as smalldatetime),111)

select @startdate0 = dateadd(d,-6,@enddate0) --'04/11/2015'

set @enddate =  convert(char(10),cast(@enddate0 as smalldatetime),111)

set @startdate = convert(char(10),cast(@startdate0 as smalldatetime),111)

 

select @colWeek4 = '[' + FORMAT(DATEADD(DAY, -28, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -28, @enddate0), 'MMM') + ']'

select @colWeek3 = '[' + FORMAT(DATEADD(DAY, -21, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -21, @enddate0), 'MMM') + ']'

select @colWeek2 = '[' + FORMAT(DATEADD(DAY, -14, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -14, @enddate0), 'MMM') + ']'

select @colWeek1 = '[' + FORMAT(DATEADD(DAY, -7, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -7, @enddate0), 'MMM') + ']'

 

select @col = STUFF((select distinct ',' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

select @colSUM =  STUFF((select distinct ',' + 'SUM(' + quotename(x.Date) + ') as ' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

 

set @result = '

 

SELECT

 

ResBudget.PCSBudget AS Scope

,CASE WHEN (ResBudget.PCSBudget - vInfo.Done) IS NULL THEN ResBudget.PCSBudget ELSE ResBudget.PCSBudget - vInfo.Done END AS Pending

,CASE WHEN ResBudget.PCSBudget = 0 THEN 0 ELSE CONVERT(FLOAT,vInfo.Done) / CONVERT(FLOAT,ResBudget.PCSBudget) END AS [% PROG]

,vInfo.*

 

FROM (

select

ACTIVITIES.SubCon,ACTIVITIES.ResourceId

,CASE WHEN ACTIVITIES.[Location] = NULL THEN ACTIVITIES.ResourceName

                WHEN ACTIVITIES.[Location] = ''UNDEFINED'' THEN ACTIVITIES.ResourceName

                ELSE ACTIVITIES.ResourceName + '' - '' + REPLACE(ACTIVITIES.[Location], ''UNDEFINED'', '''')

                END AS ResourceName

 

,ACTIVITIES.UOM

,ACTIVITIES.Location

 

,sum(x2.Cummulative) as Done

,sum(x2.Weekly) as Weekly

 

,sum(x2.Cummulative) - sum(x2.Weekly) AS ' + 'CummWeek1' + '

,sum(x2.Cummulative) - sum(x2.Weekly) - sum(x2.[Last 1 Weekly]) AS ' + 'CummWeek2' + '

 

,(sum(x2.[Last 1 Weekly]) + sum(x2.[Last 2 Weekly])) / 2 AS Trend

 

,sum(x2.[Last 1 Weekly]) as ' + @colWeek1 + '

,sum(x2.[Last 2 Weekly]) as ' + @colWeek2 + '

,sum(x2.[Last 3 Weekly]) as ' + @colWeek3 + '

,sum(x2.[Last 4 Weekly]) as ' + @colWeek4 + '

 

 

,'+ @colSUM +'

 

 

 

FROM

(

select Type,ActID

,CASE WHEN [Activity Name] =''Electrical Cable Connection 01'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Electrical Cable Connection 02'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Instrument Cable Connection 01 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 01 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

ELSE

[Activity Name]

END AS [EICA Activity]

,Scope

,case when Cummulative is null then 0 else Cummulative end as Cummulative

,CASE WHEN [Last 4 Weekly] IS NULL THEN 0 ELSE [Last 4 Weekly] END AS [Last 4 Weekly]

,CASE WHEN [Last 3 Weekly] IS NULL THEN 0 ELSE [Last 3 Weekly] END AS [Last 3 Weekly]

,CASE WHEN [Last 2 Weekly] IS NULL THEN 0 ELSE [Last 2 Weekly] END AS [Last 2 Weekly]

,CASE WHEN [Last 1 Weekly] IS NULL THEN 0 ELSE [Last 1 Weekly] END AS [Last 1 Weekly]

,CASE WHEN Weekly IS NULL THEN 0 ELSE WEEKLY END AS Weekly

,'+ @col +' FROM

 

--******************************************************************

(---Electrical Cable Pulling            

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[EC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] is not null

group by EC_TYPE,[EC_Plan_Pulled_Date],EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([EC_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

tblEleCableList

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

--******************************************************************

---Instrument Cable Pulling         

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([IC_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblInsCableList

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

---Electrical Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] is not null

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Electrical Cable Tray

select convert(char(10),cast([EL_Tray_Installed_date] as smalldatetime),111) as Daily,

''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

where [Production_Date] is not null

) as vETrayPro

where active=1

group by EL_Tray_Type,[EL_Tray_Installed_date],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by EL_Tray_Type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([EL_Tray_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblEleCableTray

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---Instrument Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrument Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Cummulative'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 1 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 2 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 3 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 4 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Scope'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,(count([iC_id]))*2 as ''Gland'',''Instrumentation'' as [Type],''Each'' as [Unit]

,IC_Plan_P6_ActID_Connect as ActID

FROM tblInsCableList

Where active = 1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

--**********************************************************************************

UNION ALL

---JB Installtion

select convert(char(10),cast([JI_Installed] as smalldatetime),111) as daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JI_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JI_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Instrument Installation - Stand Alone/Field

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Installation - In Line

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Hook Ups

select convert(char(10),cast(HookUp_Date as smalldatetime),111) as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup,hookup_date

UNION ALL

select ''Cummulative'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Scope'' as Daily,

''Hook Ups'' as [Activity Name]

,count([Instrument_Tag]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

--*********************************************************

UNION ALL

---Calibration

select convert(char(10),cast(Calibration_Date as smalldatetime),111) as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID,Calibration_Date

UNION ALL

select ''Cummulative'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Scope'' as Daily,

''Calibration'' as [Activity Name]

,count([Instrument_Tag]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID

--*********************************************************

UNION ALL

---Lighting Fixtures

select convert(char(10),cast(LF_Installed as smalldatetime),111) as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed is not null

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([TAG]) as ''Fixture Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

group by lf_ref_desc,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instruments Equipment

select convert(char(10),cast(Installed_Date as smalldatetime),111) as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date is not null

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([tag]) as ''Scope'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where active=1

group by type,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Electrical Equipment

select convert(char(10),cast(Installed_Date as smalldatetime),111) as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment WHERE active=1

and Installed_Date is not null

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Des,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count(Tag) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

group by Des,IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Electrical JB

select convert(char(10),cast(JE_Installed as smalldatetime),111) as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed is not null

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count(TAG) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Cable Tray

select convert(char(10),cast([IN_Tray_Installed] as smalldatetime),111) as Daily,

''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] is not null

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

AND Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([IN_Tray_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblINSCableTray

where active=1

AND tblInsCableTray.IN_Tray_Type <>''F&G''

group by [IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---MSC Cable Pulling

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] is not null

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Cummulative'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 1 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 2 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 3 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 4 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Scope'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Length]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblMSCCable

where active=1

group by IC_Plan_P6_ActID_Pulling,type

--******************************************************************

UNION ALL

---Loop

select convert(char(10),cast(L_Done as smalldatetime),111) as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by L_Done,ACTIVITYID

UNION ALL

select ''Cummulative'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by ACTIVITYID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by L_Done,ACTIVITYID

UNION ALL

select ''Scope'' as Daily,

''Loop'' as [Activity Name]

,count(loopname) as ''Scope'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by ACTIVITYID

--*********************************************************

UNION ALL
---Electrical Cable Glanding 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Glanding 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] is not null

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,count([IC_id]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID

FROM tblInsCableList

where active=1

group by [IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] is not null

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,count([IC_id]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID

FROM tblInsCableList

where active=1

group by [IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

--******************************************************************

) as X

 

PIVOT

(sum (Pulled) for Daily in ('+ @col +',Scope,[Cummulative],[Last 1 Weekly],[Last 2 Weekly],[Last 3 Weekly],[Last 4 Weekly],weekly)

)as X1

) as X2

RIGHT JOIN tblActIDS AS ACTIVITIES ON X2.ActID = ACTIVITIES.ActID

WHERE ACTIVITIES.ResourceId IS NOT NULL AND ResourceId LIKE ''%EL%''

group by ACTIVITIES.SubCon,ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM,ACTIVITIES.[Location]

) AS vInfo

INNER JOIN (

SELECT

ResourceId,ResourceName,Subcon,[Location]

,SUM(PCS_Budget) AS PCSBudget

FROM tblActIDS

GROUP BY ResourceId,ResourceName,Subcon,[Location]

) AS ResBudget

ON vInfo.ResourceId = ResBudget.ResourceId AND vInfo.subcon = ResBudget.Subcon

                AND (CASE WHEN vInfo.[Location] IS NULL THEN ''UNDEFINED'' ELSE vInfo.[Location] END) = (CASE WHEN ResBudget.[Location] IS NULL THEN ''UNDEFINED'' ELSE ResBudget.[Location] END)

' 

execute(@result)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DailyTrackingResourceAllSubCIns'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.DailyTrackingResourceAllSubCIns
END
GO
CREATE PROC [dbo].[DailyTrackingResourceAllSubCIns]
AS

 

declare @col as nvarchar(max)

declare @colSUM as nvarchar(max)

declare @result as nvarchar(max)

declare @startdate as char(10)

declare @enddate as char(10)

declare @startdate0 as date

declare @enddate0 as date

declare @colWeek4 as nvarchar(50)

declare @colWeek3 as nvarchar(50)

declare @colWeek2 as nvarchar(50)

declare @colWeek1 as nvarchar(50)

 

select @enddate0 =  [tmp_date] from [tblTMP] where [tmp_id]=1--convert(char(10),cast(getdate() as smalldatetime),111)

select @startdate0 = dateadd(d,-6,@enddate0) --'04/11/2015'

set @enddate =  convert(char(10),cast(@enddate0 as smalldatetime),111)

set @startdate = convert(char(10),cast(@startdate0 as smalldatetime),111)

 

select @colWeek4 = '[' + FORMAT(DATEADD(DAY, -28, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -28, @enddate0), 'MMM') + ']'

select @colWeek3 = '[' + FORMAT(DATEADD(DAY, -21, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -21, @enddate0), 'MMM') + ']'

select @colWeek2 = '[' + FORMAT(DATEADD(DAY, -14, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -14, @enddate0), 'MMM') + ']'

select @colWeek1 = '[' + FORMAT(DATEADD(DAY, -7, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -7, @enddate0), 'MMM') + ']'

 

select @col = STUFF((select distinct ',' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

select @colSUM =  STUFF((select distinct ',' + 'SUM(' + quotename(x.Date) + ') as ' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

 

set @result = '

 

SELECT

 

ResBudget.PCSBudget AS Scope

,CASE WHEN (ResBudget.PCSBudget - vInfo.Done) IS NULL THEN ResBudget.PCSBudget ELSE ResBudget.PCSBudget - vInfo.Done END AS Pending

,CASE WHEN ResBudget.PCSBudget = 0 THEN 0 ELSE CONVERT(FLOAT,vInfo.Done) / CONVERT(FLOAT,ResBudget.PCSBudget) END AS [% PROG]

,vInfo.*

 

FROM (

select

ACTIVITIES.ResourceId

,CASE WHEN ACTIVITIES.[Location] = NULL THEN ACTIVITIES.ResourceName

                WHEN ACTIVITIES.[Location] = ''UNDEFINED'' THEN ACTIVITIES.ResourceName

                ELSE ACTIVITIES.ResourceName + '' - '' + REPLACE(ACTIVITIES.[Location], ''UNDEFINED'', '''')

                END AS ResourceName

 

,ACTIVITIES.UOM

,ACTIVITIES.Location

 

,sum(x2.Cummulative) as Done

,sum(x2.Weekly) as Weekly

 

,sum(x2.Cummulative) - sum(x2.Weekly) AS ' + 'CummWeek1' + '

,sum(x2.Cummulative) - sum(x2.Weekly) - sum(x2.[Last 1 Weekly]) AS ' + 'CummWeek2' + '

 

,(sum(x2.[Last 1 Weekly]) + sum(x2.[Last 2 Weekly])) / 2 AS Trend

 

,sum(x2.[Last 1 Weekly]) as ' + @colWeek1 + '

,sum(x2.[Last 2 Weekly]) as ' + @colWeek2 + '

,sum(x2.[Last 3 Weekly]) as ' + @colWeek3 + '

,sum(x2.[Last 4 Weekly]) as ' + @colWeek4 + '

 

 

,'+ @colSUM +'

 

 

FROM

(

select Type,ActID

,CASE WHEN [Activity Name] =''Electrical Cable Connection 01'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Electrical Cable Connection 02'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Instrument Cable Connection 01 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 01 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

ELSE

[Activity Name]

END AS [EICA Activity]

,Scope

,case when Cummulative is null then 0 else Cummulative end as Cummulative

,CASE WHEN [Last 4 Weekly] IS NULL THEN 0 ELSE [Last 4 Weekly] END AS [Last 4 Weekly]

,CASE WHEN [Last 3 Weekly] IS NULL THEN 0 ELSE [Last 3 Weekly] END AS [Last 3 Weekly]

,CASE WHEN [Last 2 Weekly] IS NULL THEN 0 ELSE [Last 2 Weekly] END AS [Last 2 Weekly]

,CASE WHEN [Last 1 Weekly] IS NULL THEN 0 ELSE [Last 1 Weekly] END AS [Last 1 Weekly]

,CASE WHEN Weekly IS NULL THEN 0 ELSE WEEKLY END AS Weekly

,'+ @col +' FROM

 

--******************************************************************

(---Electrical Cable Pulling            

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[EC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] is not null

group by EC_TYPE,[EC_Plan_Pulled_Date],EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([EC_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

tblEleCableList

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

--******************************************************************

---Instrument Cable Pulling         

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([IC_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblInsCableList

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

---Electrical Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] is not null

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Electrical Cable Tray

select convert(char(10),cast([EL_Tray_Installed_date] as smalldatetime),111) as Daily,

''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

where [Production_Date] is not null

) as vETrayPro

where active=1

group by EL_Tray_Type,[EL_Tray_Installed_date],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by EL_Tray_Type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([EL_Tray_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblEleCableTray

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---Instrument Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrument Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Cummulative'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 1 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 2 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 3 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 4 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Scope'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,(count([iC_id]))*2 as ''Gland'',''Instrumentation'' as [Type],''Each'' as [Unit]

,IC_Plan_P6_ActID_Connect as ActID

FROM tblInsCableList

Where active = 1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

--**********************************************************************************

UNION ALL

---JB Installtion

select convert(char(10),cast([JI_Installed] as smalldatetime),111) as daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JI_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JI_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Instrument Installation - Stand Alone/Field

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Installation - In Line

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Hook Ups

select convert(char(10),cast(HookUp_Date as smalldatetime),111) as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup,hookup_date

UNION ALL

select ''Cummulative'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Scope'' as Daily,

''Hook Ups'' as [Activity Name]

,count([Instrument_Tag]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

--*********************************************************

UNION ALL

---Calibration

select convert(char(10),cast(Calibration_Date as smalldatetime),111) as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID,Calibration_Date

UNION ALL

select ''Cummulative'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Scope'' as Daily,

''Calibration'' as [Activity Name]

,count([Instrument_Tag]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID

--*********************************************************

UNION ALL

---Lighting Fixtures

select convert(char(10),cast(LF_Installed as smalldatetime),111) as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed is not null

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([TAG]) as ''Fixture Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

group by lf_ref_desc,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instruments Equipment

select convert(char(10),cast(Installed_Date as smalldatetime),111) as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date is not null

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([tag]) as ''Scope'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where active=1

group by type,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Electrical Equipment

select convert(char(10),cast(Installed_Date as smalldatetime),111) as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment WHERE active=1

and Installed_Date is not null

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Des,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count(Tag) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

group by Des,IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Electrical JB

select convert(char(10),cast(JE_Installed as smalldatetime),111) as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed is not null

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count(TAG) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Cable Tray

select convert(char(10),cast([IN_Tray_Installed] as smalldatetime),111) as Daily,

''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] is not null

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

AND Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([IN_Tray_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblINSCableTray

where active=1

AND tblInsCableTray.IN_Tray_Type <>''F&G''

group by [IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---MSC Cable Pulling

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] is not null

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Cummulative'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 1 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 2 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 3 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 4 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Scope'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Length]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblMSCCable

where active=1

group by IC_Plan_P6_ActID_Pulling,type

--******************************************************************

UNION ALL

---Loop

select convert(char(10),cast(L_Done as smalldatetime),111) as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by L_Done,ACTIVITYID

UNION ALL

select ''Cummulative'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by ACTIVITYID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by L_Done,ACTIVITYID

UNION ALL

select ''Scope'' as Daily,

''Loop'' as [Activity Name]

,count(loopname) as ''Scope'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by ACTIVITYID

--*********************************************************

UNION ALL

---Electrical Cable Glanding 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Glanding 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] is not null

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,count([IC_id]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID

FROM tblInsCableList

where active=1

group by [IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] is not null

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,count([IC_id]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID

FROM tblInsCableList

where active=1

group by [IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

--******************************************************************

) as X

 

PIVOT

(sum (Pulled) for Daily in ('+ @col +',Scope,[Cummulative],[Last 1 Weekly],[Last 2 Weekly],[Last 3 Weekly],[Last 4 Weekly],weekly)

)as X1

) as X2

RIGHT JOIN tblActIDS AS ACTIVITIES ON X2.ActID = ACTIVITIES.ActID

WHERE ACTIVITIES.ResourceId IS NOT NULL AND ResourceId LIKE ''%IN%''

group by ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM,ACTIVITIES.[Location]

) AS vInfo

INNER JOIN (

SELECT

ResourceId,ResourceName,[Location]

,SUM(PCS_Budget) AS PCSBudget

FROM tblActIDS

GROUP BY ResourceId,ResourceName,[Location]

) AS ResBudget

ON vInfo.ResourceId = ResBudget.ResourceId

                AND (CASE WHEN vInfo.[Location] IS NULL THEN ''UNDEFINED'' ELSE vInfo.[Location] END) = (CASE WHEN ResBudget.[Location] IS NULL THEN ''UNDEFINED'' ELSE ResBudget.[Location] END)

' 

execute(@result)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DailyTrackingResourceAllElePackage'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.DailyTrackingResourceAllElePackage
END
GO
CREATE PROC [dbo].[DailyTrackingResourceAllElePackage]

AS

 

declare @col as nvarchar(max)

declare @colSUM as nvarchar(max)

declare @result as nvarchar(max)

declare @startdate as char(10)

declare @enddate as char(10)

declare @startdate0 as date

declare @enddate0 as date

declare @colWeek4 as nvarchar(50)

declare @colWeek3 as nvarchar(50)

declare @colWeek2 as nvarchar(50)

declare @colWeek1 as nvarchar(50)

 

select @enddate0 =  [tmp_date] from [tblTMP] where [tmp_id]=1--convert(char(10),cast(getdate() as smalldatetime),111)

select @startdate0 = dateadd(d,-6,@enddate0) --'04/11/2015'

set @enddate =  convert(char(10),cast(@enddate0 as smalldatetime),111)

set @startdate = convert(char(10),cast(@startdate0 as smalldatetime),111)

 

select @colWeek4 = '[' + FORMAT(DATEADD(DAY, -28, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -28, @enddate0), 'MMM') + ']'

select @colWeek3 = '[' + FORMAT(DATEADD(DAY, -21, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -21, @enddate0), 'MMM') + ']'

select @colWeek2 = '[' + FORMAT(DATEADD(DAY, -14, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -14, @enddate0), 'MMM') + ']'

select @colWeek1 = '[' + FORMAT(DATEADD(DAY, -7, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -7, @enddate0), 'MMM') + ']'

 

select @col = STUFF((select distinct ',' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

select @colSUM =  STUFF((select distinct ',' + 'SUM(' + quotename(x.Date) + ') as ' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

 

set @result = '

 

SELECT

 

ResBudget.PCSBudget AS Scope

,CASE WHEN (ResBudget.PCSBudget - vInfo.Done) IS NULL THEN ResBudget.PCSBudget ELSE ResBudget.PCSBudget - vInfo.Done END AS Pending

,CASE WHEN ResBudget.PCSBudget = 0 THEN 0 ELSE CONVERT(FLOAT,vInfo.Done) / CONVERT(FLOAT,ResBudget.PCSBudget) END AS [% PROG]

,vInfo.*

 

FROM (

select

Package, ACTIVITIES.SubCon,ACTIVITIES.ResourceId

,CASE WHEN ACTIVITIES.[Location] = NULL THEN ACTIVITIES.ResourceName

                WHEN ACTIVITIES.[Location] = ''UNDEFINED'' THEN ACTIVITIES.ResourceName

                ELSE ACTIVITIES.ResourceName + '' - '' + REPLACE(ACTIVITIES.[Location], ''UNDEFINED'', '''')

                END AS ResourceName

 

,ACTIVITIES.UOM

,ACTIVITIES.Location

 

,sum(x2.Cummulative) as Done

,sum(x2.Weekly) as Weekly

 

,sum(x2.Cummulative) - sum(x2.Weekly) AS ' + 'CummWeek1' + '

,sum(x2.Cummulative) - sum(x2.Weekly) - sum(x2.[Last 1 Weekly]) AS ' + 'CummWeek2' + '

 

,(sum(x2.[Last 1 Weekly]) + sum(x2.[Last 2 Weekly])) / 2 AS Trend

 

,sum(x2.[Last 1 Weekly]) as ' + @colWeek1 + '

,sum(x2.[Last 2 Weekly]) as ' + @colWeek2 + '

,sum(x2.[Last 3 Weekly]) as ' + @colWeek3 + '

,sum(x2.[Last 4 Weekly]) as ' + @colWeek4 + '

 

 

,'+ @colSUM +'

 

 

 

FROM

(

select Type,ActID

,CASE WHEN [Activity Name] =''Electrical Cable Connection 01'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Electrical Cable Connection 02'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Instrument Cable Connection 01 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 01 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

ELSE

[Activity Name]

END AS [EICA Activity]

,Scope

,case when Cummulative is null then 0 else Cummulative end as Cummulative

,CASE WHEN [Last 4 Weekly] IS NULL THEN 0 ELSE [Last 4 Weekly] END AS [Last 4 Weekly]

,CASE WHEN [Last 3 Weekly] IS NULL THEN 0 ELSE [Last 3 Weekly] END AS [Last 3 Weekly]

,CASE WHEN [Last 2 Weekly] IS NULL THEN 0 ELSE [Last 2 Weekly] END AS [Last 2 Weekly]

,CASE WHEN [Last 1 Weekly] IS NULL THEN 0 ELSE [Last 1 Weekly] END AS [Last 1 Weekly]

,CASE WHEN Weekly IS NULL THEN 0 ELSE WEEKLY END AS Weekly

,'+ @col +' FROM

 

--******************************************************************

(---Electrical Cable Pulling            

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[EC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] is not null

group by EC_TYPE,[EC_Plan_Pulled_Date],EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([EC_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

tblEleCableList

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

--******************************************************************

---Instrument Cable Pulling         

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([IC_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblInsCableList

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

---Electrical Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] is not null

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Electrical Cable Tray

select convert(char(10),cast([EL_Tray_Installed_date] as smalldatetime),111) as Daily,

''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

where [Production_Date] is not null

) as vETrayPro

where active=1

group by EL_Tray_Type,[EL_Tray_Installed_date],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by EL_Tray_Type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([EL_Tray_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblEleCableTray

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---Instrument Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrument Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Cummulative'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 1 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 2 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 3 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 4 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Scope'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,(count([iC_id]))*2 as ''Gland'',''Instrumentation'' as [Type],''Each'' as [Unit]

,IC_Plan_P6_ActID_Connect as ActID

FROM tblInsCableList

Where active = 1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

--**********************************************************************************

UNION ALL

---JB Installtion

select convert(char(10),cast([JI_Installed] as smalldatetime),111) as daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JI_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JI_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Instrument Installation - Stand Alone/Field

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Installation - In Line

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Hook Ups

select convert(char(10),cast(HookUp_Date as smalldatetime),111) as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup,hookup_date

UNION ALL

select ''Cummulative'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Scope'' as Daily,

''Hook Ups'' as [Activity Name]

,count([Instrument_Tag]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

--*********************************************************

UNION ALL

---Calibration

select convert(char(10),cast(Calibration_Date as smalldatetime),111) as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID,Calibration_Date

UNION ALL

select ''Cummulative'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Scope'' as Daily,

''Calibration'' as [Activity Name]

,count([Instrument_Tag]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID

--*********************************************************

UNION ALL

---Lighting Fixtures

select convert(char(10),cast(LF_Installed as smalldatetime),111) as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed is not null

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([TAG]) as ''Fixture Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

group by lf_ref_desc,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instruments Equipment

select convert(char(10),cast(Installed_Date as smalldatetime),111) as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date is not null

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([tag]) as ''Scope'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where active=1

group by type,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Electrical Equipment

select convert(char(10),cast(Installed_Date as smalldatetime),111) as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment WHERE active=1

and Installed_Date is not null

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Des,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count(Tag) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

group by Des,IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Electrical JB

select convert(char(10),cast(JE_Installed as smalldatetime),111) as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed is not null

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count(TAG) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Cable Tray

select convert(char(10),cast([IN_Tray_Installed] as smalldatetime),111) as Daily,

''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] is not null

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

AND Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([IN_Tray_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblINSCableTray

where active=1

AND tblInsCableTray.IN_Tray_Type <>''F&G''

group by [IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---MSC Cable Pulling

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] is not null

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Cummulative'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 1 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 2 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 3 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 4 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Scope'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Length]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblMSCCable

where active=1

group by IC_Plan_P6_ActID_Pulling,type

--******************************************************************

UNION ALL

---Loop

select convert(char(10),cast(L_Done as smalldatetime),111) as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by L_Done,ACTIVITYID

UNION ALL

select ''Cummulative'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by ACTIVITYID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by L_Done,ACTIVITYID

UNION ALL

select ''Scope'' as Daily,

''Loop'' as [Activity Name]

,count(loopname) as ''Scope'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by ACTIVITYID

--*********************************************************

UNION ALL
---Electrical Cable Glanding 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Glanding 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] is not null

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,count([IC_id]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID

FROM tblInsCableList

where active=1

group by [IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] is not null

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,count([IC_id]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID

FROM tblInsCableList

where active=1

group by [IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

--******************************************************************

) as X

 

PIVOT

(sum (Pulled) for Daily in ('+ @col +',Scope,[Cummulative],[Last 1 Weekly],[Last 2 Weekly],[Last 3 Weekly],[Last 4 Weekly],weekly)

)as X1

) as X2

RIGHT JOIN tblActIDS AS ACTIVITIES ON X2.ActID = ACTIVITIES.ActID

WHERE ACTIVITIES.ResourceId IS NOT NULL AND ResourceId LIKE ''%EL%''

group by ACTIVITIES.SubCon,ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM,ACTIVITIES.[Location], ACTIVITIES.Package

) AS vInfo

INNER JOIN (

SELECT

ResourceId,ResourceName,Subcon,[Location], Package

,SUM(PCS_Budget) AS PCSBudget

FROM tblActIDS

GROUP BY ResourceId,ResourceName,Subcon,[Location], Package

) AS ResBudget

ON 
    vInfo.Package = ResBudget.Package
    AND vInfo.ResourceId = ResBudget.ResourceId AND vInfo.subcon = ResBudget.Subcon
    AND (CASE WHEN vInfo.[Location] IS NULL THEN ''UNDEFINED'' ELSE vInfo.[Location] END) = (CASE WHEN ResBudget.[Location] IS NULL THEN ''UNDEFINED'' ELSE ResBudget.[Location] END)

' 

execute(@result)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DailyTrackingResourceAllInsPackage'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.DailyTrackingResourceAllInsPackage
END
GO
CREATE PROC [dbo].[DailyTrackingResourceAllInsPackage]

AS

 

declare @col as nvarchar(max)

declare @colSUM as nvarchar(max)

declare @result as nvarchar(max)

declare @startdate as char(10)

declare @enddate as char(10)

declare @startdate0 as date

declare @enddate0 as date

declare @colWeek4 as nvarchar(50)

declare @colWeek3 as nvarchar(50)

declare @colWeek2 as nvarchar(50)

declare @colWeek1 as nvarchar(50)

 

select @enddate0 =  [tmp_date] from [tblTMP] where [tmp_id]=1--convert(char(10),cast(getdate() as smalldatetime),111)

select @startdate0 = dateadd(d,-6,@enddate0) --'04/11/2015'

set @enddate =  convert(char(10),cast(@enddate0 as smalldatetime),111)

set @startdate = convert(char(10),cast(@startdate0 as smalldatetime),111)

 

select @colWeek4 = '[' + FORMAT(DATEADD(DAY, -28, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -28, @enddate0), 'MMM') + ']'

select @colWeek3 = '[' + FORMAT(DATEADD(DAY, -21, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -21, @enddate0), 'MMM') + ']'

select @colWeek2 = '[' + FORMAT(DATEADD(DAY, -14, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -14, @enddate0), 'MMM') + ']'

select @colWeek1 = '[' + FORMAT(DATEADD(DAY, -7, @enddate0), 'dd') + '-' + FORMAT(DATEADD(DAY, -7, @enddate0), 'MMM') + ']'

 

select @col = STUFF((select distinct ',' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

select @colSUM =  STUFF((select distinct ',' + 'SUM(' + quotename(x.Date) + ') as ' + quotename(x.Date)

FROM (select DATE FROM (select convert(char(10),dateadd(d,(x.a + (10 * x.b) + (100 * x.c) + (1000 * x.d)),cast(@startdate as smalldatetime)),111) as Date

FROM (select * FROM (select 0 as a UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as a CROSS JOIN

(select 0 as b UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as b CROSS JOIN

(select 0 as c UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as c CROSS JOIN

(select 0 as d UNION ALL select 1 UNION ALL select 2 UNION ALL select 3 UNION ALL select 4 UNION ALL select 5 UNION ALL select 6 UNION ALL select 7 UNION ALL select 8 UNION ALL select 9) as d) as x) as x1

where date between @startdate and @enddate) as x for xml path (''),TYPE).value('.' ,'NVARCHAR(MAX)'),1,1,'')

 

 

set @result = '

 

SELECT

 

ResBudget.PCSBudget AS Scope

,CASE WHEN (ResBudget.PCSBudget - vInfo.Done) IS NULL THEN ResBudget.PCSBudget ELSE ResBudget.PCSBudget - vInfo.Done END AS Pending

,CASE WHEN ResBudget.PCSBudget = 0 THEN 0 ELSE CONVERT(FLOAT,vInfo.Done) / CONVERT(FLOAT,ResBudget.PCSBudget) END AS [% PROG]

,vInfo.*

 

FROM (

select

Package, ACTIVITIES.SubCon,ACTIVITIES.ResourceId

,CASE WHEN ACTIVITIES.[Location] = NULL THEN ACTIVITIES.ResourceName

                WHEN ACTIVITIES.[Location] = ''UNDEFINED'' THEN ACTIVITIES.ResourceName

                ELSE ACTIVITIES.ResourceName + '' - '' + REPLACE(ACTIVITIES.[Location], ''UNDEFINED'', '''')

                END AS ResourceName

 

,ACTIVITIES.UOM

,ACTIVITIES.Location

 

,sum(x2.Cummulative) as Done

,sum(x2.Weekly) as Weekly

 

,sum(x2.Cummulative) - sum(x2.Weekly) AS ' + 'CummWeek1' + '

,sum(x2.Cummulative) - sum(x2.Weekly) - sum(x2.[Last 1 Weekly]) AS ' + 'CummWeek2' + '

 

,(sum(x2.[Last 1 Weekly]) + sum(x2.[Last 2 Weekly])) / 2 AS Trend

 

,sum(x2.[Last 1 Weekly]) as ' + @colWeek1 + '

,sum(x2.[Last 2 Weekly]) as ' + @colWeek2 + '

,sum(x2.[Last 3 Weekly]) as ' + @colWeek3 + '

,sum(x2.[Last 4 Weekly]) as ' + @colWeek4 + '

 

 

,'+ @colSUM +'

 

 

 

FROM

(

select Type,ActID

,CASE WHEN [Activity Name] =''Electrical Cable Connection 01'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Electrical Cable Connection 02'' THEN ''Electrical Cable Connection''

WHEN [Activity Name] =''Instrument Cable Connection 01 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Multi Pair'' THEN ''Instrument Cable Connection Multi Pair''

WHEN [Activity Name] =''Instrument Cable Connection 01 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

WHEN [Activity Name] =''Instrument Cable Connection 02 Single Pair'' THEN ''Instrument Cable Connection Single Pair''

ELSE

[Activity Name]

END AS [EICA Activity]

,Scope

,case when Cummulative is null then 0 else Cummulative end as Cummulative

,CASE WHEN [Last 4 Weekly] IS NULL THEN 0 ELSE [Last 4 Weekly] END AS [Last 4 Weekly]

,CASE WHEN [Last 3 Weekly] IS NULL THEN 0 ELSE [Last 3 Weekly] END AS [Last 3 Weekly]

,CASE WHEN [Last 2 Weekly] IS NULL THEN 0 ELSE [Last 2 Weekly] END AS [Last 2 Weekly]

,CASE WHEN [Last 1 Weekly] IS NULL THEN 0 ELSE [Last 1 Weekly] END AS [Last 1 Weekly]

,CASE WHEN Weekly IS NULL THEN 0 ELSE WEEKLY END AS Weekly

,'+ @col +' FROM

 

--******************************************************************

(---Electrical Cable Pulling            

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[EC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] is not null

group by EC_TYPE,[EC_Plan_Pulled_Date],EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblEleCableList.ec_id,tblEleCableList.Active,tblEleCableList.EC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblEleCableList.EC_Plan_P6_ActID_Pulling,EC_TYPE

from tblEleCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''Ele Cable''

) as vEleParPro

on tblEleCableList.EC_ID=vEleParPro.Tag

) as vECPRo

where active=1

AND [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Electrical Cable Pulling - '' + EC_TYPE as [Activity Name]

,sum([EC_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],EC_Plan_P6_ActID_Pulling as ActID FROM

tblEleCableList

where active=1

group by EC_TYPE,EC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

--******************************************************************

---Instrument Cable Pulling         

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Cummulative'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 1 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND Pro_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 2 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 3 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Last 4 Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Weekly'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblInsCableList.IC_ID,tblInsCableList.Active,tblInsCableList.IC_Length

 

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblInsCableList.IC_Plan_P6_ActID_Pulling

,IC_TYPE

from tblInsCableList

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''IC Cable''

AND [Pro_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblInsCableList.IC_ID=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_TYPE,[EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling

UNION ALL

select ''Scope'' as Daily,''Instrument Cable Pulling '' + IC_TYPE as [Activity Name]

,sum([IC_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblInsCableList

where active=1

group by IC_TYPE,IC_Plan_P6_ActID_Pulling

--******************************************************************

UNION ALL

---Electrical Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID FROM

(select EC_Plan_Connected_Date_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] is not null

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID FROM

(select EC_Plan_Connected_Date_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Plan_Connected_Date_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Connection 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Electrical Cable Tray

select convert(char(10),cast([EL_Tray_Installed_date] as smalldatetime),111) as Daily,

''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

where [Production_Date] is not null

) as vETrayPro

where active=1

group by EL_Tray_Type,[EL_Tray_Installed_date],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by EL_Tray_Type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE Production_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblEleCableTray.Tag,tblEleCableTray.IC_Plan_P6_ActID_Install,tblEleCableTray.Active

,tblEleCableTray.EL_Tray_Length

,[tblEleCableTrayProduction].Production_Qnty,[tblEleCableTrayProduction].Production_Date as EL_Tray_Installed_date,EL_Tray_Type

from tblEleCableTray

left join [tblEleCableTrayProduction]

on tblEleCableTray.Tag=[tblEleCableTrayProduction].Tag

WHERE [Production_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [EL_Tray_Type],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected - '' + EL_Tray_Type as [Activity Name]

,sum([EL_Tray_Length]) as ''Pulled'',''Electrical'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblEleCableTray

where active=1

group by EL_Tray_Type,[IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---Instrument Cable Connections 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID FROM

(select IC_Plan_Connected_Date_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 01 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrument Cable Connections 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] is not null

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by  IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID FROM

(select IC_Plan_Connected_Date_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2],IC_TYPE

FROM tblInsCableList where [IC_Plan_Connected_Date_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_TYPE,IC_Plan_Connected_Date_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by IC_TYPE,Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrument Cable Connection 02 '' + IC_TYPE as [Activity Name]

,count([IC_ID]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] as ActID

FROM tblInsCableList

where active=1

group by IC_TYPE,[IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] is not null

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Cummulative'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 1 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 2 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 3 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Last 4 Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Weekly'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,sum([EC_Conn1])+sum([EC_Conn2]) as ''Gland'',''Instrumentation'' as [Type],''each'' as [unit],IC_Plan_P6_ActID_Connect as ActID FROM

(select [IC_Cable_Gland_From] as [Conn_Date]

,count([ic_id]) as [EC_Conn1] ,0 as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_from],IC_Plan_P6_ActID_Connect

UNION ALL

select [IC_Cable_Gland_To] as [Conn_Date]

,0 as [EC_Conn1] ,count([ic_id]) as [EC_Conn2]

,IC_Plan_P6_ActID_Connect

,IC_TYPE

FROM tblInsCableList

where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active = 1

group by IC_TYPE,[ic_cable_gland_to],IC_Plan_P6_ActID_Connect)

as vELECon1

group by IC_TYPE,Conn_Date,IC_Plan_P6_ActID_Connect

UNION ALL

select ''Scope'' as Daily

,''Instrument Cable Glanding - '' + IC_TYPE as [Activity Name]

,(count([iC_id]))*2 as ''Gland'',''Instrumentation'' as [Type],''Each'' as [Unit]

,IC_Plan_P6_ActID_Connect as ActID

FROM tblInsCableList

Where active = 1

group by IC_TYPE,IC_Plan_P6_ActID_Connect

--**********************************************************************************

UNION ALL

---JB Installtion

select convert(char(10),cast([JI_Installed] as smalldatetime),111) as daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JI_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JI_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and [JI_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [JI_Installed],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''JB Installation'' as [activity Name]

,count([JunctionBox]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM JunctionBox

where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Instrument Installation - Stand Alone/Field

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - Stand Alone/Field'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments

where instrument=''Instrument''

AND ((Furnished_By is null) OR ([Furnished_By]=''VENDOR LOOSE''))

AND Location =''Field''

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Installation - In Line

select convert(char(10),cast([Installation_Date] as smalldatetime),111) as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and Installation_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

and [Installation_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [Installation_Date],IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instrument Installation - In Line'' as [Activity Name]

,count([Instrument_Tag]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInstruments where Instrument =''Instrument''

and Location <> ''Field''

and (([Furnished_By] is null) or (Furnished_By = ''vendor loose''))

and active=1

group by IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Hook Ups

select convert(char(10),cast(HookUp_Date as smalldatetime),111) as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup,hookup_date

UNION ALL

select ''Cummulative'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and HookUp_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Weekly'' as Daily,

''Hook Ups'' as [Activity Name]

,count([HookUp_Date]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

and hookup_date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Hookup

UNION ALL

select ''Scope'' as Daily,

''Hook Ups'' as [Activity Name]

,count([Instrument_Tag]) as ''Hookup Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Hookup as ActID FROM tblInstruments where active=1

and hookup_name is not null

group by IC_Plan_P6_ActID_Hookup

--*********************************************************

UNION ALL

---Calibration

select convert(char(10),cast(Calibration_Date as smalldatetime),111) as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID,Calibration_Date

UNION ALL

select ''Cummulative'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by P6_Precalibration_ActID

UNION ALL

select ''Weekly'' as Daily,

''Calibration'' as [Activity Name]

,count([Calibration_Date]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

and Calibration_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by P6_Precalibration_ActID

UNION ALL

select ''Scope'' as Daily,

''Calibration'' as [Activity Name]

,count([Instrument_Tag]) as ''Calibration Count'',''Instrumentation'' as [Type],''Each'' as [Unit],P6_Precalibration_ActID as ActID FROM tblInstruments where active=1

and Calibration_Type = ''Yes''

group by P6_Precalibration_ActID

--*********************************************************

UNION ALL

---Lighting Fixtures

select convert(char(10),cast(LF_Installed as smalldatetime),111) as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed is not null

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([LF_Installed]) as ''Installed Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

and LF_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by lf_ref_desc,LF_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Lighting - '' + lf_ref_desc as [Activity Name]

,count([TAG]) as ''Fixture Count'',''EL. LIGTHING'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblLightingFixture where active=1

group by lf_ref_desc,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instruments Equipment

select convert(char(10),cast(Installed_Date as smalldatetime),111) as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date is not null

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by type,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where type <>''Local Panel'' and active=1

and Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by type,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Instruments Equipment ('' + Type +'')'' as [Activity Name]

,count([tag]) as ''Scope'',''Instrumentation'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblInsEquipment where active=1

group by type,IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Electrical Equipment

select convert(char(10),cast(Installed_Date as smalldatetime),111) as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment WHERE active=1

and Installed_Date is not null

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Des,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count([Installed_Date]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

and Installed_Date between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by Des,Installed_Date,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Electrical Equipment - '' + Des as [Activity Name]

,count(Tag) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblElectricalEquipment where active=1

group by Des,IC_Plan_P6_ActID_Install

--*********************************************************

 

UNION ALL

---Electrical JB

select convert(char(10),cast(JE_Installed as smalldatetime),111) as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed is not null

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Weekly'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count([JE_Installed]) as ''Installed Count'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

and JE_Installed between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by JE_Installed,IC_Plan_P6_ActID_Install

UNION ALL

select ''Scope'' as Daily,

''Electrical Junction Boxes'' as [Activity Name]

,count(TAG) as ''Scope'',''Electrical'' as [Type],''Each'' as [Unit],IC_Plan_P6_ActID_Install as ActID FROM tblEleJunctionBox where active=1

and ((Furnished_By is null) or (Furnished_By=''vendor loose''))

group by IC_Plan_P6_ActID_Install

--*********************************************************

UNION ALL

---Instrument Cable Tray

select convert(char(10),cast([IN_Tray_Installed] as smalldatetime),111) as Daily,

''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] is not null

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Cummulative'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

AND Production_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vETrayPro

where active=1

group by [IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 1 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 2 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 3 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Last 4 Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Weekly'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([Production_Qnty]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM

(

select tblInsCableTray.Tag,tblInsCableTray.IC_Plan_P6_ActID_Install,tblInsCableTray.Active

,tblInsCableTray.IN_Tray_Length

,tblInsCableTrayProduction.Production_Qnty,tblInsCableTrayProduction.Production_Date as IN_Tray_Installed

from tblInsCableTray

left join tblInsCableTrayProduction

on tblInsCableTray.Tag=tblInsCableTrayProduction.Tag

where tblInsCableTray.IN_Tray_Type <>''F&G''

) as vETrayPro

where active=1

and [IN_Tray_Installed] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [IN_Tray_Installed],[IC_Plan_P6_ActID_Install]

UNION ALL

select ''Scope'' as Daily,''Cable Tray Erected'' as [Activity Name]

,sum([IN_Tray_Length]) as ''Pulled'',''Instrumentation'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Install] as ActID FROM tblINSCableTray

where active=1

AND tblInsCableTray.IN_Tray_Type <>''F&G''

group by [IC_Plan_P6_ActID_Install]

--******************************************************************

UNION ALL

---MSC Cable Pulling

select convert(char(10),cast([EC_Plan_Pulled_Date] as smalldatetime),111) as Daily,

''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],[IC_Plan_P6_ActID_Pulling] as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] is not null

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Cummulative'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

AND Pro_Date <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

group by IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 1 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 2 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum(Qnty) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 3 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Last 4 Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Weekly'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Qnty]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

(

select tblMSCCable.Tag,tblMSCCable.Active,tblMSCCable.Length

,tblMSCCable.type

,[Qnty],Pro_Date as [EC_Plan_Pulled_Date],tblMSCCable.IC_Plan_P6_ActID_Pulling

from tblMSCCable

left join

(

SELECT [Discipline],[Type],[Unit],[Tag]

,[Qnty]

,Pro_Date

,[PullingActID]

FROM [vCblParProduction]

where Discipline=''MSC Cable''

) as vEleParPro

on tblMSCCable.Tag=vEleParPro.Tag

) as vECPRo

where active=1

and [EC_Plan_Pulled_Date] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by [EC_Plan_Pulled_Date],IC_Plan_P6_ActID_Pulling,type

UNION ALL

select ''Scope'' as Daily,''MSC Cable Pulling''+''-''+type as [Activity Name]

,sum([Length]) as ''Pulled'',''MSC Cable'' as [Type],''LM'' as [Unit],IC_Plan_P6_ActID_Pulling as ActID FROM

tblMSCCable

where active=1

group by IC_Plan_P6_ActID_Pulling,type

--******************************************************************

UNION ALL

---Loop

select convert(char(10),cast(L_Done as smalldatetime),111) as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by L_Done,ACTIVITYID

UNION ALL

select ''Cummulative'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by ACTIVITYID

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

group by L_Done,ACTIVITYID

UNION ALL

select ''Weekly'' as Daily,

''Loop'' as [Activity Name]

,count([L_Done]) as ''Installed Count'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

and L_Done between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

group by L_Done,ACTIVITYID

UNION ALL

select ''Scope'' as Daily,

''Loop'' as [Activity Name]

,count(loopname) as ''Scope'',''Loop Test'' as [Type],''Each'' as [Unit],ACTIVITYID as ActID FROM tblInsLoop where active=1

group by ACTIVITYID

--*********************************************************

UNION ALL
---Electrical Cable Glanding 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_From as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect]

FROM tblEleCableList where [EC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_From,[EC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Glanding 01'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect] + ''-GL'' as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Electrical Cable Glanding 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] is not null

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,sum([EC_Conn1]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select EC_Cable_Gland_To as [Conn_Date]

,count([EC_ID]) as [EC_Conn1] ,[EC_Plan_P6_ActID_Connect_2]

FROM tblEleCableList where [EC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by EC_Cable_Gland_To,[EC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [EC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Electrical Cable Glanding 02'' as [Activity Name]

,count([EC_id]) as ''Conn'',''Electrical'' as [Type],''Each'' as [Unit],[EC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID

FROM tblEleCableList

where active=1

group by [EC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding 01

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Cummulative'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Weekly'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_From as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect]

FROM tblInsCableList where [IC_Cable_Gland_From] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_From,[IC_Plan_P6_ActID_Connect]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect]

UNION ALL

select ''Scope'' as Daily,

''Instrumentation Cable Glanding 01'' as [Activity Name]

,count([IC_id]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect] + ''-GL'' as ActID

FROM tblInsCableList

where active=1

group by [IC_Plan_P6_ActID_Connect]

--*********************************************************************************

UNION ALL

---Instrumentation Cable Glanding 02

select convert(char(10),cast([Conn_Date] as smalldatetime),111) as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] is not null

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by Conn_Date,[IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Cummulative'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] <= (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 1 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 2 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-7,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 3 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-14,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Last 4 Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-13-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and dateadd(d,-7-21,(select [tmp_date] from [tblTMP] where [tmp_id]=1))

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Weekly'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,sum([IC_Conn1]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID FROM

(select IC_Cable_Gland_To as [Conn_Date]

,count([IC_ID]) as [IC_Conn1] ,[IC_Plan_P6_ActID_Connect_2]

FROM tblInsCableList where [IC_Cable_Gland_To] between dateadd(d,-6,(select [tmp_date] from [tblTMP] where [tmp_id]=1)) and (select [tmp_date] from [tblTMP] where [tmp_id]=1)

and active=1

group by IC_Cable_Gland_To,[IC_Plan_P6_ActID_Connect_2]

)

as vELECon1

group by [IC_Plan_P6_ActID_Connect_2]

UNION ALL

select ''Scope'' as Daily,

''Instrumentation Cable Glanding 02'' as [Activity Name]

,count([IC_id]) as ''Conn'',''Instrumentation'' as [Type],''Each'' as [Unit],[IC_Plan_P6_ActID_Connect_2] + ''-GL'' as ActID

FROM tblInsCableList

where active=1

group by [IC_Plan_P6_ActID_Connect_2]

--*********************************************************************************

--******************************************************************

) as X

 

PIVOT

(sum (Pulled) for Daily in ('+ @col +',Scope,[Cummulative],[Last 1 Weekly],[Last 2 Weekly],[Last 3 Weekly],[Last 4 Weekly],weekly)

)as X1

) as X2

RIGHT JOIN tblActIDS AS ACTIVITIES ON X2.ActID = ACTIVITIES.ActID

WHERE ACTIVITIES.ResourceId IS NOT NULL AND ResourceId LIKE ''%IN%''

group by ACTIVITIES.SubCon,ACTIVITIES.ResourceId,ACTIVITIES.ResourceName,ACTIVITIES.UOM,ACTIVITIES.[Location], ACTIVITIES.Package

) AS vInfo

INNER JOIN (

SELECT

ResourceId,ResourceName,Subcon,[Location], Package

,SUM(PCS_Budget) AS PCSBudget

FROM tblActIDS

GROUP BY ResourceId,ResourceName,Subcon,[Location], Package

) AS ResBudget

ON 
    vInfo.Package = ResBudget.Package
    AND vInfo.ResourceId = ResBudget.ResourceId AND vInfo.subcon = ResBudget.Subcon
    AND (CASE WHEN vInfo.[Location] IS NULL THEN ''UNDEFINED'' ELSE vInfo.[Location] END) = (CASE WHEN ResBudget.[Location] IS NULL THEN ''UNDEFINED'' ELSE ResBudget.[Location] END)

' 

execute(@result)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'SetInstCalibrationScope'
			AND schema_id = (select schema_id from sys.schemas where name = 'PLANNING')
			)
BEGIN
	DROP PROC PLANNING.SetInstCalibrationScope
END
GO
CREATE PROC [PLANNING].[SetInstCalibrationScope]
@tag NVARCHAR(100),
@calibrationScope NVARCHAR(50)
AS
UPDATE tblInstruments SET Calibration_Type = @calibrationScope WHERE Instrument_Tag = @tag
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'SetInstHookupScope'
			AND schema_id = (select schema_id from sys.schemas where name = 'PLANNING')
			)
BEGIN
	DROP PROC PLANNING.SetInstHookupScope
END
GO
CREATE PROC [PLANNING].[SetInstHookupScope]
@tag NVARCHAR(100),
@hookupScope NVARCHAR(50) = NULL
AS
UPDATE tblInstruments SET hookup_name = @hookupScope WHERE Instrument_Tag = @tag
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'SetInstallationScope'
			AND schema_id = (select schema_id from sys.schemas where name = 'PLANNING')
			)
BEGIN
	DROP PROC PLANNING.SetInstallationScope
END
GO
CREATE PROC [PLANNING].[SetInstallationScope]
@tag NVARCHAR(100),
@Scope NVARCHAR(50) = NULL
AS
UPDATE tblInstruments SET Instrument = @Scope WHERE Instrument_Tag = @tag
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetCableProduction'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.GetCableProduction
END
GO
CREATE PROC CONSTRUCTION.GetCableProduction
AS
SELECT
'Electrical' AS Discipline,
Pro_ID AS Id, Tag, Per_Qnty AS [Percentage], Pro_Date AS [Pulled Date],
ActualSubcontractor AS [Subcontractor], ActualDrum AS [Actual Drum],
cable_mark_1_from AS [Mark 1 From], cable_mark_1_to AS [Mark 1 To],
ABS(cable_mark_1_from - cable_mark_1_to) AS [Actual Length]
FROM tblEleCableProduction
UNION ALL
SELECT
'Instrumentation' AS Discipline,
Pro_ID AS Id, Tag, Per_Qnty AS [Percentage], Pro_Date AS [Pulled Date],
ActualSubcontractor AS [Subcontractor], ActualDrum AS [Actual Drum],
cable_mark_1_from AS [Mark 1 From], cable_mark_1_to AS [Mark 1 To],
ABS(cable_mark_1_from - cable_mark_1_to) AS [Actual Length]
FROM tblInsCableProduction
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DeleteCableProduction'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.DeleteCableProduction
END
GO
CREATE PROC CONSTRUCTION.DeleteCableProduction
@id INT,
@discipline NVARCHAR(50)
AS

IF @discipline = 'Electrical'
    BEGIN
        DELETE FROM tblEleCableProduction WHERE Pro_ID = @id
    END
ELSE
    BEGIN
        DELETE FROM tblInsCableProduction WHERE Pro_ID = @id
    END
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'FN' 
			AND name = 'GetCableTotalPercentageOther'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP FUNCTION CONSTRUCTION.GetCableTotalPercentageOther
END
GO
CREATE FUNCTION CONSTRUCTION.GetCableTotalPercentageOther (
   @tag NVARCHAR(100),
   @deiscipline NVARCHAR(50),
   @id INT
)
RETURNS FLOAT

AS

BEGIN
    DECLARE @total FLOAT
    IF @deiscipline = 'Electrical'
        BEGIN
            SELECT @total = (
            SELECT
            SUM(Per_Qnty)
            FROM tblEleCableProduction
            WHERE Tag = @tag AND Pro_ID <> @id
            )
        END
    ELSE
        BEGIN
            SELECT @total = (
            SELECT
            SUM(Per_Qnty)
            FROM tblInsCableProduction
            WHERE Tag = @tag AND Pro_ID <> @id
            )
        END
    IF @total IS NULL
        RETURN 0

    RETURN @total
END
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'UpdateCableProduction'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.UpdateCableProduction
END
GO
CREATE PROC CONSTRUCTION.UpdateCableProduction
@discipline NVARCHAR(50),
@id INT,
@percentage FLOAT,
@date DATE,
@m1From INT,
@2m1To INT,
@actualDrum NVARCHAR(250)

AS

IF @discipline = 'Electrical'
    UPDATE tblEleCableProduction
        SET Per_Qnty = @percentage,
            Pro_Date = @date,
            cable_mark_1_from = @m1From,
            cable_mark_1_to = @2m1To,
            ActualDrum = @actualDrum
        WHERE Pro_ID  = @id
ELSE
    UPDATE tblInsCableProduction
        SET Per_Qnty = @percentage,
            Pro_Date = @date,
            cable_mark_1_from = @m1From,
            cable_mark_1_to = @2m1To,
            ActualDrum = @actualDrum
        WHERE Pro_ID  = @id
GO
IF NOT EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'U' 
			AND name = 'tblResources'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	CREATE TABLE tblResources (
        id INT IDENTITY (1, 1) NOT NULL,
        ResourcesName NVARCHAR(250) NOT NULL,
        Suffix NVARCHAR(5) NULL,
        [Resource] VARBINARY(MAX) NULL,
        Remarks NVARCHAR(MAX),
        CreatedDate DATE NOT NULL DEFAULT GETDATE(),
        PRIMARY KEY (id)
    )
END
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'AddResource'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.AddResource
END
GO
CREATE PROC dbo.AddResource 
@ResourcesName NVARCHAR(250),
@Suffix NVARCHAR(5),
@Remarks NVARCHAR(MAX)

AS
INSERT INTO dbo.tblResources (ResourcesName, Suffix, Remarks)
	VALUES (@ResourcesName, @Suffix, @Remarks)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetResource'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.GetResource
END
GO
CREATE PROC dbo.GetResource 
AS
SELECT
Id, ResourcesName AS [Resources Name], [Resource],Suffix,Remarks,CreatedDate AS [Created Date]
FROM dbo.tblResources
GO
IF NOT EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'U' 
			AND name = 'tblResourcesItem'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	CREATE TABLE tblResourcesItem (
        id INT IDENTITY (1, 1) NOT NULL,
        ResId INT NOT NULL,
        ItemId INT NOT NULL,
        GroupId INT NOT NULL,
        PRIMARY KEY (id)
    )
END
GO
IF NOT EXISTS (SELECT 1 FROM sys.indexes 
			WHERE name = 'tblResourcesItem_Group_IX'
			)
BEGIN
	CREATE INDEX tblResourcesItem_Group_IX
    ON tblResourcesItem (GroupId)
END
GO
GO
IF NOT EXISTS (SELECT 1 FROM sys.indexes 
			WHERE name = 'tblResourcesItem_Item_IX'
			)
BEGIN
	CREATE INDEX tblResourcesItem_Item_IX
    ON tblResourcesItem (ItemId)
END
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DeleteResource'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.DeleteResource
END
GO
CREATE PROC dbo.DeleteResource
@id INT
AS
DELETE FROM dbo.tblResourcesItem WHERE resId = @id
DELETE FROM dbo.tblResources WHERE id = @id
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'EditResource'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.EditResource
END
GO
CREATE PROC dbo.EditResource 
@ResourcesName NVARCHAR(250),
@Suffix NVARCHAR(5),
@Remarks NVARCHAR(MAX),
@id INT

AS
UPDATE dbo.tblResources 
	SET ResourcesName = @ResourcesName, 
		Suffix = @Suffix, 
		Remarks = @Remarks
WHERE id = @id
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'AssignResource'
			AND schema_id = (select schema_id from sys.schemas where name = 'ENGINEERING')
			)
BEGIN
	DROP PROC ENGINEERING.AssignResource
END
GO
CREATE PROC ENGINEERING.AssignResource 
@ResId INT,
@ItemId INT,
@GroupId INT

AS
INSERT INTO tblResourcesItem (ResId, ItemId, GroupId)
VALUES (@ResId, @ItemId, @GroupId)
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetCables'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.GetCables
END
GO
CREATE PROC [CONSTRUCTION].[GetCables]
AS
WITH ElePro AS (
SELECT 
      [Tag]
      ,SUM([Per_Qnty]) AS TotalPercentage
      ,MAX([Pro_Date]) AS LastUpdated
FROM [tblEleCableProduction] WITH (NOLOCK)
GROUP BY Tag
), InsPro AS (
SELECT 
      [Tag]
      ,SUM([Per_Qnty]) AS TotalPercentage
      ,MAX([Pro_Date]) AS LastUpdated
FROM [tblInsCableProduction] WITH (NOLOCK)
GROUP BY Tag
)

SELECT 
Discipline,[Area],[EC_Type] AS [Type],[EC_ID] AS Tag,[EC_Length] AS [Length],[EC_Description] AS [Description],Routing
,[SubSystem],[EC_From] AS [From],[From_Description] AS [From Description],[EC_To] AS [To],[To_Description] AS [To Description],Drawing

,[EC_Plan_P6_ActID_Pulling] AS [Pulling ActId]
,[EC_Plan_P6_ActID_Connect] AS [Con From ActId]
,[EC_Plan_P6_ActID_Connect_2] AS [Con To ActId]
,[EC_Plan_P6_ActID_Test] AS [Test ActId]

,PullingWorkfront AS [Pulling Workfront]
,ElePro.TotalPercentage * EC.EC_Length / 100 AS [Pulled Lm]
,ElePro.LastUpdated [Pulled Date]
,ElePro.TotalPercentage

,GlandFromWorkfront AS [Gland From Workfront]
,EC_Cable_Gland_From AS [Gland From Date]

,GlandToWorkfront AS [Gland To Workfront]
,EC_Cable_Gland_To AS [Gland To Date]

,ConnFromWorkfront AS [Conn From Workfront]
,[EC_Plan_Connected_Date_From] AS [Con From Date]

,ConnToWorkfront AS [Conn To Workfront]
,[EC_Plan_Connected_Date_To] AS [Con To Date]

,[EC_Megger] AS [Test Date]
,[TR_QC_Released] AS [QC Released Date]
,RFINumber
,PDSModel
,[Remarks]
,[Team], TBL_ID AS Id
,CASE WHEN Active = 1 THEN 'Active' ELSE 'DELETED' END AS Status
FROM [tblEleCableList] AS EC WITH (NOLOCK)
LEFT JOIN ElePro ON EC.EC_ID = ElePro.Tag


UNION ALL

SELECT 
Discipline,[Area],[IC_Type] AS [Type],[IC_ID] AS Tag,[IC_Length] AS [Length],[IC_Description] AS [Description],Routing
,[SubSystem],[IC_From] AS [From],[From_Description] AS [From Description],[IC_To] AS [To],[To_Description] AS [To Description],Drawing

,[IC_Plan_P6_ActID_Pulling] AS [Pulling ActId]
,[IC_Plan_P6_ActID_Connect] AS [Con From ActId]
,[IC_Plan_P6_ActID_Connect_2] AS [Con To ActId]
,[IC_Plan_P6_ActID_Test] AS [Test ActId]

,PullingWorkfront AS [Pulling Workfront]
,InsPro.TotalPercentage * IC.IC_Length / 100 AS [Pulled Lm]
,InsPro.LastUpdated [Pulled Date]
,InsPro.TotalPercentage

,GlandFromWorkfront AS [Gland From Workfront]
,IC_Cable_Gland_From AS [Gland From Date]

,GlandToWorkfront AS [Gland To Workfront]
,IC_Cable_Gland_To AS [Gland To Date]

,ConnFromWorkfront AS [Conn From Workfront]
,[IC_Plan_Connected_Date_From] AS [Con From Date]

,ConnToWorkfront AS [Conn To Workfront]
,[IC_Plan_Connected_Date_To] AS [Con To Date]

,[IC_Megger] AS [Test Date]
,[TR_QC_Released] AS [QC Released Date]
,RFINumber
,PDSModel
,[Remarks]
,[Team], TBL_ID AS Id
,CASE WHEN Active = 1 THEN 'Active' ELSE 'DELETED' END AS Status
FROM [tblInsCableList] AS IC WITH (NOLOCK)
LEFT JOIN InsPro ON IC.IC_ID = InsPro.Tag
OPTION (USE HINT ('DISABLE_ROW_MODE_MEMORY_GRANT_FEEDBACK'))
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetCablesFull'
			AND schema_id = (select schema_id from sys.schemas where name = 'CONSTRUCTION')
			)
BEGIN
	DROP PROC CONSTRUCTION.GetCablesFull
END
GO
CREATE PROC [CONSTRUCTION].[GetCablesFull]
AS

If(OBJECT_ID('tempdb..#Equipment') Is Not Null)
Begin
    Drop Table #Equipment
End

If(OBJECT_ID('tempdb..#ElePro') Is Not Null)
Begin
    Drop Table #ElePro
End

If(OBJECT_ID('tempdb..#InsPro') Is Not Null)
Begin
    Drop Table #InsPro
End

If(OBJECT_ID('tempdb..#ActId') Is Not Null)
Begin
    Drop Table #ActId
End

DECLARE @cutoff DATE
SELECT @cutoff = tblTMP.tmp_date FROM tblTmp WHERE tblTMP.tmp_id = 1

CREATE TABLE #Equipment (
Discipline NVARCHAR(250) NOT NULL,
Type NVARCHAR(250) NULL,
SubType NVARCHAR(250) NULL,
Area NVARCHAR(250) NULL,
Subsystem NVARCHAR(250) NULL,
Tag NVARCHAR(250) NOT NULL,
Description NVARCHAR(250) NULL,
ActId NVARCHAR(250) NULL,
InstallationDate DATE NULL,
QCReleasedDate DATE NULL,
InstallationScope NVARCHAR(250) NULL,
RFI NVARCHAR(250) NULL,
PDSModel NVARCHAR(250) NULL,
Team NVARCHAR(250) NULL,
Status NVARCHAR(50) NOT NULL
)

CREATE TABLE #ElePro (
Tag NVARCHAR(250) NOT NULL,
TotalPercentage FLOAT NOT NULL DEFAULT 0,
LastUpdated DATE NOT NULL,
Weekly FLOAT NOT NULL DEFAULT 0
)

CREATE TABLE #InsPro (
Tag NVARCHAR(250) NOT NULL,
TotalPercentage FLOAT NOT NULL DEFAULT 0,
LastUpdated DATE NOT NULL,
Weekly FLOAT NOT NULL DEFAULT 0
)

CREATE TABLE #ActId (
[ActID] NVARCHAR(250) NOT NULL,
[ActName] NVARCHAR(250) NULL,
[SubCon] NVARCHAR(250) NULL,
[Family] NVARCHAR(250) NULL,
[EICA_Area] NVARCHAR(250) NULL,
[Team] NVARCHAR(250) NULL,
[StartDate] DATE NULL,
[EndDate] DATE NULL
)

INSERT INTO #ElePro 
SELECT 
      [Tag]
      ,SUM([Per_Qnty]) AS TotalPercentage
      ,MAX([Pro_Date]) AS LastUpdated
      ,SUM(CASE WHEN pro_Date BETWEEN DATEADD(DAY, -6, @cutoff) AND @cutoff THEN Per_Qnty ELSE 0 END) AS Weekly
FROM [tblEleCableProduction] WITH (NOLOCK)
GROUP BY Tag



INSERT INTO #InsPro
SELECT 
      [Tag]
      ,SUM([Per_Qnty]) AS TotalPercentage
      ,MAX([Pro_Date]) AS LastUpdated
      ,SUM(CASE WHEN pro_Date BETWEEN DATEADD(DAY, -6, @cutoff) AND @cutoff THEN Per_Qnty ELSE 0 END) AS Weekly
FROM [tblInsCableProduction] WITH (NOLOCK)
GROUP BY Tag


INSERT INTO #Equipment
EXEC CONSTRUCTION.GetEquipmentMini

INSERT INTO #Equipment
SELECT 
'Instrumentation' AS Discipline,Ins_Type AS [Type],[Furnished_By] AS SubType,Area,[Subsystem]
,Instrument_Tag AS Tag
,[Instrument_Type_Desc] AS [Description]
,[IC_Plan_P6_ActID_Install] AS [ActId]
,Installation_Date AS [Installed Date]
,Final_Installed_Date AS [QC Released Date]
,RFINumberInstallation AS RFI
,NULL AS [Installation Scope]
,PDSModel
,[Team]
,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
FROM tblInstruments WITH (NOLOCK)

INSERT INTO #ActId
SELECT [ActID],[ActName],[SubCon],[Family],[EICA_Area],[Team],[StartDate],[EndDate] FROM [tblActIDS] WITH (NOLOCK)

SELECT DISTINCT
EC.Discipline,EC.[Area],[EC_Type] AS [Type],[EC_ID] AS Tag,[EC_Length] AS [Length],[EC_Description] AS [Description],Routing
,EC.[SubSystem]
,[EC_From] AS [From],[From_Description] AS [From Description], EqFrom.Area AS [Eq From Area], EqFrom.PDSModel AS [Eq From PDSModel], EqFrom.Team AS [Eq From Team], EqFrom.[Status] AS [Eq From Status]
,[EC_To] AS [To],[To_Description] AS [To Description], EqTo.Area AS [Eq To Area], EqTo.PDSModel AS [Eq To PDSModel], EqTo.Team AS [Eq To Team], EqTo.[Status] AS [Eq To Status]
,Drawing

,[EC_Plan_P6_ActID_Pulling] AS [Pulling ActId], PullAct.ActName AS [Pulling ActName],PullAct.EICA_Area AS [Pulling Act Area],PullAct.Family AS [Pulling Act Family],PullAct.SubCon AS [Pulling Act Subcon],PullAct.Team AS [Pulling Act Team],PullAct.StartDate AS [Pulling Act StartDate],PullAct.EndDate AS [Pulling Act EndDate]
,[EC_Plan_P6_ActID_Connect] AS [Con From ActId], ConFromAct.ActName AS [ConFrom ActName],ConFromAct.EICA_Area AS [ConFrom Act Area],ConFromAct.Family AS [ConFrom Act Family],ConFromAct.SubCon AS [ConFrom Act Subcon],ConFromAct.Team AS [ConFrom Act Team],ConFromAct.StartDate AS [ConFrom Act StartDate],ConFromAct.EndDate AS [ConFrom Act EndDate]
,[EC_Plan_P6_ActID_Connect_2] AS [Con To ActId], ConToAct.ActName AS [ConTo ActName],ConToAct.EICA_Area AS [ConTo Act Area],ConToAct.Family AS [ConTo Act Family],ConToAct.SubCon AS [ConTo Act Subcon],ConToAct.Team AS [ConTo Act Team],ConToAct.StartDate AS [ConTo Act StartDate],ConToAct.EndDate AS [ConTo Act EndDate]
,[EC_Plan_P6_ActID_Test] AS [Test ActId]

,PullingWorkfront AS [Pulling Workfront]
,#ElePro.TotalPercentage * EC.EC_Length / 100 AS [Pulled Lm]
,#ElePro.LastUpdated [Pulled Date]
,#ElePro.TotalPercentage
,#ElePro.Weekly * EC.EC_Length / 100 AS [Weekly Pulled Lm]

,GlandFromWorkfront AS [Gland From Workfront]
,EC_Cable_Gland_From AS [Gland From Date]

,GlandToWorkfront AS [Gland To Workfront]
,EC_Cable_Gland_To AS [Gland To Date]

,ConnFromWorkfront AS [Conn From Workfront]
,[EC_Plan_Connected_Date_From] AS [Con From Date]

,ConnToWorkfront AS [Conn To Workfront]
,[EC_Plan_Connected_Date_To] AS [Con To Date]

,[EC_Megger] AS [Test Date]
,[TR_QC_Released] AS [QC Released Date]
,RFINumber
,EC.PDSModel
,[Remarks]
,EC.[Team], tbl_id AS Id
,CASE WHEN Active = 1 THEN 'Active' ELSE 'DELETED' END AS Status
FROM [tblEleCableList] AS EC WITH (NOLOCK)
LEFT JOIN #ElePro ON EC.EC_ID = #ElePro.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #Equipment AS EqFrom ON EC.EC_From = EqFrom.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #Equipment AS EqTo ON EC.EC_To = EqTo.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS PullAct ON EC.EC_Plan_P6_ActID_Pulling = PullAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS ConFromAct ON EC.EC_Plan_P6_ActID_Connect = ConFromAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS ConToAct ON EC.EC_Plan_P6_ActID_Connect_2 = ConToAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS


UNION ALL

SELECT DISTINCT
IC.Discipline,IC.[Area],[IC_Type] AS [Type],[IC_ID] AS Tag,[IC_Length] AS [Length],[IC_Description] AS [Description],Routing
,IC.[SubSystem]
,[IC_From] AS [From],[From_Description] AS [From Description], EqFrom.Area AS [Eq From Area], EqFrom.PDSModel AS [Eq From PDSModel], EqFrom.Team AS [Eq From Team], EqFrom.[Status] AS [Eq From Status]
,[IC_To] AS [To],[To_Description] AS [To Description], EqTo.Area AS [Eq To Area], EqTo.PDSModel AS [Eq To PDSModel], EqTo.Team AS [Eq To Team], EqTo.[Status] AS [Eq To Status]
,Drawing

,[IC_Plan_P6_ActID_Pulling] AS [Pulling ActId], PullAct.ActName AS [Pulling ActName],PullAct.EICA_Area AS [Pulling Act Area],PullAct.Family AS [Pulling Act Family],PullAct.SubCon AS [Pulling Act Subcon],PullAct.Team AS [Pulling Act Team],PullAct.StartDate AS [Pulling Act StartDate],PullAct.EndDate AS [Pulling Act EndDate]
,[IC_Plan_P6_ActID_Connect] AS [Con From ActId], ConFromAct.ActName AS [ConFrom ActName],ConFromAct.EICA_Area AS [ConFrom Act Area],ConFromAct.Family AS [ConFrom Act Family],ConFromAct.SubCon AS [ConFrom Act Subcon],ConFromAct.Team AS [ConFrom Act Team],ConFromAct.StartDate AS [ConFrom Act StartDate],ConFromAct.EndDate AS [ConFrom Act EndDate]
,[IC_Plan_P6_ActID_Connect_2] AS [Con To ActId], ConToAct.ActName AS [ConTo ActName],ConToAct.EICA_Area AS [ConTo Act Area],ConToAct.Family AS [ConTo Act Family],ConToAct.SubCon AS [ConTo Act Subcon],ConToAct.Team AS [ConTo Act Team],ConToAct.StartDate AS [ConTo Act StartDate],ConToAct.EndDate AS [ConTo Act EndDate]
,[IC_Plan_P6_ActID_Test] AS [Test ActId]

,PullingWorkfront AS [Pulling Workfront]
,#InsPro.TotalPercentage * IC.IC_Length / 100 AS [Pulled Lm]
,#InsPro.LastUpdated [Pulled Date]
,#InsPro.TotalPercentage
,#InsPro.Weekly * IC.IC_Length / 100 AS [Weekly Pulled Lm]

,GlandFromWorkfront AS [Gland From Workfront]
,IC_Cable_Gland_From AS [Gland From Date]

,GlandToWorkfront AS [Gland To Workfront]
,IC_Cable_Gland_To AS [Gland To Date]

,ConnFromWorkfront AS [Conn From Workfront]
,[IC_Plan_Connected_Date_From] AS [Con From Date]

,ConnToWorkfront AS [Conn To Workfront]
,[IC_Plan_Connected_Date_To] AS [Con To Date]

,[IC_Megger] AS [Test Date]
,[TR_QC_Released] AS [QC Released Date]
,RFINumber
,IC.PDSModel
,[Remarks]
,IC.[Team], tbl_id AS Id
,CASE WHEN Active = 1 THEN 'Active' ELSE 'DELETED' END AS Status
FROM [tblInsCableList] AS IC WITH (NOLOCK)
LEFT JOIN #InsPro ON IC.IC_ID = #InsPro.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #Equipment AS EqFrom ON IC.IC_From = EqFrom.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #Equipment AS EqTo ON IC.IC_To = EqTo.Tag COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS PullAct ON IC.IC_Plan_P6_ActID_Pulling = PullAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS ConFromAct ON IC.IC_Plan_P6_ActID_Connect = ConFromAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
LEFT JOIN #ActId AS ConToAct ON IC.IC_Plan_P6_ActID_Connect_2 = ConToAct.ActID COLLATE SQL_Latin1_General_CP1_CI_AS
OPTION (USE HINT ('DISABLE_ROW_MODE_MEMORY_GRANT_FEEDBACK'))
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'GetResourceItem'
			AND schema_id = (select schema_id from sys.schemas where name = 'dbo')
			)
BEGIN
	DROP PROC dbo.GetResourceItem
END
GO
CREATE PROC dbo.GetResourceItem
@itemId INT,
@groupId INT
AS
SELECT
dbo.tblResourcesItem.Id, ResourcesName AS [Resources Name], [Resource],Suffix,Remarks,CreatedDate AS [Created Date]
FROM dbo.tblResources
INNER JOIN tblResourcesItem WITH (NOLOCK) ON tblResources.id = tblResourcesItem.ResId
WHERE tblResourcesItem.ItemId = @itemId AND tblResourcesItem.GroupId = @groupId
OPTION (USE HINT ('DISABLE_ROW_MODE_MEMORY_GRANT_FEEDBACK'))
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'ClearResourceItem'
			AND schema_id = (select schema_id from sys.schemas where name = 'ENGINEERING')
			)
BEGIN
	DROP PROC ENGINEERING.ClearResourceItem
END
GO
CREATE PROC ENGINEERING.ClearResourceItem 
@ItemId INT,
@GroupId INT

AS
DELETE FROM tblResourcesItem
WHERE ItemId = @ItemId AND GroupId = @GroupId
GO
IF EXISTS (SELECT 1 FROM sys.objects 
			WHERE type = 'P' 
			AND name = 'DeleteResourceItem'
			AND schema_id = (select schema_id from sys.schemas where name = 'ENGINEERING')
			)
BEGIN
	DROP PROC ENGINEERING.DeleteResourceItem
END
GO
CREATE PROC ENGINEERING.DeleteResourceItem 
@Id INT

AS
DELETE FROM tblResourcesItem
WHERE Id = @Id
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROC [CONSTRUCTION].[GetEquipment]
AS

SELECT
VALL.Discipline,VALL.[Type],VALL.Subtype,VALL.Area,VALL.Subsystem,VALL.Tag,VALL.[Description],
VALL.ActId,tblActIDS.ActName,tblActIDS.SubCon AS [Act Subcon],
VALL.[Installed Date],VALL.[QC Released Date],VALL.RFINumber,VALL.[Installation Scope],
VALL.PDSModel,VALL.Team,VALL.[Status],VALL.Id

FROM (
    SELECT 
    'Instrumentation' AS Discipline,[JI_Type] AS [Type],NULL AS Subtype,
    [Area],[Subsystem],[JunctionBox] AS Tag
    ,[JI_Description] AS [Description]
    ,[IC_Plan_P6_ActID_Install] AS [ActId]
    ,[JI_Installed] AS [Installed Date]
    ,[JI_TRQC] AS [QC Released Date]
    ,NULL AS RFINumber
    ,[Furnished_By] AS [Installation Scope]
    ,PDSModel
    ,[Team]
    ,tbl_id AS Id
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM [JunctionBox] WITH (NOLOCK)

    UNION ALL

    SELECT 
    'Instrumentation' AS Discipline,[Type],Type_Description AS Subtype,
    [Area],[Subsystem],Tag AS Tag
    ,[des] AS [Description]
    ,[IC_Plan_P6_ActID_Install] AS [ActId]
    ,Installed_Date AS [Installed Date]
    ,TR_QC_Released AS [QC Released Date]
    ,NULL AS RFINumber
    ,NULL AS [Installation Scope]
    ,PDSModel
    ,[Team]
    ,tbl_id AS Id
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM tblInsEquipment WITH (NOLOCK)

    UNION ALL

    SELECT 
    'Electrical' AS Discipline,[JE_Type] AS [Type],NULL AS Subtype,
    [Area],[Subsystem],Tag AS Tag
    ,JE_Description AS [Description]
    ,[IC_Plan_P6_ActID_Install] AS [ActId]
    ,JE_Installed AS [Installed Date]
    ,JE_TRQC AS [QC Released Date]
    ,NULL AS RFINumber
    ,[Furnished_By] AS [Installation Scope]
    ,PDSModel
    ,[Team]
    ,tbl_id AS Id
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM tblEleJunctionBox WITH (NOLOCK)

    UNION ALL

    SELECT 
    'Electrical' AS Discipline,[Type],Type_Description AS Subtype,
    [Area],[Subsystem],Tag AS Tag
    ,[des] AS [Description]
    ,[IC_Plan_P6_ActID_Install] AS [ActId]
    ,Installed_Date AS [Installed Date]
    ,TR_QC_Released AS [QC Released Date]
    ,NULL AS RFINumber
    ,NULL AS [Installation Scope]
    ,PDSModel
    ,[Team]
    ,tbl_id AS Id
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM tblElectricalEquipment WITH (NOLOCK)

    UNION ALL

    SELECT 
    Discipline,[Type],Subtype,
    [Area],[Subsystem],Tag
    ,[Description]
    ,[ActId]
    ,InstalledDate AS [Installed Date]
    ,QCDate AS [QC Released Date]
    ,RFINumber
    ,NULL AS [Installation Scope]
    ,PDSModel
    ,[Team]
    ,eqId AS Id
    ,CASE WHEN Active = 0 THEN 'DELETED' ELSE 'Active' END AS Status
    FROM tblEquipment WITH (NOLOCK)
) AS VALL
LEFT JOIN tblActIDS ON VALL.ActId = tblActIDS.ActID
GO
